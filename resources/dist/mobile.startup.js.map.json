{"version":3,"sources":["webpack://mfModules.[name]/./src/mobile.startup/languageOverlay/getDeviceLanguage.js","webpack://mfModules.[name]/./src/mobile.startup/languageOverlay/languageOverlay.js","webpack://mfModules.[name]/./src/mobile.startup/loadingOverlay.js","webpack://mfModules.[name]/./src/mobile.startup/mediaViewer/overlay.js","webpack://mfModules.[name]/./src/mobile.startup/mobile.startup.js","webpack://mfModules.[name]/./src/mobile.startup/notifications/overlay.js","webpack://mfModules.[name]/./src/mobile.startup/references/ReferencesGateway.js","webpack://mfModules.[name]/./src/mobile.startup/references/ReferencesHtmlScraperGateway.js","webpack://mfModules.[name]/./src/mobile.startup/references/references.js","webpack://mfModules.[name]/./src/mobile.startup/rlModuleLoader.js","webpack://mfModules.[name]/./src/mobile.startup/search/MobileWebSearchLogger.js","webpack://mfModules.[name]/./src/mobile.startup/search/SearchHeaderView.js","webpack://mfModules.[name]/./src/mobile.startup/search/SearchOverlay.js","webpack://mfModules.[name]/./src/mobile.startup/search/SearchResultsView.js","webpack://mfModules.[name]/./src/mobile.startup/search/schemaMobileWebSearch.js","webpack://mfModules.[name]/./src/mobile.startup/search/searchHeader.js","webpack://mfModules.[name]/./src/mobile.startup/talk/overlay.js"],"names":["module","exports","navigator","lang","languages","language","userLanguage","browserLanguage","systemLanguage","toLowerCase","undefined","m","require","getDeviceLanguage","Overlay","promisedView","loadLanguageSearcher","gateway","mw","loader","using","then","getPageLanguages","config","get","data","variants","deviceLanguage","languageOverlay","pageGateway","make","heading","msg","className","test","icons","overlay","noHeader","spinner","$el","appendTo","find","util","header","options","headers","cancel","Promise","all","ImageCarousel","moduleLoader","schemaMobileWebSearch","mfExtend","context","time","View","PageGateway","Browser","Button","Icon","ReferencesGateway","ReferencesHtmlScraperGateway","Page","currentPage","PageHTMLParser","currentPageHTMLParser","Anchor","Skin","OverlayManager","loadingOverlay","CtaDrawer","toast","Watchstar","rlModuleLoader","eventBusSingleton","Toggler","toc","TableOfContents","parseHTML","notifications","references","search","SearchOverlay","MobileWebSearchLogger","SearchGateway","lazyImages","lazyImageLoader","talk","mediaViewer","mobileFrontend","define","subscribeMobileWebSearchSchema","notificationsOverlay","onCountChange","onNotificationListRendered","markAllReadButton","oouiPromise","OO","ui","ButtonWidget","icon","title","class","$element","markAllReadButtonView","hide","message","escaped","footerAnchor","href","getUrl","progressive","additionalClassNames","label","headerActions","isBorderBox","onBeforeExit","exit","list","echo","style","addEventListener","once","classList","remove","api","this","prototype","getReference","ERROR_NOT_EXIST","ERROR_OTHER","apply","arguments","EXTERNAL_LINK_CLASS","getReferenceFromContainer","id","$container","result","Deferred","escapeSelector","substr","length","addClass","resolve","text","html","reject","promise","page","pageHTMLParser","decodeURIComponent","Drawer","makeOnNestedReferenceClickHandler","onNestedReferenceClick","ev","target","tagName","getAttribute","textContent","referenceDrawer","props","containerClassName","error","name","hasText","isSmall","getClassName","extend","closeOnScroll","events","click sup","children","append","showReference","refNumber","reference","drawer","show","err","newLoadingOverlay","loadModule","delegateHide","showLoadingOverlay","hideOverlayIfNeeded","document","body","userSessionToken","searchSessionToken","_newUserSession","user","generateRandomSessionId","_newSearchSession","searchSessionCreatedAt","Date","getTime","onSearchShow","onSearchStart","track","action","timeOffsetSinceStart","onSearchResults","event","resultSetType","numberOfResults","results","timeToDisplayResults","onSearchResultClick","clickIndex","resultIndex","register","searchOverlay","logger","on","bind","SearchHeaderView","_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","call","input input","query","value","onInput","clearIcon","click","val","trigger","template","searchHeader","SearchResultsView","WatchstarPageList","params","placeholderMsg","performSearch","headerChrome","click .search-content","click .overlay-content","click .overlay-content > div","stopPropagation","touchstart .results","mousedown .results","click .results a","gatewayClass","router","onClickSearchContent","getDocument","$form","attr","type","setTimeout","onClickOverlayContent","hideKeyboardOnScroll","$input","onClickResult","$link","currentTarget","$result","closest","emit","$results","index","originalEvent","preventDefault","back","window","location","postRender","timer","self","searchResults","searchContentLabel","noResultsMsg","searchContentNoResultsMsg","parse","clearSearch","$spinner","clearTimeout","$searchContent","$resultContainer","searchData","delay","showKeyboard","len","setSelectionRange","isCached","lastQuery","_pendingQuery","abort","xhr","toggleClass","filter","funnel","pages","el","resetSearch","feedback","prompt","feedbackLink","_get","Schema","eventLog","platform","platformVersion","getMode","trackSubscribe","topic","log","formHeader","isAnon","getSections","sections","talkBoard"],"mappings":"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","file":"mobile.startup.js","sourcesContent":["/**\n * Return the language code of the device in lowercase\n *\n * @ignore\n * @param {window.navigator} navigator\n * @return {string|undefined}\n */\nfunction getDeviceLanguage( navigator ) {\n\tconst lang = navigator.languages ?\n\t\tnavigator.languages[ 0 ] :\n\t\tnavigator.language || navigator.userLanguage ||\n\t\t\t\tnavigator.browserLanguage || navigator.systemLanguage;\n\n\treturn lang ? lang.toLowerCase() : undefined;\n}\n\nmodule.exports = getDeviceLanguage;\n","const\n\tm = require( '../moduleLoaderSingleton' ),\n\tgetDeviceLanguage = require( './getDeviceLanguage' ),\n\tOverlay = require( '../Overlay' ),\n\tpromisedView = require( '../promisedView' );\n\n/**\n * @ignore\n * @param {PageGateway} gateway\n * @return {jQuery.Promise} Resolves to LanguageSearcher\n */\nfunction loadLanguageSearcher( gateway ) {\n\treturn mw.loader.using( 'mobile.languages.structured' ).then( function () {\n\t\treturn gateway.getPageLanguages( mw.config.get( 'wgPageName' ), mw.config.get( 'wgUserLanguage' ) );\n\t} ).then( function ( data ) {\n\t\tconst LanguageSearcher = m.require( 'mobile.languages.structured/LanguageSearcher' );\n\n\t\treturn new LanguageSearcher( {\n\t\t\tlanguages: data.languages,\n\t\t\tvariants: data.variants,\n\t\t\tdeviceLanguage: getDeviceLanguage( navigator )\n\t\t} );\n\n\t} );\n}\n\n/**\n * Factory function that returns a language featured instance of an Overlay\n *\n * @param {PageGateway} pageGateway\n * @return {Overlay}\n */\nfunction languageOverlay( pageGateway ) {\n\treturn Overlay.make(\n\t\t{\n\t\t\theading: mw.msg( 'mobile-frontend-language-heading' ),\n\t\t\tclassName: 'overlay language-overlay'\n\t\t}, promisedView( loadLanguageSearcher( pageGateway ) )\n\t);\n}\n\n// To make knowing when async logic has resolved easier in tests\nlanguageOverlay.test = {\n\tloadLanguageSearcher: loadLanguageSearcher\n};\n\nmodule.exports = languageOverlay;\n","var\n\ticons = require( './icons' ),\n\tOverlay = require( './Overlay' );\n\n/**\n * Overlay that initially shows loading animation until\n * caller hides it with .hide()\n *\n * @return {Overlay}\n */\nfunction loadingOverlay() {\n\tvar overlay = new Overlay( {\n\t\tclassName: 'overlay overlay-loading',\n\t\tnoHeader: true\n\t} );\n\ticons.spinner().$el.appendTo( overlay.$el.find( '.overlay-content' ) );\n\treturn overlay;\n}\n\nmodule.exports = loadingOverlay;\n","var m = require( '../moduleLoaderSingleton' ),\n\tpromisedView = require( '../promisedView' ),\n\tutil = require( '../util' ),\n\theader = require( '../headers' ).header,\n\ticons = require( '../icons' ),\n\tOverlay = require( '../Overlay' );\n\n/**\n * Produce an overlay for mediaViewer\n * @param {Object} options\n * @return {Overlay}\n */\nfunction mediaViewerOverlay( options ) {\n\tvar overlay = Overlay.make(\n\t\t{\n\t\t\theaders: [\n\t\t\t\theader( '', [], icons.cancel( 'gray' ) )\n\t\t\t],\n\t\t\tclassName: 'overlay media-viewer'\n\t\t},\n\t\tpromisedView(\n\t\t\tutil.Promise.all( [\n\t\t\t\tmw.loader.using( 'mobile.mediaViewer' )\n\t\t\t] ).then( function () {\n\t\t\t\tvar ImageCarousel = m.require( 'mobile.mediaViewer' ).ImageCarousel;\n\t\t\t\treturn new ImageCarousel( options );\n\t\t\t} )\n\t\t)\n\t);\n\n\treturn overlay;\n}\n\nmodule.exports = mediaViewerOverlay;\n","var\n\tmoduleLoader = require( './moduleLoaderSingleton' ),\n\tutil = require( './util' ),\n\tschemaMobileWebSearch = require( './search/schemaMobileWebSearch' );\n\n// Expose the entry chunk through libraryTarget and library. This allows\n// arbitrary file access via ResourceLoader like\n// `mfModules['mobile.startup'].moduleLoader.require('mobile.startup/LoadingOverlay')`.\nmodule.exports = {\n\tmoduleLoader: moduleLoader,\n\tmfExtend: require( './mfExtend' ),\n\tcontext: require( './context' ),\n\ttime: require( './time' ),\n\tutil,\n\tView: require( './View' ),\n\tPageGateway: require( './PageGateway' ),\n\tBrowser: require( './Browser' ),\n\tButton: require( './Button' ),\n\tIcon: require( './Icon' ),\n\tReferencesGateway: require( './references/ReferencesGateway' ),\n\tReferencesHtmlScraperGateway: require( './references/ReferencesHtmlScraperGateway' ),\n\ticons: require( './icons' ),\n\tPage: require( './Page' ),\n\tcurrentPage: require( './currentPage' ),\n\tPageHTMLParser: require( './PageHTMLParser' ),\n\tcurrentPageHTMLParser: require( './currentPageHTMLParser' ),\n\tAnchor: require( './Anchor' ),\n\tSkin: require( './Skin' ),\n\tOverlayManager: require( './OverlayManager' ),\n\tOverlay: require( './Overlay' ),\n\tloadingOverlay: require( './loadingOverlay' ),\n\tCtaDrawer: require( './CtaDrawer' ),\n\ttoast: require( './toast' ),\n\tWatchstar: require( './watchstar/Watchstar' ),\n\trlModuleLoader: require( './rlModuleLoader' ),\n\teventBusSingleton: require( './eventBusSingleton' ),\n\tToggler: require( './Toggler' ),\n\ttoc: {\n\t\t// In case any old version of Minerva is cached.\n\t\tTableOfContents: () => {\n\t\t\treturn {\n\t\t\t\t// in the unlikely event old Minerva code got loaded with new MF.\n\t\t\t\t$el: util.parseHTML( '<div>' )\n\t\t\t};\n\t\t}\n\t},\n\tnotifications: {\n\t\toverlay: require( './notifications/overlay' )\n\t},\n\treferences: require( './references/references' ),\n\tsearch: {\n\t\tSearchOverlay: require( './search/SearchOverlay' ),\n\t\tMobileWebSearchLogger: require( './search/MobileWebSearchLogger' ),\n\t\tSearchGateway: require( './search/SearchGateway' )\n\t},\n\tlazyImages: {\n\t\tlazyImageLoader: require( './lazyImages/lazyImageLoader' )\n\t},\n\ttalk: {\n\t\toverlay: require( './talk/overlay' )\n\t},\n\tlanguageOverlay: require( './languageOverlay/languageOverlay' ),\n\tmediaViewer: {\n\t\toverlay: require( './mediaViewer/overlay' )\n\t}\n};\n\nmw.mobileFrontend = moduleLoader;\n\n// Setup a single export for new modules to fold all of the above lines into.\n// One export to rule them all!\nmoduleLoader.define( 'mobile.startup', module.exports );\n\nschemaMobileWebSearch.subscribeMobileWebSearchSchema();\n","var Overlay = require( '../Overlay' ),\n\tm = require( '../moduleLoaderSingleton' ),\n\tpromisedView = require( '../promisedView' ),\n\tView = require( '../View' ),\n\tAnchor = require( '../Anchor' );\n\n/**\n * This callback is displayed as a global member.\n * @callback countChangeCallback\n * @param {number} count a capped (0-99 or 99+) count\n */\n\n/**\n * Make a notification overlay\n *\n * @param {countChangeCallback} onCountChange receives one parameter - a capped (0-99 or 99+) count.\n * @param {Function} onNotificationListRendered a function that is called when the\n *   notifications list has fully rendered (taking no arguments)\n * @return {Overlay}\n */\nfunction notificationsOverlay( onCountChange, onNotificationListRendered ) {\n\tvar markAllReadButton,\n\t\toouiPromise = mw.loader.using( 'mobile.notifications.overlay' ).then( function () {\n\t\t\tmarkAllReadButton = new OO.ui.ButtonWidget( {\n\t\t\t\ticon: 'checkAll',\n\t\t\t\ttitle: mw.msg( 'echo-mark-all-as-read' )\n\t\t\t} );\n\t\t\treturn View.make(\n\t\t\t\t{ class: 'notifications-overlay-header-markAllRead' },\n\t\t\t\t[ markAllReadButton.$element ]\n\t\t\t);\n\t\t} ),\n\t\tmarkAllReadButtonView = promisedView( oouiPromise );\n\t// hide the button spinner as it is confusing to see in the top right corner\n\tmarkAllReadButtonView.$el.hide();\n\n\tconst overlay = Overlay.make(\n\t\t{\n\t\t\theading: '<strong>' + mw.message( 'notifications' ).escaped() + '</strong>',\n\t\t\tfooterAnchor: new Anchor( {\n\t\t\t\thref: mw.util.getUrl( 'Special:Notifications' ),\n\t\t\t\tprogressive: true,\n\t\t\t\tadditionalClassNames: 'footer-link notifications-archive-link',\n\t\t\t\tlabel: mw.msg( 'echo-overlay-link' )\n\t\t\t} ).options,\n\t\t\theaderActions: [ markAllReadButtonView ],\n\t\t\tisBorderBox: false,\n\t\t\tclassName: 'overlay notifications-overlay navigation-drawer',\n\t\t\tonBeforeExit: ( exit ) => onBeforeExit( overlay, exit )\n\t\t},\n\t\tpromisedView(\n\t\t\toouiPromise.then( function () {\n\t\t\t\tconst module = m.require( 'mobile.notifications.overlay' ),\n\t\t\t\t\tlist = module.list;\n\t\t\t\treturn list( module.echo(), markAllReadButton, onCountChange,\n\t\t\t\t\tonNotificationListRendered );\n\t\t\t} )\n\t\t)\n\t);\n\treturn overlay;\n}\n\n/**\n * @param {Overlay} overlay\n * @param {Function} exit\n * @return {void}\n */\nfunction onBeforeExit( overlay, exit ) {\n\tif ( 'transition' in overlay.$el[0].style ) {\n\t\t// Manually detach the overlay from DOM once hide animation completes.\n\t\toverlay.$el[0].addEventListener( 'transitionend', exit, { once: true } );\n\n\t\t// Kick off animation.\n\t\toverlay.$el[0].classList.remove( 'visible' );\n\t} else {\n\t\texit();\n\t}\n}\n\nnotificationsOverlay.test = { onBeforeExit };\nmodule.exports = notificationsOverlay;\n","/**\n * Abstract base class\n * Gateway for retrieving references\n *\n * @class ReferencesGateway\n * @abstract\n *\n * @param {mw.Api} api\n */\nfunction ReferencesGateway( api ) {\n\tthis.api = api;\n}\n\n/**\n * Return the matched reference via API or DOM query\n *\n * @memberof ReferencesGateway\n * @instance\n * @param {string} id CSS selector\n * @param {Page} page to find reference for\n * @param {PageHTMLParser} pageHTMLParser\n * @return {jQuery.Promise} resolves with an Object representing reference\n *  with a `text` property\n *  The promise should be rejected with ReferenceGateway.ERROR_NOT_EXIST:\n *  if the reference is not found.\n *  If for some reason locating the reference fails return ReferenceGateway.ERROR_OTHER.\n */\nReferencesGateway.prototype.getReference = null;\n\n/**\n * @memberof ReferencesGateway\n * @property ERROR_NOT_EXIST error code to be returned by getReference\n *  when a reference does not exist.\n */\nReferencesGateway.ERROR_NOT_EXIST = 'NOT_EXIST_ERROR';\n/**\n * @memberof ReferencesGateway\n * @property ERROR_OTHER error code to be returned by getReference\n *  under any other circumstance not covered\n *  by ERROR_NOT_EXIST. It should be used if it is unclear whether a reference exists or not.\n */\nReferencesGateway.ERROR_OTHER = 'OTHER_ERROR';\n\nmodule.exports = ReferencesGateway;\n","var ReferencesGateway = require( './ReferencesGateway' ),\n\tmfExtend = require( './../mfExtend' ),\n\tutil = require( './../util' );\n\n/**\n * Gateway for retrieving references via the content of the Page\n *\n * @class ReferencesHtmlScraperGateway\n * @extends ReferencesGateway\n * @inheritdoc\n */\nfunction ReferencesHtmlScraperGateway() {\n\tReferencesGateway.apply( this, arguments );\n}\n\nmfExtend( ReferencesHtmlScraperGateway, ReferencesGateway, {\n\t/**\n\t * @memberof ReferencesHtmlScraperGateway\n\t * @property EXTERNAL_LINK_CLASS a CSS class to place on external links\n\t * in addition to the default 'external' class.\n\t */\n\tEXTERNAL_LINK_CLASS: 'external--reference',\n\t/**\n\t * @memberof ReferencesHtmlScraperGateway\n\t * @instance\n\t * @param {string} id of a DOM element in the page with '#' prefix.\n\t *  can be encoded or decoded.\n\t * @param {jQuery.Object} $container to scan for an element\n\t * @return {jQuery.Promise} that can be used by getReference\n\t */\n\tgetReferenceFromContainer: function ( id, $container ) {\n\t\tvar $el,\n\t\t\tresult = util.Deferred();\n\n\t\t$el = $container.find( '#' + util.escapeSelector( id.substr( 1 ) ) );\n\t\tif ( $el.length ) {\n\t\t\t$el.find( '.external' ).addClass( this.EXTERNAL_LINK_CLASS );\n\t\t\tresult.resolve( { text: $el.html() } );\n\t\t} else {\n\t\t\tresult.reject( ReferencesGateway.ERROR_NOT_EXIST );\n\t\t}\n\t\treturn result.promise();\n\t},\n\t/**\n\t * @inheritdoc\n\t * @memberof ReferencesHtmlScraperGateway\n\t * @instance\n\t * @param {string} id\n\t * @param {Page} page\n\t * @param {PageHTMLParser} pageHTMLParser\n\t */\n\tgetReference: function ( id, page, pageHTMLParser ) {\n\t\t// If an id is not found it's possible the id passed needs decoding (per T188547).\n\t\treturn this.getReferenceFromContainer( decodeURIComponent( id ), pageHTMLParser.$el.find( 'ol.references' ) );\n\t}\n} );\n\nmodule.exports = ReferencesHtmlScraperGateway;\n","var references,\n\tDrawer = require( '../Drawer' ),\n\tutil = require( '../util' ),\n\ticons = require( '../icons' ),\n\tReferencesGateway = require( './ReferencesGateway' ),\n\tIcon = require( '../Icon' );\n\n/**\n * Create a callback for clicking references\n * @param {Function} onNestedReferenceClick\n * @return {Function}\n */\nfunction makeOnNestedReferenceClickHandler( onNestedReferenceClick ) {\n\treturn ( ev ) => {\n\t\tconst target = ev.target;\n\t\tif ( target.tagName === 'A' ) {\n\t\t\tonNestedReferenceClick(\n\t\t\t\ttarget.getAttribute( 'href' ),\n\t\t\t\ttarget.textContent\n\t\t\t);\n\t\t\t// Don't hide the already shown drawer via propagation\n\t\t\t// and stop default scroll behaviour.\n\t\t\treturn false;\n\t\t}\n\t};\n}\n\n/**\n * Drawer for references\n * @uses Icon\n * @param {Object} props\n * @param {boolean} [props.error] whether an error has occurred\n * @param {string} props.title of reference e.g [1]\n * @param {string} props.text is the HTML of the reference\n * @param {Function} [props.onNestedReferenceClick] callback for when a reference\n *  inside the reference is clicked.\n * @return {Drawer}\n */\nfunction referenceDrawer( props ) {\n\tlet containerClassName = props.error ? new Icon( {\n\t\tname: 'error',\n\t\thasText: true,\n\t\tisSmall: true\n\t} ).getClassName() : '';\n\treturn new Drawer(\n\t\tutil.extend(\n\t\t\t{\n\t\t\t\tcloseOnScroll: false,\n\t\t\t\tclassName: 'drawer position-fixed text references-drawer',\n\t\t\t\tevents: {\n\t\t\t\t\t'click sup': props.onNestedReferenceClick &&\n\t\t\t\t\t\tmakeOnNestedReferenceClickHandler( props.onNestedReferenceClick )\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tutil.parseHTML( '<div>' )\n\t\t\t\t\t\t.addClass( 'references-drawer__header' )\n\t\t\t\t\t\t.append( [\n\t\t\t\t\t\t\tnew Icon( {\n\t\t\t\t\t\t\t\tisSmall: true,\n\t\t\t\t\t\t\t\tname: 'citation-invert',\n\t\t\t\t\t\t\t\tadditionalClassNames: 'references-drawer__title mw-ui-icon-flush-left',\n\t\t\t\t\t\t\t\thasText: true,\n\t\t\t\t\t\t\t\tlabel: mw.msg( 'mobile-frontend-references-citation' )\n\t\t\t\t\t\t\t} ).$el,\n\t\t\t\t\t\t\ticons.cancel( 'gray', {\n\t\t\t\t\t\t\t\tisSmall: true\n\t\t\t\t\t\t\t} ).$el\n\t\t\t\t\t\t] ),\n\t\t\t\t\tutil.parseHTML( '<div>' ).addClass( containerClassName ).append(\n\t\t\t\t\t\tutil.parseHTML( '<sup>' ).text( props.title ),\n\t\t\t\t\t\tprops.text ?\n\t\t\t\t\t\t\tutil.parseHTML( '<span>' ).html( props.text ) :\n\t\t\t\t\t\t\ticons.spinner().$el\n\t\t\t\t\t)\n\t\t\t\t]\n\t\t\t},\n\t\t\tprops\n\t\t)\n\t);\n}\n\nreferences = {\n\ttest: {\n\t\tmakeOnNestedReferenceClickHandler\n\t},\n\treferenceDrawer,\n\t/**\n\t * Fetch and render nested reference upon click\n\t * @param {string} id of the reference to be retrieved\n\t * @param {Page} page to locate reference for\n\t * @param {string} refNumber the number it identifies as in the page\n\t * @param {PageHTMLParser} pageHTMLParser\n\t * @param {Gateway} gateway\n\t * @return {jQuery.Deferred}\n\t */\n\tshowReference: function ( id, page, refNumber, pageHTMLParser, gateway ) {\n\t\treturn gateway.getReference( id, page, pageHTMLParser ).then( function ( reference ) {\n\t\t\tconst drawer = referenceDrawer( {\n\t\t\t\ttitle: refNumber,\n\t\t\t\ttext: reference.text,\n\t\t\t\tonNestedReferenceClick: function ( href, text ) {\n\t\t\t\t\treferences.showReference(\n\t\t\t\t\t\thref,\n\t\t\t\t\t\tpage,\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\tpageHTMLParser,\n\t\t\t\t\t\tgateway\n\t\t\t\t\t);\n\t\t\t\t\tdrawer.$el.remove();\n\t\t\t\t}\n\t\t\t} );\n\t\t\tdrawer.show();\n\t\t}, function ( err ) {\n\t\t\t// If non-existent reference nothing to do.\n\t\t\tif ( err === ReferencesGateway.ERROR_NOT_EXIST ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst drawer = referenceDrawer( {\n\t\t\t\terror: true,\n\t\t\t\ttitle: refNumber,\n\t\t\t\ttext: mw.msg( 'mobile-frontend-references-citation-error' )\n\t\t\t} );\n\t\t\tdrawer.show();\n\t\t} );\n\t}\n};\n\nmodule.exports = references;\n","var\n\tloadingOverlay = require( './loadingOverlay' ),\n\tutil = require( './util' );\n\n/**\n * Utility library for looking up details on the current user\n * @class loader\n * @singleton\n */\nmodule.exports = {\n\t// Exported to support testing and stubbing\n\tnewLoadingOverlay: function () {\n\t\treturn loadingOverlay();\n\t},\n\t/**\n\t * Loads a module via ResourceLoader\n\t * and displays a full screen LoadingOverlay during load time.\n\t * @memberof loader\n\t * @instance\n\t * @param {string} name ResourceLoader module name to load asynchronously.\n\t * @param {boolean} delegateHide if true the caller is responsible for hiding\n\t *  the intermediate loader.\n\t * @param {boolean} [showLoadingOverlay] if false a loading overlay will be hidden while\n\t *  loading the module. Defaults to true.\n\t * @return {jQuery.Promise}\n\t */\n\tloadModule: function ( name, delegateHide, showLoadingOverlay ) {\n\t\tvar loadingOverlay = this.newLoadingOverlay();\n\n\t\tshowLoadingOverlay = ( showLoadingOverlay !== undefined ) ? showLoadingOverlay : true;\n\t\tif ( showLoadingOverlay ) {\n\t\t\tloadingOverlay.appendTo( document.body );\n\t\t\tloadingOverlay.show();\n\t\t}\n\n\t\tfunction hideOverlayIfNeeded() {\n\t\t\tif ( !delegateHide && showLoadingOverlay ) {\n\t\t\t\tloadingOverlay.hide();\n\t\t\t}\n\t\t}\n\t\treturn mw.loader.using( name ).then( function () {\n\t\t\thideOverlayIfNeeded();\n\n\t\t\treturn loadingOverlay;\n\t\t}, function () {\n\t\t\thideOverlayIfNeeded();\n\n\t\t\treturn util.Deferred().reject().promise();\n\t\t} );\n\t}\n};\n","/**\n * Coordinates the logging of MobileWebSchema events.\n * Implements schema defined at https://meta.wikimedia.org/wiki/Schema:MobileWebSearch\n *\n * @class\n */\nfunction MobileWebSearchLogger() {\n\tthis.userSessionToken = null;\n\tthis.searchSessionToken = null;\n}\n\nMobileWebSearchLogger.prototype = {\n\t/**\n\t * Sets the internal state required to deal with logging user session\n\t * data.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t * @private\n\t */\n\t_newUserSession: function () {\n\t\tthis.userSessionToken = mw.user.generateRandomSessionId();\n\t},\n\n\t/**\n\t * Sets the internal state required to deal with logging search session\n\t * data.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t * @private\n\t */\n\t_newSearchSession: function () {\n\t\tthis.searchSessionToken = mw.user.generateRandomSessionId();\n\t\tthis.searchSessionCreatedAt = new Date().getTime();\n\t},\n\n\t/**\n\t * Handles the 'search-show' event.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t */\n\tonSearchShow: function () {\n\t\tthis._newUserSession();\n\t},\n\n\t/**\n\t * Handles the 'search-start' event.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t */\n\tonSearchStart: function () {\n\t\tthis._newSearchSession();\n\t\tmw.track( 'mf.schemaMobileWebSearch', {\n\t\t\taction: 'session-start',\n\t\t\tuserSessionToken: this.userSessionToken,\n\t\t\tsearchSessionToken: this.searchSessionToken,\n\t\t\ttimeOffsetSinceStart: 0\n\t\t} );\n\t},\n\n\t/**\n\t * Handles the 'search-results' event.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t * @param {Object} event with property {Object[]} event.results\n\t */\n\tonSearchResults: function ( event ) {\n\t\tvar timeOffsetSinceStart =\n\t\t\tnew Date().getTime() - this.searchSessionCreatedAt;\n\n\t\tmw.track( 'mf.schemaMobileWebSearch', {\n\t\t\taction: 'impression-results',\n\t\t\tresultSetType: 'prefix',\n\t\t\tnumberOfResults: event.results.length,\n\t\t\tuserSessionToken: this.userSessionToken,\n\t\t\tsearchSessionToken: this.searchSessionToken,\n\t\t\t// FIXME: Unless I'm mistaken, the timeToDisplayResults\n\t\t\t// property isn't necessary.\n\t\t\ttimeToDisplayResults: timeOffsetSinceStart,\n\t\t\ttimeOffsetSinceStart: timeOffsetSinceStart\n\t\t} );\n\t},\n\n\t/**\n\t * Handles the 'search-result-click' event.\n\t * @memberof MobileWebSearchLogger\n\t * @instance\n\t * @param {Object} event with property {number} event.index\n\t *  The zero-based index of the result in the set of results.\n\t */\n\tonSearchResultClick: function ( event ) {\n\t\tvar timeOffsetSinceStart =\n\t\t\tnew Date().getTime() - this.searchSessionCreatedAt;\n\n\t\tmw.track( 'mf.schemaMobileWebSearch', {\n\t\t\taction: 'click-result',\n\t\t\t// NOTE: clickIndex is 1-based.\n\t\t\tclickIndex: event.resultIndex + 1,\n\t\t\tuserSessionToken: this.userSessionToken,\n\t\t\tsearchSessionToken: this.searchSessionToken,\n\t\t\ttimeOffsetSinceStart: timeOffsetSinceStart\n\t\t} );\n\t}\n};\n\n/**\n * Convenience function that wires up an instance of the\n * MobileWebSearchLogger class to the search-* events emitted by the\n * search overlay.\n * @memberof MobileWebSearchLogger\n * @param {SearchOverlay} searchOverlay\n */\nMobileWebSearchLogger.register = function ( searchOverlay ) {\n\tvar logger = new MobileWebSearchLogger();\n\n\tsearchOverlay.on( 'search-show', logger.onSearchShow.bind( logger ) );\n\tsearchOverlay.on( 'search-start', logger.onSearchStart.bind( logger ) );\n\tsearchOverlay.on( 'search-results', logger.onSearchResults.bind( logger ) );\n\tsearchOverlay.on( 'search-result-click', logger.onSearchResultClick.bind( logger ) );\n};\n\nmodule.exports = MobileWebSearchLogger;\n","const util = require( '../util' ),\n\tView = require( '../View' ),\n\tIcon = require( '../Icon' );\n\n/**\n * @extends View\n */\nclass SearchHeaderView extends View {\n\t/**\n\t * constructor\n\t * @inheritdoc\n\t * @param {Object} props\n\t * @param {Function} props.onInput executed every time input changes\n\t * @param {string} props.placeholderMsg\n\t * @param {string} props.action\n\t * @param {string} [props.searchTerm] default\n\t */\n\tconstructor( props ) {\n\t\tsuper(\n\t\t\tutil.extend( {}, props, {\n\t\t\t\tevents: {\n\t\t\t\t\t'input input': 'onInput'\n\t\t\t\t}\n\t\t\t} )\n\t\t);\n\t}\n\t/** @inheritdoc */\n\tonInput( ev ) {\n\t\tconst query = ev.target.value;\n\t\tthis.options.onInput( query );\n\t\tif ( query ) {\n\t\t\tthis.clearIcon.$el.show();\n\t\t} else {\n\t\t\tthis.clearIcon.$el.hide();\n\t\t}\n\t}\n\t/** @inheritdoc */\n\tget isTemplateMode() {\n\t\treturn true;\n\t}\n\t/** @inheritdoc */\n\tget template() {\n\t\treturn util.template( `<div class=\"overlay-title search-header-view\">\n\t\t<form method=\"get\" action=\"{{action}}\" class=\"search-box\">\n\t\t<input class=\"search\" type=\"search\" name=\"search\" autocomplete=\"off\" placeholder=\"{{placeholderMsg}}\" aria-label=\"{{placeholderMsg}}\" value=\"{{searchTerm}}\">\n\t\t</form>\n</div>` );\n\t}\n\t/** @inheritdoc */\n\tpostRender() {\n\t\tconst clearIcon = new Icon( {\n\t\t\ttagName: 'button',\n\t\t\tname: 'search-clear',\n\t\t\tisSmall: true,\n\t\t\tlabel: mw.msg( 'mobile-frontend-clear-search' ),\n\t\t\tadditionalClassNames: 'clear',\n\t\t\tevents: {\n\t\t\t\tclick: function () {\n\t\t\t\t\tthis.$el.find( 'input' ).val( '' ).trigger( 'focus' );\n\t\t\t\t\tthis.options.onInput( '' );\n\t\t\t\t\tclearIcon.$el.hide();\n\t\t\t\t\t// In beta the clear button is on top of the search input.\n\t\t\t\t\t// Stop propagation so that the input doesn't receive the click.\n\t\t\t\t\treturn false;\n\t\t\t\t}.bind( this )\n\t\t\t}\n\t\t} );\n\t\tthis.clearIcon = clearIcon;\n\t\tclearIcon.$el.hide();\n\t\tthis.$el.append( clearIcon.$el );\n\t}\n}\n\nmodule.exports = SearchHeaderView;\n","var\n\tmfExtend = require( '../mfExtend' ),\n\tOverlay = require( '../Overlay' ),\n\tutil = require( '../util' ),\n\tsearchHeader = require( './searchHeader' ),\n\tSearchResultsView = require( './SearchResultsView' ),\n\tWatchstarPageList = require( '../watchstar/WatchstarPageList' ),\n\tSEARCH_DELAY = 300,\n\tSEARCH_SPINNER_DELAY = 2000;\n\n/**\n * Overlay displaying search results\n * @class SearchOverlay\n * @extends Overlay\n * @uses SearchGateway\n * @uses Icon\n *\n * @param {Object} params Configuration options\n * @param {string} params.placeholderMsg Search input placeholder text.\n * @param {string} [params.action] of form defaults to the value of wgScript\n * @param {SearchGateway} [params.gateway]\n * @fires SearchOverlay#search-show\n * @fires SearchOverlay#search-start\n * @fires SearchOverlay#search-results\n * @fires SearchOverlay#search-result-click\n */\nfunction SearchOverlay( params ) {\n\tvar header = searchHeader(\n\t\t\tparams.placeholderMsg,\n\t\t\tparams.action || mw.config.get( 'wgScript' ),\n\t\t\tfunction ( query ) {\n\t\t\t\tthis.performSearch( query );\n\t\t\t}.bind( this )\n\t\t),\n\t\toptions = util.extend( true, {\n\t\t\theaderChrome: true,\n\t\t\tisBorderBox: false,\n\t\t\tclassName: 'overlay search-overlay',\n\t\t\theaders: [ header ],\n\t\t\tevents: {\n\t\t\t\t'click .search-content': 'onClickSearchContent',\n\t\t\t\t'click .overlay-content': 'onClickOverlayContent',\n\t\t\t\t'click .overlay-content > div': function ( ev ) {\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t},\n\t\t\t\t'touchstart .results': 'hideKeyboardOnScroll',\n\t\t\t\t'mousedown .results': 'hideKeyboardOnScroll',\n\t\t\t\t'click .results a': 'onClickResult'\n\t\t\t}\n\t\t},\n\t\tparams );\n\n\tthis.header = header;\n\tOverlay.call( this, options );\n\n\tthis.api = options.api;\n\t// eslint-disable-next-line new-cap\n\tthis.gateway = options.gateway || new options.gatewayClass( this.api );\n\n\tthis.router = options.router;\n}\n\nmfExtend( SearchOverlay, Overlay, {\n\n\t/**\n\t * Initialize 'search within pages' functionality\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\tonClickSearchContent: function () {\n\t\tvar $el = util.getDocument().find( 'body' ),\n\t\t\t$form = this.$el.find( 'form' );\n\n\t\t// Add fulltext input to force fulltext search\n\t\tthis.parseHTML( '<input>' )\n\t\t\t.attr( {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tname: 'fulltext',\n\t\t\t\tvalue: 'search'\n\t\t\t} )\n\t\t\t.appendTo( $form );\n\t\t// history.back queues a task so might run after this call. Thus we use setTimeout\n\t\t// http://www.w3.org/TR/2011/WD-html5-20110113/webappapis.html#queue-a-task\n\t\tsetTimeout( function () {\n\t\t\t// Firefox doesn't allow submission of a form not in the DOM\n\t\t\t// so temporarily re-add it\n\t\t\t$form.appendTo( $el );\n\t\t\t$form.trigger( 'submit' );\n\t\t}, 0 );\n\t},\n\n\t/**\n\t * Tapping on background only should hide the overlay\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\tonClickOverlayContent: function () {\n\t\tthis.$el.find( '.cancel' ).trigger( 'click' );\n\t},\n\n\t/**\n\t * Hide the keyboard when scrolling starts (avoid weird situation when\n\t * user taps on an item, the keyboard hides and wrong item is clicked).\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\thideKeyboardOnScroll: function () {\n\t\tthis.$input.trigger( 'blur' );\n\t},\n\n\t/**\n\t * Handle the user clicking a result.\n\t *\n\t * @memberof SearchOverlay\n\t * @instance\n\t * @param {jQuery.Event} ev\n\t */\n\tonClickResult: function ( ev ) {\n\t\tvar $link = this.$el.find( ev.currentTarget ),\n\t\t\t$result = $link.closest( 'li' );\n\t\t/**\n\t\t * Fired when the user clicks a search result\n\t\t * @event SearchOverlay#search-result-click\n\t\t * @type {Object}\n\t\t * @property {jQuery.Object} result The jQuery-wrapped DOM element that\n\t\t *  the user clicked\n\t\t * @property {number} resultIndex The zero-based index of the\n\t\t *  result in the set of results\n\t\t * @property {jQuery.Event} originalEvent The original event\n\t\t */\n\t\tthis.emit( 'search-result-click', {\n\t\t\tresult: $result,\n\t\t\tresultIndex: this.$results.index( $result ),\n\t\t\toriginalEvent: ev\n\t\t} );\n\n\t\t// FIXME: ugly hack that removes search from browser history\n\t\t// when navigating to search results\n\t\tev.preventDefault();\n\t\tthis.router.back().then( function () {\n\t\t\t// Router.navigate does not support changing href.\n\t\t\t// FIXME: Needs upstream change T189173\n\t\t\t// eslint-disable-next-line no-restricted-properties\n\t\t\twindow.location.href = $link.attr( 'href' );\n\t\t} );\n\t},\n\n\t/**\n\t * @inheritdoc\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\tpostRender: function () {\n\t\tvar self = this,\n\t\t\tsearchResults = new SearchResultsView( {\n\t\t\t\tsearchContentLabel: mw.msg( 'mobile-frontend-search-content' ),\n\t\t\t\tnoResultsMsg: mw.msg( 'mobile-frontend-search-no-results' ),\n\t\t\t\tsearchContentNoResultsMsg: mw.message( 'mobile-frontend-search-content-no-results' ).parse()\n\t\t\t} ),\n\t\t\ttimer;\n\n\t\tthis.$el.find( '.overlay-content' ).append( searchResults.$el );\n\t\tOverlay.prototype.postRender.call( this );\n\n\t\t// FIXME: `this.$input` should not be set. Isolate to searchHeader function\n\t\tthis.$input = this.$el.find( this.header ).find( 'input' );\n\t\t// FIXME: `this.$searchContent` should not be set. Isolate to SearchResultsView class.\n\t\tthis.$searchContent = searchResults.$el.hide();\n\t\t// FIXME: `this.$resultContainer` should not be set. Isolate to SearchResultsView class.\n\t\tthis.$resultContainer = searchResults.$el.find( '.results-list-container' );\n\n\t\t/**\n\t\t * Hide the spinner and abort timed spinner shows.\n\t\t * FIXME: Given this manipulates SearchResultsView this should be moved into that class\n\t\t */\n\t\tfunction clearSearch() {\n\t\t\tself.$spinner.hide();\n\t\t\tclearTimeout( timer );\n\t\t}\n\n\t\t// Show a spinner on top of search results\n\t\t// FIXME: Given this manipulates SearchResultsView this should be moved into that class\n\t\tthis.$spinner = searchResults.$el.find( '.spinner-container' );\n\t\tthis.on( 'search-start', function ( searchData ) {\n\t\t\tif ( timer ) {\n\t\t\t\tclearSearch();\n\t\t\t}\n\t\t\ttimer = setTimeout( function () {\n\t\t\t\tself.$spinner.show();\n\t\t\t}, SEARCH_SPINNER_DELAY - searchData.delay );\n\t\t} );\n\t\tthis.on( 'search-results', clearSearch );\n\t},\n\n\t/**\n\t * Trigger a focus() event on search input in order to\n\t * bring up the virtual keyboard.\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\tshowKeyboard: function () {\n\t\tvar len = this.$input.val().length;\n\t\tthis.$input.trigger( 'focus' );\n\t\t// Cursor to the end of the input\n\t\tif ( this.$input[0].setSelectionRange ) {\n\t\t\tthis.$input[0].setSelectionRange( len, len );\n\t\t}\n\t},\n\n\t/**\n\t * @inheritdoc\n\t * @memberof SearchOverlay\n\t * @instance\n\t */\n\tshow: function () {\n\t\t// Overlay#show defines the actual overlay visibility.\n\t\tOverlay.prototype.show.apply( this, arguments );\n\n\t\tthis.showKeyboard();\n\t\t/**\n\t\t * Fired after the search overlay is shown\n\t\t * @event SearchOverlay#search-show\n\t\t */\n\t\tthis.emit( 'search-show' );\n\t},\n\n\t/**\n\t * Perform search and render results inside current view.\n\t * FIXME: Much of the logic for caching and pending queries inside this function should\n\t * actually live in SearchGateway, please move out.\n\t * @memberof SearchOverlay\n\t * @instance\n\t * @param {string} query\n\t */\n\tperformSearch: function ( query ) {\n\t\tvar\n\t\t\tself = this,\n\t\t\tapi = this.api,\n\t\t\tdelay = this.gateway.isCached( query ) ? 0 : SEARCH_DELAY;\n\n\t\t// it seems the input event can be fired when virtual keyboard is closed\n\t\t// (Chrome for Android)\n\t\tif ( query !== this.lastQuery ) {\n\t\t\tif ( self._pendingQuery ) {\n\t\t\t\tself._pendingQuery.abort();\n\t\t\t}\n\t\t\tclearTimeout( this.timer );\n\n\t\t\tif ( query.length ) {\n\t\t\t\tthis.timer = setTimeout( function () {\n\t\t\t\t\tvar xhr;\n\t\t\t\t\t/**\n\t\t\t\t\t * Fired immediately before the search API request is sent\n\t\t\t\t\t * @event SearchOverlay#search-start\n\t\t\t\t\t * @property {Object} data related to the current search\n\t\t\t\t\t */\n\t\t\t\t\tself.emit( 'search-start', {\n\t\t\t\t\t\tquery: query,\n\t\t\t\t\t\tdelay: delay\n\t\t\t\t\t} );\n\n\t\t\t\t\txhr = self.gateway.search( query );\n\t\t\t\t\tself._pendingQuery = xhr.then( function ( data ) {\n\t\t\t\t\t\t// FIXME: Given this manipulates SearchResultsView\n\t\t\t\t\t\t// this should be moved into that class\n\t\t\t\t\t\t// check if we're getting the rights response in case of out of\n\t\t\t\t\t\t// order responses (need to get the current value of the input)\n\t\t\t\t\t\tif ( data && data.query === self.$input.val() ) {\n\t\t\t\t\t\t\tself.$el.toggleClass( 'no-results', data.results.length === 0 );\n\t\t\t\t\t\t\tself.$searchContent\n\t\t\t\t\t\t\t\t.show()\n\t\t\t\t\t\t\t\t.find( 'p' )\n\t\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t\t.filter( data.results.length ? '.with-results' : '.without-results' )\n\t\t\t\t\t\t\t\t.show();\n\n\t\t\t\t\t\t\t// eslint-disable-next-line no-new\n\t\t\t\t\t\t\tnew WatchstarPageList( {\n\t\t\t\t\t\t\t\tapi: api,\n\t\t\t\t\t\t\t\tfunnel: 'search',\n\t\t\t\t\t\t\t\tpages: data.results,\n\t\t\t\t\t\t\t\tel: self.$resultContainer\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\tself.$results = self.$resultContainer.find( 'li' );\n\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * Fired when search API returns results\n\t\t\t\t\t\t\t * @event SearchOverlay#search-results\n\t\t\t\t\t\t\t * @type {Object}\n\t\t\t\t\t\t\t * @property {Object[]} results The results returned by the search\n\t\t\t\t\t\t\t *  API\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tself.emit( 'search-results', {\n\t\t\t\t\t\t\t\tresults: data.results\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t} ).promise( { abort: function () { xhr.abort(); } } );\n\t\t\t\t}, delay );\n\t\t\t} else {\n\t\t\t\tself.resetSearch();\n\t\t\t}\n\n\t\t\tthis.lastQuery = query;\n\t\t}\n\t},\n\t/**\n\t * Clear results\n\t *\n\t * @private\n\t */\n\tresetSearch: function () {\n\t\tthis.$el.find( '.overlay-content' ).children().hide();\n\t}\n} );\n\nmodule.exports = SearchOverlay;\n","const View = require( '../View' ),\n\tIcon = require( '../Icon' ),\n\tAnchor = require( '../Anchor' ),\n\ticons = require( '../icons' ),\n\tspinner = icons.spinner().$el,\n\tutil = require( '../util' );\n\n/**\n * @class SearchResultsView\n * @extends View\n * @param {Object} options\n * @param {string} options.searchContentLabel actionable label to tell the user they can \"search\n *  within pages rather than doing a full text search\n * @param {string} options.noResultsMsg shows when no results displayed\n * @param {string} options.searchContentNoResultsMsg alternative to options.searchContentLabel that\n * shows when no search results have been displayed.\n */\nclass SearchResultsView extends View {\n\t/** @inheritdoc */\n\tget isTemplateMode() {\n\t\treturn true;\n\t}\n\t/** @inheritdoc */\n\tget template() {\n\t\treturn util.template( `\n<div class=\"search-results-view\">\n\t<div class=\"search-content overlay-header\">\n\t\t<ul>\n\t\t\t<li>{{! search content icon goes here }}</li>\n\t\t</ul>\n\t\t<div class=\"caption\">\n\t\t\t<p class=\"with-results\">{{searchContentLabel}}</p>\n\t\t\t<p class=\"without-results\">{{noResultsMsg}}</p>\n\t\t\t<p class=\"without-results\">{{{searchContentNoResultsMsg}}}</p>\n\t\t</div>\n\t</div>\n\t<div class=\"spinner-container position-fixed\"></div>\n\t<div class=\"results\">\n\t\t<div class=\"results-list-container\"></div>\n\t\t{{#feedback}}\n\t\t\t<div class=\"search-feedback\">\n\t\t\t\t{{prompt}}\n\t\t\t</div>\n\t\t{{/feedback}}\n\t</div>\n</div>`\n\t\t);\n\t}\n\t/** @inheritdoc */\n\tpreRender() {\n\t\tconst feedbackLink = mw.config.get( 'wgCirrusSearchFeedbackLink' );\n\t\tif ( feedbackLink ) {\n\t\t\tthis.options.feedback = {\n\t\t\t\tprompt: mw.msg( 'mobile-frontend-search-feedback-prompt' ) };\n\t\t}\n\t}\n\t/** @inheritdoc */\n\tpostRender( options ) {\n\t\tconst feedbackLink = mw.config.get( 'wgCirrusSearchFeedbackLink' );\n\t\tsuper.postRender( options );\n\t\tthis.$el.find( '.search-content li' ).append(\n\t\t\tnew Icon( {\n\t\t\t\ttagName: 'a',\n\t\t\t\t// When this icon is clicked we want to reset the hash for subsequent views\n\t\t\t\thref: '#',\n\t\t\t\tname: 'search-content',\n\t\t\t\tlabel: mw.msg( 'mobile-frontend-search-content' )\n\t\t\t} ).$el\n\t\t);\n\t\tthis.$el.find( '.spinner-container' ).append( spinner );\n\t\tif ( feedbackLink ) {\n\t\t\tthis.$el.find( '.search-feedback' ).append(\n\t\t\t\tnew Anchor( {\n\t\t\t\t\tlabel: mw.msg( 'mobile-frontend-search-feedback-link-text' ),\n\t\t\t\t\thref: feedbackLink\n\t\t\t\t} ).$el\n\t\t\t);\n\t\t}\n\t}\n}\n\nmodule.exports = SearchResultsView;\n","var context = require( '../context' );\n\nfunction subscribeMobileWebSearchSchema() {\n\tmw.loader.using( [\n\t\t'ext.eventLogging'\n\t] ).then( function () {\n\t\tvar // Schema class provided by ext.eventLogging\n\t\t\tSchema = mw.eventLog.Schema,\n\t\t\t/**\n\t\t\t * MobileWebSearch schema\n\t\t\t * https://meta.wikimedia.org/wiki/Schema:MobileWebSearch\n\t\t\t */\n\t\t\tschemaMobileWebSearch = new Schema(\n\t\t\t\t'MobileWebSearch',\n\t\t\t\t// todo: use a default value of 0 once config lands in production.\n\t\t\t\tmw.config.get( 'wgMFSchemaSearchSampleRate', 1 / 1000 ),\n\t\t\t\t/**\n\t\t\t\t * @property {Object} defaults Default options hash.\n\t\t\t\t * @property {string} defaults.platform Always \"mobileweb\"\n\t\t\t\t * @property {string} defaults.platformVersion The version of MobileFrontend\n\t\t\t\t *  that the user is using. One of \"stable\" or \"beta\"\n\t\t\t\t */\n\t\t\t\t{\n\t\t\t\t\tplatform: 'mobileweb',\n\t\t\t\t\tplatformVersion: context.getMode()\n\t\t\t\t}\n\t\t\t);\n\n\t\tmw.trackSubscribe( 'mf.schemaMobileWebSearch', function ( topic, data ) {\n\t\t\tschemaMobileWebSearch.log( data );\n\t\t} );\n\t} );\n}\n\nmodule.exports = {\n\tsubscribeMobileWebSearchSchema: subscribeMobileWebSearchSchema\n};\n","const formHeader = require( '../headers' ).formHeader,\n\tSearchHeaderView = require( './SearchHeaderView' ),\n\ticons = require( '../icons' );\n\n/**\n * Generate a search header\n * @param {string} placeholderMsg\n * @param {string} action\n * @param {Function} onInput\n * @return {JQuery.Element}\n */\nfunction searchHeader( placeholderMsg, action, onInput ) {\n\treturn formHeader(\n\t\t// Note: Do not put the clear button inside the form\n\t\t// as hitting enter on the input element triggers a button click,\n\t\t// rather than submitting the form (see T136243)\n\t\tnew SearchHeaderView( {\n\t\t\tplaceholderMsg,\n\t\t\taction,\n\t\t\tonInput\n\t\t} ),\n\t\t[\n\t\t\ticons.cancel()\n\t\t],\n\t\tfalse\n\t);\n}\n\nmodule.exports = searchHeader;\n","var m = require( '../moduleLoaderSingleton' ),\n\tpromisedView = require( '../promisedView' ),\n\tButton = require( '../Button' ),\n\tutil = require( '../util' ),\n\theader = require( '../headers' ).header,\n\tOverlay = require( '../Overlay' );\n\n/**\n * Produce an overlay for talk page\n * @param {string} title of the page to get talk topics for\n * @param {PageGateway} gateway for interacting with API.\n * @return {Overlay}\n */\nfunction talkOverlay( title, gateway ) {\n\tvar user = mw.user;\n\n\treturn Overlay.make(\n\t\t{\n\t\t\theaders: [\n\t\t\t\theader(\n\t\t\t\t\t'<strong>' + mw.msg( 'mobile-frontend-talk-overlay-header' ) + '</strong>',\n\t\t\t\t\tuser.isAnon() ? [] : [ new Button( {\n\t\t\t\t\t\thref: '#/talk/new',\n\t\t\t\t\t\tadditionalClassNames: 'continue',\n\t\t\t\t\t\tprogressive: true,\n\t\t\t\t\t\tlabel: mw.msg( 'mobile-frontend-talk-add-overlay-submit' )\n\t\t\t\t\t} ) ]\n\t\t\t\t)\n\t\t\t],\n\t\t\tfooterAnchor: new Button( {\n\t\t\t\tprogressive: true,\n\t\t\t\thref: mw.util.getUrl( title ),\n\t\t\t\tadditionalClassNames: 'footer-link talk-fullpage',\n\t\t\t\tlabel: mw.msg( 'mobile-frontend-talk-fullpage' )\n\t\t\t} ).options,\n\t\t\tclassName: 'talk-overlay overlay'\n\t\t},\n\t\tpromisedView(\n\t\t\tutil.Promise.all( [\n\t\t\t\tgateway.getSections( title ),\n\t\t\t\tmw.loader.using( 'mobile.talk.overlays' )\n\t\t\t] ).then( function ( sections ) {\n\t\t\t\tvar talkBoard = m.require( 'mobile.talk.overlays/talkBoard' );\n\t\t\t\treturn talkBoard( sections );\n\t\t\t} )\n\t\t)\n\t);\n}\n\nmodule.exports = talkOverlay;\n"],"sourceRoot":""}