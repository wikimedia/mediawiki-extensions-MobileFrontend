(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[569],{"./src/mobile.startup/Anchor.js":(e,t,s)=>{const i=s("./src/mobile.startup/View.js"),n=s("./src/mobile.startup/util.js");e.exports=class extends i{get isTemplateMode(){return!0}get defaults(){return{progressive:void 0,destructive:void 0,additionalClassNames:"",href:void 0,label:void 0}}get template(){return n.template('\n<a {{#href}}href="{{href}}"{{/href}} class="mw-mf-anchor\n\t{{#progressive}} mw-mf-anchor-progressive{{/progressive}}\n\t{{#destructive}} mw-mf-anchor-destructive{{/destructive}}\n\t {{additionalClassNames}}">{{label}}</a>\n\t')}}},"./src/mobile.startup/Browser.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js");let n;function a(e){const t=function(){const s=this["__cache"+t.cacheId]||(this["__cache"+t.cacheId]={}),i=[].join.call(arguments,"|");return Object.prototype.hasOwnProperty.call(s,i)?s[i]:s[i]=e.apply(this,arguments)};return t.cacheId=Date.now().toString()+Math.random().toString(),t}class r{constructor(e,t){this.userAgent=e,this.$el=t,this.isIos=a((function(e){const t=this.userAgent,s=/ipad|iphone|ipod/i.test(t);if(!s||!e)return s;switch(e){case 8:return/OS 8_/.test(t)||/Version\/8/.test(t);case 4:return/OS 4_/.test(t);case 5:return/OS 5_/.test(t);default:return!1}})),this.isWideScreen=a((()=>{const e=parseInt(mw.config.get("wgMFDeviceWidthTablet"),10);return window.innerWidth>=e})),this.supportsTouchEvents=a((()=>"ontouchstart"in window))}static getSingleton(){let e;return n||(e=i.getDocument(),n=new r(window.navigator.userAgent,e)),n}}e.exports=r},"./src/mobile.startup/Button.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/View.js"),a=s("./src/mobile.startup/IconButton.js");e.exports=class extends n{constructor(e){super(e)}get isTemplateMode(){return!0}get defaults(){return{tagName:"a",disabled:!1,block:void 0,progressive:void 0,destructive:void 0,quiet:void 0,additionalClassNames:"",href:void 0,label:void 0,size:"medium"}}get template(){return i.template("{{{_buttonHTML}}}")}preRender(){let e="default";this.options.progressive?e="progressive":this.options.destructive&&(e="destructive");let t=this.options.quiet?"quiet":"normal";(this.options.progressive||this.options.destructive)&&(t="primary"),this.options.block&&(this.options.additionalClassNames+=" mf-button-block");const s=i.extend({weight:t,action:e,isIconOnly:!1,icon:null},this.options);this._button=new a(s),this.options._buttonHTML=this._button.$el.get(0).outerHTML}}},"./src/mobile.startup/CtaDrawer.js":(e,t,s)=>{const i=s("./src/mobile.startup/Drawer.js"),n=s("./src/mobile.startup/util.js"),a=s("./src/mobile.startup/Button.js"),r=s("./src/mobile.startup/Anchor.js");function o(e={}){const t=l(e.queryParams,e.returnTo);return new i(n.extend({children:[n.parseHTML("<p>").text(e.content),new a(n.extend({progressive:!0,href:mw.util.getUrl("Special:UserLogin",t),label:mw.msg("mobile-frontend-watchlist-cta-button-login")},e.progressiveButton)).$el,n.parseHTML("<div>").addClass("cta-drawer__anchors").append(new r(n.extend({href:mw.util.getUrl("Special:UserLogin",c(t,e.signupQueryParams)),progressive:!0,label:mw.msg("mobile-frontend-watchlist-cta-button-signup")},e.actionAnchor)).$el)]},e))}function l(e,t){return n.extend({returnto:t||mw.config.get("wgPageName")},e)}function c(){return[].push.call(arguments,{type:"signup"}),n.extend.apply(n,arguments)}o.prototype.test={redirectParams:l,signUpParams:c},e.exports=o},"./src/mobile.startup/Drawer.js":(e,t,s)=>{const i=s("./src/mobile.startup/View.js"),n=s("./src/mobile.startup/util.js"),a=s("./src/mobile.startup/IconButton.js");e.exports=class extends i{constructor(e){super(n.extend({onBeforeHide:()=>{},showCollapseIcon:!0},e,{events:n.extend({"click .drawer-container__mask":()=>{this.hide()},"click .cancel":e=>{e.preventDefault(),this.hide()},click(e){e.stopPropagation()}},e.events)}))}initialize(e){this.drawerClassName=e.className||"",e.className="drawer-container",this.collapseIcon=new a({icon:"expand",additionalClassNames:"cancel",label:mw.msg("mobile-frontend-drawer-arrow-label")}),this.minHideDelay=100,super.initialize(e)}show(){const e=n.Deferred();this.$el.prepend(this.$mask),this.$el.width();const t=this.$el.find(".drawer");return this.$mask.addClass("drawer-container__mask--visible"),t.hasClass("visible")?e.resolve():(t.addClass("visible"),mw.hook("mobileFrontend.loadLazyImages").fire(this.$el),this.options.onShow&&this.options.onShow(e),requestAnimationFrame((()=>e.resolve()))),e.promise()}hide(){this.$el.find(".drawer").removeClass("visible"),this.$mask.removeClass("drawer-container__mask--visible"),setTimeout((()=>{this.$mask.detach()}),100),requestAnimationFrame((()=>{this.options.onBeforeHide(this)}))}postRender(){this.$mask=n.parseHTML("<div>").addClass("drawer-container__mask");const e=this.options,t=n.parseHTML("<div>").addClass(`drawer drawer-container__drawer position-fixed ${this.drawerClassName}`.trim());e.showCollapseIcon&&t.prepend(this.collapseIcon.$el),e.children&&t.append(e.children),this.$el.append(t)}}},"./src/mobile.startup/Icon.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/View.js");e.exports=class extends n{constructor(e){super(e)}preRender(){this.options._iconClasses=this.getIconClasses()}getRotationClass(){let e="";if(this.options.rotation)switch(this.options.rotation){case-180:case 180:e="mf-icon-rotate-flip";break;case-90:e="mf-icon-rotate-anti-clockwise";break;case 90:e="mf-icon-rotate-clockwise";break;case 0:break;default:throw new Error("Bad value for rotation given. Must be ±90, 0 or ±180.")}return e}getIconClasses(){const e=this.options.base,t=this.options.icon,s=this.options.isSmall,i=this.getRotationClass(),n=this.options.additionalClassNames;let a=e+" ";return t&&(a+=this.getGlyphClassName()+" "),s&&(a+="mf-icon--small "),n&&(a+=n+" "),a+i}get isTemplateMode(){return!0}get defaults(){return{base:"mf-icon",glyphPrefix:null,icon:"",rotation:0,isSmall:!1,additionalClassNames:null}}getClassName(){return this.$el.attr("class")}getGlyphClassName(){return this.options.glyphPrefix?"mf-icon-"+this.options.glyphPrefix+"-"+this.options.icon:"mf-icon-"+this.options.icon}get template(){return i.template('<span class="{{_iconClasses}}"> </span>')}}},"./src/mobile.startup/IconButton.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/View.js"),a=s("./src/mobile.startup/Icon.js");e.exports=class extends n{constructor(e){e.href&&(e.tagName="a"),"button"===e.tagName&&(e.isTypeButton=!0),super(e)}preRender(){this.options._buttonClasses=this.getButtonClasses(),this.options._iconHTML="",this.options.icon&&(this._icon=new a({base:this.options.base,glyphPrefix:this.options.glyphPrefix,icon:this.options.icon,rotation:this.options.rotation,isSmall:this.options.isSmall}),this.options._iconHTML=this._icon.$el.get(0).outerHTML)}getButtonClasses(){const e=this.options.additionalClassNames,t=this.options.size,s=this.options.weight,i=this.options.action,n=this.options.isIconOnly;let a="cdx-button ";return"button"!==this.options.tagName&&(a+="cdx-button--fake-button cdx-button--fake-button--enabled "),t&&(a+=`cdx-button--size-${t} `),s&&(a+=`cdx-button--weight-${s} `),i&&(a+=`cdx-button--action-${i} `),n&&(a+="cdx-button--icon-only "),a+e}get isTemplateMode(){return!0}get defaults(){return{tagName:"button",href:void 0,additionalClassNames:"",title:"",size:"large",weight:"quiet",action:"",isIconOnly:!0,disabled:!1,base:"mf-icon",icon:"",rotation:0,isSmall:!1}}getClassName(){return this.$el.attr("class")}getIcon(){return this._icon}get template(){return i.template('\n\t\t<{{tagName}}\n\t\t\ttype="button"\n\t\t\t{{#isTypeButton}}{{#disabled}}disabled{{/disabled}}{{/isTypeButton}}\n\t\t\tclass="{{_buttonClasses}}"\n\t\t\t{{#id}}id="{{id}}"{{/id}}\n\t\t\t{{#href}}href="{{href}}"{{/href}}\n\t\t\t{{#title}}title="{{title}}"{{/title}}>\n\t\t\t\t{{{_iconHTML}}}\n\t\t\t\t<span>{{label}}</span>\n\t\t</{{tagName}}>\n\t\t')}}},"./src/mobile.startup/Overlay.js":(e,t,s)=>{const i=s("./src/mobile.startup/View.js"),n=s("./src/mobile.startup/headers.js").header,a=s("./src/mobile.startup/Anchor.js"),r=s("./src/mobile.startup/util.js"),o=s("./src/mobile.startup/Browser.js").getSingleton();class l extends i{constructor(e){super(r.extend(!0,{headerChrome:!1,className:"overlay"},e,{events:r.extend({"click .cancel, .confirm, .initial-header .back":"onExitClick",click:e=>e.stopPropagation()},e.events)}))}get template(){return r.template('\n{{^noHeader}}\n<div class="overlay-header-container header-container{{#headerChrome}}\n\theader-chrome{{/headerChrome}} position-fixed">\n</div>\n{{/noHeader}}\n<div class="overlay-content">\n\t{{>content}}\n</div>\n<div class="overlay-footer-container position-fixed"></div>\n\t')}get isIos(){return o.isIos()}set hideTimeout(e){this._hideTimeout=e}get hideTimeout(){return this._hideTimeout}showSpinner(){this.$el.find(".spinner").removeClass("hidden")}hideSpinner(){this.$el.find(".spinner").addClass("hidden")}postRender(){const e=this.options.footerAnchor;this.$overlayContent=this.$el.find(".overlay-content"),this.isIos&&this.$el.addClass("overlay-ios"),e&&this.$el.find(".overlay-footer-container").append(new a(e).$el);const t=this.options.headers||[n(this.options.heading,this.options.headerActions)];this.$el.find(".overlay-header-container").append(t)}onExitClick(e){const t=()=>{this.hide()};e.preventDefault(),e.stopPropagation(),this.options.onBeforeExit?this.options.onBeforeExit(t,(()=>{})):t()}show(){const e=r.getDocument();this.scrollTop=window.pageYOffset,e.addClass("overlay-enabled"),window.scrollTo(0,1),this.$el.addClass("visible"),null!==this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}hide(){return r.getDocument().removeClass("overlay-enabled"),window.scrollTo(window.pageXOffset,this.scrollTop),this.hideTimeout=setTimeout((()=>{this.$el.detach(),this.hideTimeout=null}),0),this.emit("hide"),!0}showHidden(e){this.$el.find(".hideable").addClass("hidden"),this.$el.find(e).removeClass("hidden")}}function c(e){mw.log.warn("[1.44] Extending Overlay class constructor is deprecated. Please use Overlay.make"),i.ClassES5.call(this,r.extend(!0,{headerChrome:!1,className:"overlay"},e,{events:r.extend({"click .cancel, .confirm, .initial-header .back":"onExitClick",click:e=>e.stopPropagation()},e.events)}))}l.make=function(e,t){const s=new l(e);return s.$el.find(".overlay-content").append(t.$el),s},c.prototype=l.prototype,c.make=l.make,l.ClassES5=c,e.exports=l},"./src/mobile.startup/OverlayManager.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js");let n=null;const a="MobileFrontend OverlayManager was here!";class r{constructor(e,t){e.on("route",this._checkRoute.bind(this)),this.router=e,this.entries={},this.stack=[],this.hideCurrent=!0,this.container=t}_onHideOverlayOutsideOverlayManager(){if(!this.stack.length)return;const e=this.stack[0].route,t="string"==typeof e,s=this.router.getPath(),i=t&&s===e||s.match(e);this.hideCurrent=!1,i&&this.router.back()}_attachOverlay(e){e.$el.parents().length||this.container.appendChild(e.$el[0])}_show(e){window.history.replaceState(a,null,window.location.href),e.once("_om_hide",(()=>this._onHideOverlayOutsideOverlayManager())),this._attachOverlay(e),e.show()}_hideOverlay(e,t){let s;function i(){s=!0,e.hide()}return e.off("_om_hide"),e.options&&e.options.onBeforeExit?e.options.onBeforeExit(i,t):i(),s||e.once("_om_hide",(()=>this._onHideOverlayOutsideOverlayManager())),s}_processMatch(e){if(e)if(e.overlay)this._show(e.overlay);else{const t=e.factoryResult;t&&(e.overlay=t,o(e.overlay),this._show(t))}}_checkRoute(e){const t=this.stack[0];if(t||(this.scrollTop=window.pageYOffset),t&&void 0!==t.overlay&&this.hideCurrent&&!this._hideOverlay(t.overlay,(()=>{e.preventDefault()})))return;const s=Object.keys(this.entries).reduce(((t,s)=>t||this._matchRoute(e.path,this.entries[s])),null);s||(this.stack=[],window.scrollTo(window.pageXOffset,this.scrollTop)),this.hideCurrent=!0,this._processMatch(s)}_matchRoute(e,t){let s,i,n;const a=this.stack[1];"string"==typeof t.route?(s=t.route===e,i=[]):(n=e.match(t.route),s=!!n,i=s?n.slice(1):[]);const r=()=>({path:e,route:t.route,factoryResult:t.factory.apply(this,i)});if(s){if(a&&a.path===e)return this.stack.shift(),a;{const e=r();return this.stack[0]&&e.path===this.stack[0].path?this.stack[0]=e:this.stack.unshift(e),e}}return null}add(e,t){const s={route:e,factory:t};this.entries[e]=s,i.docReady((()=>this._processMatch(this._matchRoute(this.router.getPath(),s))))}replaceCurrent(e){if(0===this.stack.length)throw new Error("Trying to replace OverlayManager's current overlay, but stack is empty");const t=this.stack[0].overlay;t&&this._hideOverlay(t),this.stack[0].overlay=e,o(e),this._show(e)}static getSingleton(){if(!n){const e=require("mediawiki.router"),t=document.createElement("div"),s=e.getPath(),i=window.history.state;t.className="mw-overlays-container",document.body.appendChild(t),s&&i!==a&&(window.history.replaceState(null,null,"#"),window.history.pushState(a,null,`#${s}`)),n=new r(e,t)}return n}}function o(e){e.on("hide",(()=>e.emit("_om_hide")))}r.test={MANAGED_STATE:a,__clearCache:()=>{n=null}},e.exports=r},"./src/mobile.startup/Page.js":(e,t,s)=>{const i=mw.html,n=s("./src/mobile.startup/util.js");e.exports=class{constructor(e){const t=e.title||"";n.extend(this,{id:e.id||0,title:t,relevantTitle:e.relevantTitle||t,titleObj:e.titleObj,displayTitle:e.displayTitle||i.escape(t),namespaceNumber:e.namespaceNumber||0,protection:e.protection,url:e.url||mw.util.getUrl(t),wikidataDescription:e.wikidataDescription,_isMainPage:e.isMainPage||!1,isMissing:void 0!==e.isMissing?e.isMissing:0===e.id,anchor:e.anchor,revId:e.revId,_isWatched:e.isWatched,thumbnail:!!Object.prototype.hasOwnProperty.call(e,"thumbnail")&&e.thumbnail}),this.thumbnail&&this.thumbnail.width&&(this.thumbnail.isLandscape=this.thumbnail.width>this.thumbnail.height)}getDisplayTitle(){return this.displayTitle}inNamespace(e){return this.namespaceNumber===mw.config.get("wgNamespaceIds")[e]}isWikiText(){return"wikitext"===mw.config.get("wgPageContentModel")}isVEAvailable(){return!!mw.config.get("wgVisualEditorConfig")&&!mw.config.get("wgVisualEditorDisabledByHook")&&this.isWikiText()}isVEVisualAvailable(){return!!this.isVEAvailable()&&-1!==(mw.config.get("wgVisualEditorConfig").namespaces||[]).indexOf(mw.config.get("wgNamespaceNumber"))}isVESourceAvailable(){return this.isVEAvailable()&&mw.config.get("wgMFEnableVEWikitextEditor")}isMainPage(){return this._isMainPage}isWatched(){return this._isWatched}getRevisionId(){return this.revId}getTitle(){return this.title}getNamespaceId(){let e;const t=this.title.split(":");return e=t[1]&&mw.config.get("wgNamespaceIds")[t[0].toLowerCase().replace(" ","_")]||0,e}}},"./src/mobile.startup/PageHTMLParser.js":(e,t,s)=>{const i=s("./src/mobile.startup/Thumbnail.js"),n=mw.config.get("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).join(","),a=["noviewer","metadata"],r=a.map((e=>`:not(.${e})`)).join(""),o=["a.image","a.thumbimage, a.mw-file-description"].map((e=>`${e}${r}`)).join(",");class l{constructor(e){this.$el=e,this.$headings=this.$el.find(n)}findSectionHeadingByIndex(e){return e<1?$([]):this.$headings.filter('.mw-parser-output > *, [class^="mf-section-"] > *').eq(e-1)}findChildInSectionLead(e,t){let s,i;const a=n;function r(e){return e.find(t).addBack()}if(0===e){const e=this.getLeadSectionElement();if(e&&e.length){const s=e.find('section[data-mw-section-id="0"]');return s.length?r(s.children(t)):r(e.children(t))}return s=this.findSectionHeadingByIndex(1),s.length?r(s.prevAll(t)):this.$el.find(t)}if(s=this.findSectionHeadingByIndex(e),s.hasClass("section-heading")){const e=s.next();return i=e.find(a).eq(0),i.length?r(i.prevAll(t)):r(e.children(t))}return i=s.eq(0).nextAll(a).eq(0),s.nextUntil(i,t)}getLeadSectionElement(){const e=this.$el.find(".mf-section-0");return e.length?e:null}getThumbnail(e){const t="."+a.join(",."),s=e.find(".lazy-image-placeholder"),n=e.attr("href"),r=n&&new URL(n,location.href),o=r&&r.searchParams.get("title"),l=r&&r.pathname.match(/[^/]+$/);let c=0===e.parents(t).length&&0===e.find(t).length;return s.length&&c&&(c=!new RegExp("\\b("+a.join("|")+")\\b").test(s.data("class"))),c&&(null!==o||l)?new i({el:e,filename:mw.util.percentDecodeFragment(null!==o?o:l[0])}):null}getThumbnails(e){const t=[];return(e=e||this.$el).find(o).each(((s,i)=>{const n=e.find(i),a=this.getThumbnail(n);a&&t.push(a)})),t}getRedLinks(){return this.$el.find(".new")}getLanguages(e){const t=t=>{const s=t.textContent,i=t.getAttribute("data-language-local-name")||s,n=t.getAttribute("data-title")||e;return{lang:t.getAttribute("hreflang"),autonym:s,langname:i,title:n,url:t.getAttribute("href")}};return{languages:Array.prototype.map.call(document.querySelectorAll("#p-lang .interlanguage-link a"),t),variants:Array.prototype.map.call(document.querySelectorAll("#p-variants li a"),t)}}}l.HEADING_SELECTOR=n,l.THUMB_SELECTOR=o,e.exports=l},"./src/mobile.startup/PageList.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/View.js"),a=s("./src/mobile.startup/Browser.js").getSingleton();e.exports=class extends n{constructor(e){super(e)}get defaults(){return{pages:[]}}renderPageImages(){setTimeout((()=>{this.$el.find(".list-thumb").each(((e,t)=>{const s=this.$el.find(t).data("style");this.$el.find(t).attr("style",s)}))}),a.isWideScreen()?0:1e3)}postRender(){this.renderPageImages()}get template(){return i.template('\n<ul class="mw-mf-page-list thumbs actionable">\n\t{{#pages}}\n\t\t{{>item}}\n\t{{/pages}}\n</ul>\n\t')}get templatePartials(){return{item:i.template('\n\t<li title="{{title}}" data-id="{{id}}" class="page-summary">\n\t<a href="{{url}}" class="title {{#isMissing}}new{{/isMissing}}"\n\t\t{{#anchor}}name="{{anchor}}"{{/anchor}}\n\t\tdata-title="{{title}}">\n\t\t<div class="list-thumb\n\t\t{{#thumbnail.isLandscape}}list-thumb-y{{/thumbnail.isLandscape}}\n\t\t{{^thumbnail.isLandscape}}list-thumb-x{{/thumbnail.isLandscape}}"\n\t\t{{#thumbnail}}data-style="background-image: url( {{thumbnail.source}} )"{{/thumbnail}}>\n\t\t{{^thumbnail}}<span class="mf-icon-image"></span>{{/thumbnail}}\n\t\t</div>\n\t\t<h3>{{{displayTitle}}}</h3>\n\t\t{{#wikidataDescription}}\n\t\t<div class="wikidata-description">{{wikidataDescription}}</div>\n\t\t{{/wikidataDescription}}\n\t</a>\n\t</li>\n\t\t')}}}},"./src/mobile.startup/Skin.js":(e,t,s)=>{const i=s("./src/mobile.startup/Browser.js").getSingleton(),n=s("./src/mobile.startup/View.js"),a=s("./src/mobile.startup/util.js"),r=s("./src/mobile.startup/currentPage.js"),o=s("./src/mobile.startup/eventBusSingleton.js");let l;class c extends n{constructor(e){const t=a.extend({isBorderBox:!1},e);super(t),this.page=t.page,this.name=t.name,this.eventBus=t.eventBus}get defaults(){return{page:void 0}}postRender(){const e=this.$el;i.supportsTouchEvents()&&e.addClass("touch-events"),this.$el.find("#mw-mf-page-center").on("click",(e=>{this.emit("click",e)}))}getLicenseLinks(){const e=mw.message("mobile-frontend-license-links"),t=e.exists()&&e.text();return"qqx"===mw.config.get("wgUserLanguage")||t?e.parseDom():this.$el.find("#footer-info-copyright a").clone()}getLicenseMsg(){const e=this.getLicenseLinks();let t;if(e.length){const s=mw.language.convertNumber(e.filter("a").length);if(this.$el.find("#footer-places-terms-use").length>0){const i=mw.message("mobile-frontend-editor-terms-link",this.$el.find("#footer-places-terms-use a").attr("href")).parseDom();t=mw.message("mobile-frontend-editor-licensing-with-terms",i,e,s).parse()}else t=mw.message("mobile-frontend-editor-licensing",e,s).parse()}return t}}c.getSingleton=function(){return l||(l=new c({el:"body",page:r(),eventBus:o})),l},e.exports=c},"./src/mobile.startup/Thumbnail.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/View.js");e.exports=class extends n{constructor(e){super(i.extend({isBorderBox:!1},e))}get defaults(){return{filename:void 0}}postRender(){this.options.description=this.$el.siblings(".thumbcaption, figcaption").prop("innerText")||""}getDescription(){return this.options.description}getFileName(){return this.options.filename}}},"./src/mobile.startup/View.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=/^(\S+)\s*(.*)$/;let a=0;class r{constructor(e){this.initialize(e)}get template(){}get templatePartials(){return{}}get defaults(){return{}}get tagName(){return this.options.tagName||"div"}get isTemplateMode(){return!1}initialize(e){OO.EventEmitter.call(this),e=i.extend({},this.defaults,e),this.options=e,this.cid=function(e){const t=(++a).toString();return e?e+t:t}("view"),e.el?this.$el=$(e.el):this.$el=this.parseHTML("<"+this.tagName+">"),this.$el.length?this._postInitialize(e):i.docReady((()=>{this.$el=$(e.el),this._postInitialize(e)}))}_postInitialize(e){this.$el.addClass(e.className),!1!==e.isBorderBox&&this.$el.addClass("view-border-box"),this.render({})}preRender(){}postRender(){}render(e){let t,s;return i.extend(this.options,e),this.preRender(),this.undelegateEvents(),this.template&&!this.options.skipTemplateRender&&(s=this.template.render(this.options,this.templatePartials),this.isTemplateMode?(t=$(s),this.$el.replaceWith(t),this.$el=t):this.$el.html(s)),this.postRender(),this.delegateEvents(),this}delegateEvents(e){let t,s,i;if(e=e||this.options.events)for(s in this.undelegateEvents(),e)i=e[s],"function"!=typeof i&&(i=this[e[s]]),i&&(t=s.match(n),this.delegate(t[1],t[2],i.bind(this)))}delegate(e,t,s){this.$el.on(e+".delegateEvents"+this.cid,t,s)}undelegateEvents(){this.$el&&this.$el.off(".delegateEvents"+this.cid)}undelegate(e,t,s){this.$el.off(e+".delegateEvents"+this.cid,t,s)}parseHTML(e){return i.parseHTML(e,document)}static make(e={},t=[]){const s=new r(e);return t.forEach((e=>s.append(e))),s}}function o(e){mw.log.warn("[1.44] Extending View class constructor is deprecated. Please use View.make"),this.initialize(e)}OO.mixinClass(r,OO.EventEmitter),["append","prepend","appendTo","prependTo","after","before","insertAfter","insertBefore","remove","detach"].forEach((e=>{r.prototype[e]=function(){return this.$el[e].apply(this.$el,arguments),this}})),o.prototype=r.prototype,o.make=r.make,r.ClassES5=o,e.exports=r},"./src/mobile.startup/actionParams.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n={action:"query",formatversion:2};e.exports=function(e){const t=mw.config.get("wgMFScriptPath");return i.extend({},n,{origin:t?"*":void 0},e)}},"./src/mobile.startup/amcOutreach/AmcEnableForm.js":(e,t,s)=>{const i=s("./src/mobile.startup/Button.js"),n=s("./src/mobile.startup/util.js"),a=s("./src/mobile.startup/View.js");e.exports=class extends a{constructor(e){super(e)}get isTemplateMode(){return!0}get template(){return n.template('\n<form class="amc-enable-form" action="{{postUrl}}" method="POST">\n\t{{#fields}}\n\t\t<input type="hidden" name="{{name}}" value="{{value}}">\n\t{{/fields}}\n</form>\n\t\t')}postRender(){this.$el.append(new i({tagName:"button",progressive:!0,label:this.options.buttonLabel}).$el)}}},"./src/mobile.startup/amcOutreach/amcOutreach.js":(e,t,s)=>{const i=s("./src/mobile.startup/showOnPageReload.js"),n=s("./src/mobile.startup/promoCampaign/promoCampaign.js"),a=s("./src/mobile.startup/amcOutreach/amcOutreachDrawer.js"),r={onDesktopLink:"onDesktopLink",onHistoryLink:"onHistoryLink",onTalkLink:"onTalkLink"};let o;e.exports={loadCampaign:()=>o||(o=n(((e,t,s,n)=>a(e,o,mw.message,mw.util,i,mw.user.tokens.get("csrfToken"),t,s,n)),r,"amc-outreach",!!mw.config.get("wgMFAmcOutreachActive"),!!mw.config.get("wgMFAmcOutreachUserEligible"),mw.storage),o),ACTIONS:r}},"./src/mobile.startup/amcOutreach/amcOutreachDrawer.js":(e,t,s)=>{const i=s("./src/mobile.startup/Drawer.js"),n=s("./src/mobile.startup/Anchor.js"),a=s("./src/mobile.startup/util.js"),r=s("./src/mobile.startup/amcOutreach/AmcEnableForm.js");e.exports=function(e,t,s,o,l,c,d,h,u){return new i({className:"amc-outreach-drawer",children:[a.parseHTML("<div>").addClass("amc-outreach-image"),a.parseHTML("<p>").append(a.parseHTML("<strong>").text(s("mobile-frontend-amc-outreach-intro").text())),a.parseHTML("<p>").text(s("mobile-frontend-amc-outreach-description").text()),new r({postUrl:o.getUrl("Special:MobileOptions",{returnto:h,returntoquery:u||""}),fields:[{name:"updateSingleOption",value:"enableAMC"},{name:"enableAMC",value:"1"},{name:"token",value:c}],buttonLabel:s("mobile-frontend-amc-outreach-enable").text(),events:{submit:()=>{t.makeActionIneligible(e),l.showOnPageReload(s("mobile-frontend-amc-outreach-enabled-message").text())}}}).$el,new n({href:"#",additionalClassNames:"cancel",progressive:!0,label:s("mobile-frontend-amc-outreach-no-thanks").text()}).$el],onBeforeHide:()=>{t.makeActionIneligible(e),d()}})}},"./src/mobile.startup/currentPage.js":(e,t,s)=>{const i=s("./src/mobile.startup/Page.js");let n;e.exports=function(){if(n)return n;const e=[].concat(mw.config.get("wgRestrictionEdit",[])),t=mw.Title.newFromText(mw.config.get("wgRelevantPageName")),s=mw.Title.newFromText(mw.config.get("wgPageName"));return 0===e.length&&e.push("*"),n=new i({title:s.getPrefixedText(),titleObj:s,relevantTitle:t.getPrefixedText(),protection:{edit:e},revId:mw.config.get("wgRevisionId"),isMainPage:mw.config.get("wgIsMainPage"),isWatched:$("#ca-watch").hasClass("watched"),isMissing:0===mw.config.get("wgArticleId"),id:mw.config.get("wgArticleId"),namespaceNumber:mw.config.get("wgNamespaceNumber")}),n}},"./src/mobile.startup/currentPageHTMLParser.js":(e,t,s)=>{const i=s("./src/mobile.startup/PageHTMLParser.js");let n;e.exports=function(){return n||(n=new i($("#content #bodyContent")),n)}},"./src/mobile.startup/eventBusSingleton.js":e=>{e.exports=new OO.EventEmitter},"./src/mobile.startup/extendSearchParams.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/actionParams.js");e.exports=function(e){const t=mw.config.get("wgMFDisplayWikibaseDescriptions")||{search:!0,watchlist:!0,tagline:!1},s=mw.config.get("wgMFScriptPath");if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error('"'+e+"\" isn't a feature that shows Wikibase descriptions.");const a=Array.prototype.slice.call(arguments,1);a.unshift({prop:[]}),a.push(mw.config.get("wgMFSearchAPIParams"));const r=i.extend.apply({},a);return r.prop=r.prop.concat(mw.config.get("wgMFQueryPropModules")),t[e]&&-1===r.prop.indexOf("description")&&r.prop.push("description"),s&&(r.origin="*"),n(r)}},"./src/mobile.startup/headers.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/Button.js"),a=s("./src/mobile.startup/icons.js");function r(e,t,s,n){const r="string"==typeof e?e:void 0,o={hasActions:t&&t.length,isHidden:!1,heading:r},l=i.template(`\n<div class="overlay-header header ${n||""} hideable">\n\t<ul class="header-cancel">\n\t\t<li></li>\n\t</ul>\n\t{{{heading}}}\n\t{{#hasActions}}\n\t<div class="header-action"></div>\n\t{{/hasActions}}\n</div>\n\t\t`).render(o);s=s||a.cancel();const c=i.parseHTML(l);return c.find("h2 span").addClass("truncated-text"),c.find(".header-cancel li").append(s.$el),void 0===r&&e.$el.insertAfter(c.find(".header-cancel")),t&&t.length&&c.find(".header-action").append(t.map((e=>e.$el))),c[0]}function o(e,t,s,i){return r(e=`<div class="overlay-title"><h2>${e}</h2></div>`,t,s,i)}e.exports={savingHeader:function(e){return o(e,[a.spinner({additionalClassNames:"savespinner loading"})],a.cancel(),"saving-header hidden")},saveHeader:function(e,t){return o(e,[new n({tagName:"button",additionalClassNames:"save submit",disabled:!0,label:i.saveButtonMessage(),size:"large"})],a.back(),t)},formHeader:function(e,t,s,i){return r(e,t,s,i)},header:o}},"./src/mobile.startup/icons.js":(e,t,s)=>{const i="close",n=s("./src/mobile.startup/Icon.js"),a=s("./src/mobile.startup/IconButton.js"),r={CANCEL_GLYPH:i,Icon:n,IconButton:a,back:()=>new r.IconButton({tagName:"button",icon:"previous",additionalClassNames:"back",label:mw.msg("mobile-frontend-overlay-close")}),cancel(e,t={}){const s=e?`${i}-${e}`:`${i}`;return t.additionalClassNames=t.additionalClassNames||"",t.additionalClassNames+=" cancel",new r.IconButton(Object.assign({tagName:"button",icon:s,label:mw.msg("mobile-frontend-overlay-close")},t))},spinner(e={}){void 0===e.additionalClassNames&&(e.additionalClassNames="spinner loading");const t=new r.IconButton(Object.assign({tagName:"span",icon:"spinner",label:mw.msg("mobile-frontend-loading-message")},e));return t.$el.removeClass(),t.$el.addClass(e.additionalClassNames),t.$el.attr("type",""),t.options.isIconOnly&&t.$el.addClass("mf-spinner-icon-element"),t},error:()=>new r.IconButton({icon:"alert-invert",additionalClassNames:"load-fail-msg-icon"}),watch:(e={})=>(e.additionalClassNames=e.additionalClassNames||"",e.additionalClassNames+=" watch-this-article",new r.IconButton(Object.assign({icon:"star-subtle"},e))),watched:(e={})=>(e.additionalClassNames=e.additionalClassNames||"",e.additionalClassNames+=" watch-this-article watched",new r.IconButton(Object.assign({icon:"unStar-progressive"},e)))};e.exports=r},"./src/mobile.startup/lazyImages/lazyImageLoader.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n="lazy-image-placeholder";e.exports={placeholderClass:n,queryPlaceholders:function(e){return Array.prototype.slice.call(e.getElementsByClassName(n))},loadImages:function(t){return i.Promise.all(t.map((t=>e.exports.loadImage(t).promise)))},loadImage:function(e){const t=i.Deferred(),s=e.dataset.width,n=e.dataset.height,a=new Image;return s&&a.setAttribute("width",parseInt(s,10)),n&&a.setAttribute("height",parseInt(n,10)),a.className=e.dataset.class||"",a.alt=e.dataset.alt||"",a.useMap=e.dataset.usemap,a.style.cssText=e.style.cssText||"",a.addEventListener("load",(()=>{a.classList.add("image-lazy-loaded"),e.parentNode&&e.parentNode.replaceChild(a,e),t.resolve("load")}),{once:!0}),a.addEventListener("error",(()=>{e.parentNode&&e.parentNode.replaceChild(a,e),t.resolve("error")}),{once:!0}),a.src=e.dataset.src||"",a.srcset=e.dataset.srcset||"",{promise:t,image:a}},test:{placeholderClass:n}}},"./src/mobile.startup/moduleLoader.js":e=>{e.exports=class{constructor(){this._register={}}require(e){const t=this._register;function s(){if(!Object.hasOwnProperty.call(t,e))throw new Error("MobileFrontend Module not found: "+e);return t[e]}const i=e.split("/");try{const e=require(i[0]);return e[i[1]]?e[i[1]]:s()}catch(e){return s()}}define(e,t){if(Object.hasOwnProperty.call(this._register,e))throw new Error("Module already exists: "+e);return this._register[e]=t,{deprecate:s=>{this.deprecate(s,t,e)}}}deprecate(e,t,s){let i;s&&(i="Use "+s+" instead."),mw.log.deprecate(this._register,e,t,i)}}},"./src/mobile.startup/moduleLoaderSingleton.js":(e,t,s)=>{const i=s("./src/mobile.startup/moduleLoader.js");e.exports=new i},"./src/mobile.startup/page/pageJSONParser.js":(e,t,s)=>{const i=s("./src/mobile.startup/Page.js"),n=s("./src/mobile.startup/util.js");e.exports={parse:function(e){let t;const s=e.thumbnail,a=e.pageprops||{displaytitle:mw.html.escape(e.title)},r=e.terms||e.entityterms;return(a||r)&&(t=r&&r.label?mw.html.escape(r.label[0]):a.displaytitle),e.wikidataDescription=e.description||void 0,s&&(e.thumbnail.isLandscape=s.width>s.height),new i(n.extend(e,{id:e.pageid,isMissing:!!e.missing,url:mw.util.getUrl(e.title),displayTitle:t}))}}},"./src/mobile.startup/promoCampaign/promoCampaign.js":e=>{e.exports=function(e,t,s,i,n,a){const r={};for(const e in t){const i=t[e];r[i]=`mobile-frontend-${s}-ineligible-${i}`}function o(){return i}function l(e){if(!(e in t))throw new Error(`Action '${e}' not found in 'actions' object. Please add this to\n\t\t\t\tthe object when creating a campaign with promoCampaign.js if you believe\n\t\t\t\tthis is a valid action.`)}return{showIfEligible:(t,...s)=>function(e){return l(e),o()&&n&&null===a.get(r[e])}(t)?e(t,...s):null,makeActionIneligible:e=>(l(e),a.set(r[e],"~")),makeAllActionsIneligible(){let e,s;for(e in t)s=t[e],this.makeActionIneligible(s)},isCampaignActive:o}}},"./src/mobile.startup/showOnPageReload.js":e=>{const t="mobileFrontend/toast";mw.requestIdleCallback((function(){let e=mw.storage.get(t);e&&(e=JSON.parse(e),mw.notify(e.content,e.options),mw.storage.remove(t))})),e.exports={showOnPageReload:function(e,s){mw.storage.get(t)?mw.log.warn("A pending toast message already exits. The page should have been reloaded by now."):mw.storage.set(t,JSON.stringify({content:e,options:s}))}}},"./src/mobile.startup/util.js":e=>{e.exports={saveButtonMessage:()=>mw.config.get("wgEditSubmitButtonLabelPublish")?mw.msg("mobile-frontend-editor-publish"):mw.msg("mobile-frontend-editor-save"),Promise:{all:e=>$.when.apply($,e)},escapeSelector:e=>$.escapeSelector(e),docReady:e=>$(e),Deferred:()=>$.Deferred(),getDocument:()=>$(document.documentElement),getWindow:()=>$(window),parseHTML:(e,t)=>(t=t||document,$($.parseHTML(e,t))),extend(){return $.extend.apply($,arguments)},template:e=>({getSource:()=>e,render(t,s){const i={};return Object.keys(s||{}).forEach((e=>{i[e]=s[e].getSource()})),Mustache.render(e.trim(),t,i)}})}},"./src/mobile.startup/watchstar/WatchstarGateway.js":(e,t,s)=>{const i=s("./src/mobile.startup/util.js"),n=s("./src/mobile.startup/actionParams.js");e.exports=class{constructor(e){this.api=e}getStatuses(e,t){return i.Promise.all([this.getStatusesByID(e),this.getStatusesByTitle(t)]).then((function(){return i.extend.apply(i,arguments)}))}getStatusesByID(e){return e.length?this.api.get({formatversion:2,action:"query",prop:"info",inprop:"watched",pageids:e}).then((e=>this._unmarshalGetResponse(e))):i.Deferred().resolve({})}getStatusesByTitle(e){return e.length?this.api.get(n({prop:"info",inprop:"watched",titles:e})).then((e=>this._unmarshalGetResponse(e))):i.Deferred().resolve({})}postStatusesByTitle(e,t){const s={action:"watch",titles:e};return t||(s.unwatch=!t),this.api.postWithToken("watch",s)}_unmarshalGetResponse(e){return(e&&e.query&&e.query.pages||[]).reduce(((e,t)=>(e[t.title]=t.watched,e)),{})}}},"./src/mobile.startup/watchstar/WatchstarPageList.js":(e,t,s)=>{const i=s("./src/mobile.startup/PageList.js"),n=s("./src/mobile.startup/watchstar/watchstar.js"),a=mw.user,r=s("./src/mobile.startup/util.js"),o=s("./src/mobile.startup/Page.js"),l=s("./src/mobile.startup/watchstar/WatchstarGateway.js");e.exports=class extends i{constructor(e){super(e)}initialize(e){this.wsGateway=new l(e.api),super.initialize(e)}postRender(){const e=[],t=[];super.postRender();const s=this.queryUnitializedItems(),i=this.parsePagesFromItems(s);return Object.keys(i).forEach((s=>{const n=i[s];n&&"0"!==n?e.push(n):t.push(s)})),this.getPages(e,t).then((e=>this.renderItems(s,e)))}queryUnitializedItems(){return this.$el.find("li:not(.with-watchstar)")}getPages(e,t){return a.isAnon()?r.Deferred().resolve({}):this.wsGateway.getStatuses(e,t)}parsePagesFromItems(e){const t={};return e.each(((e,s)=>{const i=this.$el.find(s);t[i.attr("title")]=i.data("id")})),t}renderItems(e,t){a.isAnon()||e.each(((e,s)=>{const i=this.$el.find(s),n=new o({sections:[],title:i.attr("title"),id:i.data("id")}),a=t[n.getTitle()];this._appendWatchstar(i,n,a),i.addClass("with-watchstar")}))}_appendWatchstar(e,t,s){n({isWatched:s,page:t}).appendTo(e)}}},"./src/mobile.startup/watchstar/watchstar.js":(e,t,s)=>{const i=s("./src/mobile.startup/icons.js");e.exports=function(e){const t=e.isWatched,s=require("mediawiki.page.watch.ajax").watchstar,n=t?"unwatch":"watch",a={href:mw.Title.newFromText(e.page.title).getUrl({action:n})},r=i.watch(a),o=i.watched(a),l=r.getClassName(),c=o.getClassName(),d=r.getIcon().getClassName(),h=o.getIcon().getClassName(),u=t?o:r;return s(u.$el,e.page.title,((e,t)=>{e.attr("class",t?c:l),e.find(".mf-icon").attr("class",t?h:d)})),u}}}]);
//# sourceMappingURL=mobile.common.js.map.json