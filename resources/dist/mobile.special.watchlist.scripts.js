(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[601],{"./src/mobile.special.watchlist.scripts/ScrollEndEventEmitter.js":(t,s,e)=>{const i=e("./src/mobile.startup/util.js");class l{constructor(t,s){this.threshold=s||100,this.eventBus=t,this.enable(),OO.EventEmitter.call(this)}_bindScroll(){this._scrollHandler||(this._scrollHandler=()=>this._onScroll(),this.eventBus.on("scroll:throttled",this._scrollHandler))}_unbindScroll(){this._scrollHandler&&(this.eventBus.off("scroll:throttled",this._scrollHandler),this._scrollHandler=null)}_onScroll(){this.$el&&this.enabled&&this.scrollNearEnd()&&(this.disable(),this.emit(l.EVENT_SCROLL_END))}scrollNearEnd(){if(!this.$el||!this.$el.offset())return!1;const t=i.getWindow(),s=t.scrollTop()+t.height(),e=this.$el.offset().top+this.$el.outerHeight();return s+this.threshold>e}enable(){this.enabled=!0,this._bindScroll()}disable(){this.enabled=!1,this._unbindScroll()}setElement(t){this.$el=t}}OO.mixinClass(l,OO.EventEmitter),l.EVENT_SCROLL_END="ScrollEndEventEmitter-scrollEnd",t.exports=l},"./src/mobile.special.watchlist.scripts/WatchList.js":(t,s,e)=>{const i=e("./src/mobile.startup/PageList.js"),l=e("./src/mobile.startup/watchstar/WatchstarPageList.js"),r=e("./src/mobile.special.watchlist.scripts/ScrollEndEventEmitter.js"),a=e("./src/mobile.startup/util.js"),n=e("./src/mobile.special.watchlist.scripts/WatchListGateway.js");t.exports=class extends l{constructor(t){super(a.extend({},{isBorderBox:!1},t))}initialize(t){let s;this.scrollEndEventEmitter=new r(t.eventBus),this.scrollEndEventEmitter.on(r.EVENT_SCROLL_END,(()=>this._loadPages())),t.el&&(s=this.getLastTitle(t.el)),this.gateway=new n(t.api,s),super.initialize(t)}preRender(){this.scrollEndEventEmitter.disable(),this.scrollEndEventEmitter.setElement(this.$el)}postRender(){i.prototype.postRender.apply(this);const t=this.queryUnitializedItems(),s=Object.keys(this.parsePagesFromItems(t)).reduce(((t,s)=>(t[s]=!0,t)),{});this.renderItems(t,s),this.scrollEndEventEmitter.enable()}_loadPages(){this.gateway.loadWatchlist().then((t=>{t.forEach((t=>{this.appendPage(t)})),this.render()}))}appendPage(t){const s=a.extend({},t,{wikidataDescription:void 0});this.$el.append(this.templatePartials.item.render(s))}getLastTitle(t){return t.find("li").last().attr("title")}}},"./src/mobile.special.watchlist.scripts/WatchListGateway.js":(t,s,e)=>{const i=e("./src/mobile.startup/page/pageJSONParser.js"),l=e("./src/mobile.startup/util.js"),r=e("./src/mobile.startup/extendSearchParams.js");t.exports=class{constructor(t,s){this.api=t,this.limit=50,s?(this.continueParams={continue:"gwrcontinue||",gwrcontinue:"0|"+s.replace(/ /g,"_")},this.shouldSkipFirstTitle=!0):(this.continueParams={continue:""},this.shouldSkipFirstTitle=!1),this.canContinue=!0}loadWatchlist(){const t=r("watchlist",{prop:["info","revisions"],rvprop:"timestamp|user",generator:"watchlistraw",gwrnamespace:"0",gwrlimit:this.limit},this.continueParams);return!1===this.canContinue?l.Deferred().resolve([]):this.api.get(t).then((t=>(void 0!==t.continue?this.continueParams=t.continue:this.canContinue=!1,this.parseData(t))))}parseData(t){let s;return t.query&&t.query.pages?(s=t.query.pages,s.sort(((t,s)=>t.title===s.title?0:t.title<s.title?-1:1)),this.shouldSkipFirstTitle&&(s=s.slice(1),this.shouldSkipFirstTitle=!1),s.map(i.parse)):[]}}},"./src/mobile.special.watchlist.scripts/mobile.special.watchlist.scripts.js":(t,s,e)=>{const i=e("./src/mobile.special.watchlist.scripts/WatchList.js"),l=e("./src/mobile.startup/eventBusSingleton.js");$((()=>{!function(){const t=$("ul.mw-mf-watchlist-page-list");0===$(".mw-mf-watchlist-selector").length&&new i({api:new mw.Api,el:t,funnel:"watchlist",skipTemplateRender:!0,eventBus:l}),t.find(".mw-mf-watchlist-more").remove()}()}))}},t=>{t.O(0,[569],(()=>t(t.s="./src/mobile.special.watchlist.scripts/mobile.special.watchlist.scripts.js")));var s=t.O();(this.mfModules=this.mfModules||{})["mobile.special.watchlist.scripts"]=s}]);
//# sourceMappingURL=mobile.special.watchlist.scripts.js.map.json