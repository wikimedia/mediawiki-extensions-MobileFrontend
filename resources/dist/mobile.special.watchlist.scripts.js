(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[601],{"./src/mobile.special.watchlist.scripts/PageList.js":(t,s,e)=>{const i=e("./src/mobile.startup/util.js"),a=e("./src/mobile.startup/View.js"),r=e("./src/mobile.startup/Browser.js").getSingleton();t.exports=class extends a{constructor(t){super(t)}get defaults(){return{pages:[]}}renderPageImages(){setTimeout((()=>{this.$el.find(".list-thumb").each(((t,s)=>{const e=this.$el.find(s).data("style");this.$el.find(s).attr("style",e)}))}),r.isWideScreen()?0:1e3)}postRender(){this.renderPageImages()}get template(){return i.template('\n<ul class="mw-mf-page-list thumbs actionable">\n\t{{#pages}}\n\t\t{{>item}}\n\t{{/pages}}\n</ul>\n\t')}get templatePartials(){return{item:i.template('\n\t<li title="{{title}}" data-id="{{id}}" class="page-summary">\n\t<a href="{{url}}" class="title {{#isMissing}}new{{/isMissing}}"\n\t\t{{#anchor}}name="{{anchor}}"{{/anchor}}\n\t\tdata-title="{{title}}">\n\t\t<div class="list-thumb\n\t\t{{#thumbnail.isLandscape}}list-thumb-y{{/thumbnail.isLandscape}}\n\t\t{{^thumbnail.isLandscape}}list-thumb-x{{/thumbnail.isLandscape}}"\n\t\t{{#thumbnail}}data-style="background-image: url( {{thumbnail.source}} )"{{/thumbnail}}>\n\t\t{{^thumbnail}}<span class="mf-icon-image"></span>{{/thumbnail}}\n\t\t</div>\n\t\t<h3>{{{displayTitle}}}</h3>\n\t\t{{#wikidataDescription}}\n\t\t<div class="wikidata-description">{{wikidataDescription}}</div>\n\t\t{{/wikidataDescription}}\n\t</a>\n\t</li>\n\t\t')}}}},"./src/mobile.special.watchlist.scripts/ScrollEndEventEmitter.js":(t,s,e)=>{const i=e("./src/mobile.startup/util.js");class a{constructor(t,s){this.threshold=s||100,this.eventBus=t,this.enable(),OO.EventEmitter.call(this)}_bindScroll(){this._scrollHandler||(this._scrollHandler=()=>this._onScroll(),this.eventBus.on("scroll:throttled",this._scrollHandler))}_unbindScroll(){this._scrollHandler&&(this.eventBus.off("scroll:throttled",this._scrollHandler),this._scrollHandler=null)}_onScroll(){this.$el&&this.enabled&&this.scrollNearEnd()&&(this.disable(),this.emit(a.EVENT_SCROLL_END))}scrollNearEnd(){if(!this.$el||!this.$el.offset())return!1;const t=i.getWindow(),s=t.scrollTop()+t.height(),e=this.$el.offset().top+this.$el.outerHeight();return s+this.threshold>e}enable(){this.enabled=!0,this._bindScroll()}disable(){this.enabled=!1,this._unbindScroll()}setElement(t){this.$el=t}}OO.mixinClass(a,OO.EventEmitter),a.EVENT_SCROLL_END="ScrollEndEventEmitter-scrollEnd",t.exports=a},"./src/mobile.special.watchlist.scripts/WatchList.js":(t,s,e)=>{const i=e("./src/mobile.special.watchlist.scripts/PageList.js"),a=e("./src/mobile.special.watchlist.scripts/WatchstarPageList.js"),r=e("./src/mobile.special.watchlist.scripts/ScrollEndEventEmitter.js"),l=e("./src/mobile.startup/util.js"),n=e("./src/mobile.special.watchlist.scripts/WatchListGateway.js");t.exports=class extends a{constructor(t){super(l.extend({},{isBorderBox:!1},t))}initialize(t){let s;this.scrollEndEventEmitter=new r(t.eventBus),this.scrollEndEventEmitter.on(r.EVENT_SCROLL_END,(()=>this._loadPages())),t.el&&(s=this.getLastTitle(t.el)),this.gateway=new n(t.api,s),super.initialize(t)}preRender(){this.scrollEndEventEmitter.disable(),this.scrollEndEventEmitter.setElement(this.$el)}postRender(){i.prototype.postRender.apply(this);const t=this.queryUnitializedItems(),s=Object.keys(this.parsePagesFromItems(t)).reduce(((t,s)=>(t[s]=!0,t)),{});this.renderItems(t,s),this.scrollEndEventEmitter.enable()}_loadPages(){this.gateway.loadWatchlist().then((t=>{t.forEach((t=>{this.appendPage(t)})),this.render()}))}appendPage(t){const s=l.extend({},t,{wikidataDescription:void 0});this.$el.append(this.templatePartials.item.render(s))}getLastTitle(t){return t.find("li").last().attr("title")}}},"./src/mobile.special.watchlist.scripts/WatchListGateway.js":(t,s,e)=>{const i=e("./src/mobile.special.watchlist.scripts/pageJSONParser.js"),a=e("./src/mobile.startup/util.js"),r=e("./src/mobile.special.watchlist.scripts/extendSearchParams.js");t.exports=class{constructor(t,s){this.api=t,this.limit=50,s?(this.continueParams={continue:"gwrcontinue||",gwrcontinue:"0|"+s.replace(/ /g,"_")},this.shouldSkipFirstTitle=!0):(this.continueParams={continue:""},this.shouldSkipFirstTitle=!1),this.canContinue=!0}loadWatchlist(){const t=r("watchlist",{prop:["info","revisions"],rvprop:"timestamp|user",generator:"watchlistraw",gwrnamespace:"0",gwrlimit:this.limit},this.continueParams);return!1===this.canContinue?a.Deferred().resolve([]):this.api.get(t).then((t=>(void 0!==t.continue?this.continueParams=t.continue:this.canContinue=!1,this.parseData(t))))}parseData(t){let s;return t.query&&t.query.pages?(s=t.query.pages,s.sort(((t,s)=>t.title===s.title?0:t.title<s.title?-1:1)),this.shouldSkipFirstTitle&&(s=s.slice(1),this.shouldSkipFirstTitle=!1),s.map(i.parse)):[]}}},"./src/mobile.special.watchlist.scripts/WatchstarGateway.js":(t,s,e)=>{const i=e("./src/mobile.startup/util.js"),a=e("./src/mobile.startup/actionParams.js");t.exports=class{constructor(t){this.api=t}getStatuses(t,s){return i.Promise.all([this.getStatusesByID(t),this.getStatusesByTitle(s)]).then((function(){return i.extend.apply(i,arguments)}))}getStatusesByID(t){return t.length?this.api.get({formatversion:2,action:"query",prop:"info",inprop:"watched",pageids:t}).then((t=>this._unmarshalGetResponse(t))):i.Deferred().resolve({})}getStatusesByTitle(t){return t.length?this.api.get(a({prop:"info",inprop:"watched",titles:t})).then((t=>this._unmarshalGetResponse(t))):i.Deferred().resolve({})}postStatusesByTitle(t,s){const e={action:"watch",titles:t};return s||(e.unwatch=!s),this.api.postWithToken("watch",e)}_unmarshalGetResponse(t){return(t&&t.query&&t.query.pages||[]).reduce(((t,s)=>(t[s.title]=s.watched,t)),{})}}},"./src/mobile.special.watchlist.scripts/WatchstarPageList.js":(t,s,e)=>{const i=e("./src/mobile.special.watchlist.scripts/PageList.js"),a=e("./src/mobile.special.watchlist.scripts/watchstar.js"),r=mw.user,l=e("./src/mobile.startup/util.js"),n=e("./src/mobile.startup/Page.js"),c=e("./src/mobile.special.watchlist.scripts/WatchstarGateway.js");t.exports=class extends i{constructor(t){super(t)}initialize(t){this.wsGateway=new c(t.api),super.initialize(t)}postRender(){const t=[],s=[];super.postRender();const e=this.queryUnitializedItems(),i=this.parsePagesFromItems(e);return Object.keys(i).forEach((e=>{const a=i[e];a&&"0"!==a?t.push(a):s.push(e)})),this.getPages(t,s).then((t=>this.renderItems(e,t)))}queryUnitializedItems(){return this.$el.find("li:not(.with-watchstar)")}getPages(t,s){return r.isAnon()?l.Deferred().resolve({}):this.wsGateway.getStatuses(t,s)}parsePagesFromItems(t){const s={};return t.each(((t,e)=>{const i=this.$el.find(e);s[i.attr("title")]=i.data("id")})),s}renderItems(t,s){r.isAnon()||t.each(((t,e)=>{const i=this.$el.find(e),a=new n({sections:[],title:i.attr("title"),id:i.data("id")}),r=s[a.getTitle()];this._appendWatchstar(i,a,r),i.addClass("with-watchstar")}))}_appendWatchstar(t,s,e){a({isWatched:e,page:s}).appendTo(t)}}},"./src/mobile.special.watchlist.scripts/extendSearchParams.js":(t,s,e)=>{const i=e("./src/mobile.startup/util.js"),a=e("./src/mobile.startup/actionParams.js");t.exports=function(t){const s=mw.config.get("wgMFDisplayWikibaseDescriptions")||{watchlist:!0};if(!Object.prototype.hasOwnProperty.call(s,t))throw new Error('"'+t+"\" isn't a feature that shows Wikibase descriptions.");const e=Array.prototype.slice.call(arguments,1);e.unshift({prop:[]}),e.push(mw.config.get("wgMFSearchAPIParams"));const r=i.extend.apply({},e);return r.prop=r.prop.concat(mw.config.get("wgMFQueryPropModules")),s[t]&&-1===r.prop.indexOf("description")&&r.prop.push("description"),a(r)}},"./src/mobile.special.watchlist.scripts/mobile.special.watchlist.scripts.js":(t,s,e)=>{const i=e("./src/mobile.special.watchlist.scripts/WatchList.js"),a=e("./src/mobile.startup/eventBusSingleton.js");$((()=>{!function(){const t=$("ul.mw-mf-watchlist-page-list");0===$(".mw-mf-watchlist-selector").length&&new i({api:new mw.Api,el:t,funnel:"watchlist",skipTemplateRender:!0,eventBus:a}),t.find(".mw-mf-watchlist-more").remove()}()}))},"./src/mobile.special.watchlist.scripts/pageJSONParser.js":(t,s,e)=>{const i=e("./src/mobile.startup/Page.js"),a=e("./src/mobile.startup/util.js");t.exports={parse:function(t){let s;const e=t.thumbnail,r=t.pageprops||{displaytitle:mw.html.escape(t.title)},l=t.terms||t.entityterms;return(r||l)&&(s=l&&l.label?mw.html.escape(l.label[0]):r.displaytitle),t.wikidataDescription=t.description||void 0,e&&(t.thumbnail.isLandscape=e.width>e.height),new i(a.extend(t,{id:t.pageid,isMissing:!!t.missing,url:mw.util.getUrl(t.title),displayTitle:s}))}}},"./src/mobile.special.watchlist.scripts/watchstar.js":(t,s,e)=>{const i=e("./src/mobile.startup/icons.js");t.exports=function(t){const s=t.isWatched,e=require("mediawiki.page.watch.ajax").watchstar,a=s?"unwatch":"watch",r={href:mw.Title.newFromText(t.page.title).getUrl({action:a})},l=i.watch(r),n=i.watched(r),c=l.getClassName(),o=n.getClassName(),p=l.getIcon().getClassName(),h=n.getIcon().getClassName(),u=s?n:l;return e(u.$el,t.page.title,((t,s)=>{t.attr("class",s?o:c),t.find(".mf-icon").attr("class",s?h:p)})),u}}},t=>{t.O(0,[569],(()=>t(t.s="./src/mobile.special.watchlist.scripts/mobile.special.watchlist.scripts.js")));var s=t.O();(this.mfModules=this.mfModules||{})["mobile.special.watchlist.scripts"]=s}]);
//# sourceMappingURL=mobile.special.watchlist.scripts.js.map.json