{"version":3,"file":"mobile.init.js","mappings":"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","sources":["webpack://mfModules/./src/mobile.init/Toggler.js","webpack://mfModules/./src/mobile.init/editor.js","webpack://mfModules/./src/mobile.init/editorLoadingOverlay.js","webpack://mfModules/./src/mobile.init/fakeToolbar.js","webpack://mfModules/./src/mobile.init/isCollapsedByDefault.js","webpack://mfModules/./src/mobile.init/lazyLoadedImages.js","webpack://mfModules/./src/mobile.init/mobile.init.js","webpack://mfModules/./src/mobile.init/sectionCollapsing.js","webpack://mfModules/./src/mobile.init/toggling.js"],"sourcesContent":["const\n\tutil = require( '../mobile.startup/util' ),\n\tescapeSelector = util.escapeSelector,\n\tarrowOptions = {\n\t\ticon: 'expand',\n\t\tisSmall: true,\n\t\tadditionalClassNames: 'indicator'\n\t},\n\tIcon = require( '../mobile.startup/Icon' );\nconst isCollapsedByDefault = require( './isCollapsedByDefault.js' );\n\n/**\n * @typedef {Object} ToggledEvent\n * @prop {boolean} expanded True if section is opened, false if closed.\n * @prop {Page} page\n * @prop {jQuery.Object} $heading\n * @memberof module:mobile.startup\n * @ignore\n */\n\n/**\n * A class for enabling toggling\n *\n * Toggling can be disabled on a specific heading by adding the\n * collapsible-heading-button-disabled class (or collapsible-heading-disabled\n * for backward compatibility).\n */\nclass Toggler {\n\t/**\n\t * @param {Object} options\n\t * @param {OO.EventEmitter} options.eventBus Object used to emit section-toggled events.\n\t * @param {jQuery.Object} options.$container to apply toggling to\n\t * @param {string} options.prefix a prefix to use for the id.\n\t * @param {Page} options.page to allow storage of session for future visits\n\t */\n\tconstructor( options ) {\n\t\tthis.eventBus = options.eventBus;\n\t\tthis.$container = options.$container;\n\t\tthis.prefix = options.prefix;\n\t\tthis.page = options.page;\n\t\tthis._enable();\n\t}\n\n\t/**\n\t * Check if sections should be collapsed by default\n\t *\n\t * @return {boolean}\n\t */\n\tisCollapsedByDefault() {\n\t\tif ( this._isCollapsedByDefault === undefined ) {\n\t\t\t// These classes override site settings and user preferences. For example:\n\t\t\t// * ...-collapsed used on talk pages by DiscussionTools. (T321618, T322628)\n\t\t\t// * ...-expanded used in previews (T336572)\n\t\t\tconst $override = this.$container.closest( '.collapsible-headings-collapsed, .collapsible-headings-expanded' );\n\t\t\tif ( $override.length ) {\n\t\t\t\tthis._isCollapsedByDefault = $override.hasClass( 'collapsible-headings-collapsed' );\n\t\t\t} else {\n\t\t\t\t// Check site config\n\t\t\t\tthis._isCollapsedByDefault = isCollapsedByDefault();\n\t\t\t}\n\t\t}\n\t\treturn this._isCollapsedByDefault;\n\t}\n\n\t/**\n\t * Gets the heading element (h1-h6) if it exists, otherwise returns the wrapper\n\t *\n\t * @private\n\t * @param {HTMLElement} wrapperElement The wrapper element\n\t * @return {HTMLElement} The heading element or wrapper\n\t */\n\t_getHeadingTarget( wrapperElement ) {\n\t\tconst headingElement = wrapperElement.querySelector( 'h1, h2, h3, h4, h5, h6' );\n\t\treturn headingElement || wrapperElement;\n\t}\n\n\t/**\n\t * Given a heading, toggle it and any of its children\n\t *\n\t * @memberof Toggler\n\t * @instance\n\t * @param {jQuery.Object} $heading A heading belonging to a section\n\t * @param {boolean} fromSaved Section is being toggled from a saved state\n\t * @return {boolean}\n\t */\n\ttoggle( $heading, fromSaved ) {\n\t\tlet $button = $heading.data( 'button' ) || $heading.find( 'button.collapsible-heading-button' );\n\t\tif ( !$button.length ) {\n\t\t\t// TODO: Remove after 14 days\n\t\t\t// Backward compatibility: Old cached HTML has collapsible-heading on wrapper div\n\t\t\t// Fallback for headings without button (old structure)\n\t\t\t$button = $heading;\n\t\t}\n\n\t\t// TODO: Remove after 14 days\n\t\t// Backward compatibility: Old cached HTML may have collapsible-heading-disabled\n\t\tif ( !fromSaved && ( $button.hasClass( 'collapsible-heading-button-disabled' ) || $button.hasClass( 'collapsible-heading-disabled' ) ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Get the target element (heading element or wrapper for backward compatibility)\n\t\tconst target = this._getHeadingTarget( $heading[0] );\n\n\t\tconst wasExpanded = target.classList.contains( 'open-block' );\n\n\t\ttarget.classList.toggle( 'open-block' );\n\t\t// Ensure collapsible-heading class is present on heading element\n\t\ttarget.classList.add( 'collapsible-heading' );\n\n\t\tarrowOptions.rotation = wasExpanded ? 0 : 180;\n\t\tconst newIndicator = new Icon( arrowOptions );\n\t\tconst $indicatorElement = $heading.data( 'indicator' ) || $button.find( '.indicator' );\n\t\tif ( $indicatorElement && $indicatorElement.length ) {\n\t\t\t$indicatorElement.replaceWith( newIndicator.$el );\n\t\t\t$heading.data( 'indicator', newIndicator.$el );\n\t\t}\n\n\t\t$button.attr( 'aria-expanded', !wasExpanded ? 'true' : 'false' );\n\n\t\tconst $content = $heading.next();\n\t\tif ( $content.hasClass( 'open-block' ) ) {\n\t\t\t$content.removeClass( 'open-block' );\n\t\t\t// jquery doesn't allow custom values for the hidden attribute it seems.\n\t\t\t$content.get( 0 ).setAttribute( 'hidden', 'until-found' );\n\t\t} else {\n\t\t\t$content.addClass( 'open-block' );\n\t\t\t$content.removeAttr( 'hidden' );\n\t\t}\n\n\t\t/* T239418 We consider this event as a low-priority one and emit it asynchronously.\n\t\tThis ensures that any logic associated with section toggling is async and not contributing\n\t\tdirectly to a slow click/press event handler.\n\n\t\tCurrently costly reflow-inducing viewport size computation is being done for lazy-loaded\n\t\timages by the main listener to this event. */\n\t\tmw.requestIdleCallback( () => {\n\n\t\t\t/**\n\t\t\t * Internal for use inside ReaderExperiments\n\t\t\t *\n\t\t\t * @event ~'readerExperiments.section-toggled'\n\t\t\t * @memberof Hooks\n\t\t\t */\n\t\t\tmw.hook( 'readerExperiments.section-toggled' ).fire( {\n\t\t\t\theading: $heading.get( 0 ),\n\t\t\t\tisExpanded: !wasExpanded\n\t\t\t} );\n\t\t} );\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Reveals an element and its parent section as identified by it's id\n\t *\n\t * @memberof Toggler\n\t * @instance\n\t * @param {string} id An element ID within the $container\n\t * @return {boolean} Target ID was found\n\t */\n\treveal( id ) {\n\t\tlet $target;\n\t\t// jQuery will throw for hashes containing certain characters which can break toggling\n\t\ttry {\n\t\t\t$target = this.$container.find( '#' + escapeSelector( id ) );\n\t\t} catch ( e ) {}\n\t\tif ( !$target || !$target.length ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// TODO: Remove after 14 days\n\t\t// Backward compatibility: Old cached HTML has .collapsible-heading on wrapper div\n\t\t// Old structure: <div class=\"section-heading collapsible-heading\">...</div>\n\t\tlet $heading = $target.parents( '.collapsible-heading, .section-heading' );\n\n\t\t// The heading is not a section heading, check if in a content block!\n\t\tif ( !$heading.length ) {\n\t\t\t$heading = $target.parents( '.collapsible-block' ).prev( '.section-heading' );\n\t\t}\n\t\tif ( $heading.length ) {\n\t\t\tconst $button = $heading.data( 'button' ) || $heading.find( 'button.collapsible-heading-button' );\n\t\t\t// TODO: Remove after 14 days\n\t\t\t// Backward compatibility: Old cached HTML - check heading directly if no button\n\t\t\tif ( $button.length ) {\n\t\t\t\tconst headingTarget = this._getHeadingTarget( $heading[0] );\n\t\t\t\tif ( !headingTarget.classList.contains( 'open-block' ) ) {\n\t\t\t\t\tthis.toggle( $heading );\n\t\t\t\t}\n\t\t\t} else if ( $heading.hasClass( 'collapsible-heading' ) && !$heading.hasClass( 'open-block' ) ) {\n\t\t\t\t// Old structure: heading has collapsible-heading class directly\n\t\t\t\tthis.toggle( $heading );\n\t\t\t}\n\t\t}\n\t\tif ( $heading.length ) {\n\t\t\t// scroll again after opening section (opening section makes the page longer)\n\t\t\twindow.scrollTo( 0, $target.offset().top );\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Creates a button element inside a heading to preserve heading semantics.\n\t * Following W3C ARIA accordion pattern: https://www.w3.org/WAI/ARIA/apg/patterns/accordion/examples/accordion/\n\t *\n\t * @private\n\t * @param {HTMLElement} wrapperElement The wrapper element\n\t * @param {string} id The ID for aria-controls\n\t * @param {boolean} initiallyCollapsed Whether the section starts collapsed\n\t * @param {jQuery.Object} $serverIndicator Optional server-rendered indicator to reuse\n\t * @return {HTMLElement} The created button element\n\t */\n\t_createHeadingButton( wrapperElement, id, initiallyCollapsed, $serverIndicator ) {\n\t\t// Find the actual heading element (h1-h6) inside the wrapper using _getHeadingTarget\n\t\tconst headingElement = this._getHeadingTarget( wrapperElement );\n\t\t// If _getHeadingTarget returned the wrapper itself, no heading element exists\n\t\tif ( headingElement === wrapperElement ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst button = document.createElement( 'button' );\n\t\tbutton.classList.add( 'collapsible-heading-button' );\n\t\tbutton.type = 'button';\n\t\tbutton.setAttribute( 'aria-controls', id );\n\t\tbutton.setAttribute( 'aria-expanded', initiallyCollapsed ? 'false' : 'true' );\n\n\t\t// Create indicator with correct rotation state\n\t\tarrowOptions.rotation = !initiallyCollapsed ? 180 : 0;\n\t\tconst indicator = new Icon( arrowOptions );\n\n\t\tif ( $serverIndicator && $serverIndicator.length ) {\n\t\t\t// Replace server-rendered indicator with new Icon instance\n\t\t\t$serverIndicator.replaceWith( indicator.$el );\n\t\t}\n\t\tbutton.insertBefore( indicator.$el[0], button.firstChild );\n\n\t\tArray.from( headingElement.childNodes ).forEach( ( node ) => {\n\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\t\t\t\tbutton.appendChild( document.createTextNode( node.textContent ) );\n\t\t\t} else if ( node.nodeType === Node.ELEMENT_NODE ) {\n\t\t\t\tif ( node.tagName === 'A' ) {\n\t\t\t\t\tbutton.appendChild( node );\n\t\t\t\t} else if ( !node.classList.contains( 'indicator' ) ) {\n\t\t\t\t\tbutton.appendChild( node );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t\theadingElement.innerHTML = '';\n\t\theadingElement.appendChild( button );\n\t\treturn button;\n\t}\n\n\t/**\n\t * Enables section toggling in a given container.\n\t *\n\t * @memberof Toggler\n\t * @instance\n\t * @private\n\t */\n\t_enable() {\n\n\t\t// FIXME This should use .find() instead of .children(), some extensions like Wikibase\n\t\t// want to toggle other headlines than direct descendants of $container. (T95889)\n\t\tthis.$container.children( '.section-heading' ).each( ( i, headingEl ) => {\n\t\t\tconst $heading = this.$container.find( headingEl ),\n\t\t\t\t$indicator = $heading.find( '.indicator' ),\n\t\t\t\tid = this.prefix + 'collapsible-block-' + i;\n\t\t\t// Be sure there is a `section` wrapping the section content.\n\t\t\t// Otherwise, collapsible sections for this page is not enabled.\n\t\t\tif ( $heading.next().is( 'section' ) ) {\n\t\t\t\tconst $content = $heading.next( 'section' );\n\t\t\t\tconst initiallyCollapsed = this.isCollapsedByDefault();\n\n\t\t\t\tlet $button = $heading.find( 'button.collapsible-heading-button' );\n\t\t\t\t// Get the target element (heading element or wrapper for backward compatibility)\n\t\t\t\tconst target = this._getHeadingTarget( $heading[0] );\n\t\t\t\t// Check if content or heading element is already expanded from cached HTML\n\t\t\t\tconst isExpanded = $content.hasClass( 'open-block' ) || target.classList.contains( 'open-block' );\n\n\t\t\t\tif ( !$button.length ) {\n\t\t\t\t\t// Use existing expanded state if available, otherwise use default\n\t\t\t\t\tconst shouldBeCollapsed = isExpanded ? false : initiallyCollapsed;\n\t\t\t\t\tthis._createHeadingButton( $heading[0], id, shouldBeCollapsed, $indicator );\n\t\t\t\t\t$button = $heading.find( 'button.collapsible-heading-button' );\n\t\t\t\t} else {\n\t\t\t\t\t// Button already exists (from previous run or cached HTML)\n\t\t\t\t\t// Clean up any duplicate server-rendered indicators outside the button\n\t\t\t\t\tconst $buttonIndicator = $button.find( '.indicator' ).first();\n\t\t\t\t\tif ( $buttonIndicator.length ) {\n\t\t\t\t\t\t$heading.find( '.indicator' ).not( $buttonIndicator ).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttarget.classList.add( 'collapsible-heading' );\n\n\t\t\t\t$heading\n\t\t\t\t\t.data( 'section-number', i )\n\t\t\t\t\t.data( 'button', $button );\n\n\t\t\t\t// TODO: Remove after 14 days\n\t\t\t\t// Backward compatibility: Old cached HTML has click handler on wrapper div\n\t\t\t\t// If no button found, use wrapper div (old structure)\n\t\t\t\tif ( !$button.length && $heading.hasClass( 'collapsible-heading' ) ) {\n\t\t\t\t\t$button = $heading;\n\t\t\t\t}\n\n\t\t\t\t$button.on( 'click', ( ev ) => {\n\t\t\t\t\t// Don't toggle if clicking a link.\n\t\t\t\t\t// Headings with links are still collapsible - click elsewhere to toggle.\n\t\t\t\t\t// See T117880\n\t\t\t\t\tconst clickedLink = ev.target.closest( 'a' );\n\t\t\t\t\tif ( !clickedLink ) {\n\t\t\t\t\t\t// prevent taps/clicks on edit button after toggling (T58209)\n\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\tthis.toggle( $heading );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tconst $indicatorElement = $button.find( '.indicator' ).first();\n\t\t\t\t$heading.data( 'indicator', $indicatorElement );\n\t\t\t\t$content\n\t\t\t\t\t.addClass( 'collapsible-block' )\n\t\t\t\t\t.attr( {\n\t\t\t\t\t\t// We need to give each content block a unique id as that's\n\t\t\t\t\t\t// the only way we can tell screen readers what element we're\n\t\t\t\t\t\t// referring to via `aria-controls`.\n\t\t\t\t\t\tid\n\t\t\t\t\t} )\n\t\t\t\t\t.on( 'beforematch', () => this.toggle( $heading ) )\n\t\t\t\t\t.addClass( 'collapsible-block-js' );\n\n\t\t\t\t// Respect existing expanded state from cached HTML\n\t\t\t\tif ( isExpanded ) {\n\t\t\t\t\ttarget.classList.add( 'open-block' );\n\t\t\t\t\t$content.addClass( 'open-block' );\n\t\t\t\t\t$content.removeAttr( 'hidden' );\n\t\t\t\t} else if ( initiallyCollapsed ) {\n\t\t\t\t\t$content.get( 0 ).setAttribute( 'hidden', 'until-found' );\n\t\t\t\t} else {\n\t\t\t\t\ttarget.classList.add( 'open-block' );\n\t\t\t\t\t$content.addClass( 'open-block' );\n\t\t\t\t}\n\n\t\t\t\t$button.attr( 'aria-expanded', ( isExpanded || !initiallyCollapsed ) ? 'true' : 'false' );\n\t\t\t}\n\t\t} );\n\n\t\t/**\n\t\t * Checks the existing hash and toggles open any section that contains the fragment.\n\t\t *\n\t\t * @method\n\t\t */\n\t\tconst checkHash = () => {\n\t\t\t// eslint-disable-next-line no-restricted-properties\n\t\t\tlet hash = window.location.hash;\n\t\t\tif ( hash.indexOf( '#' ) === 0 ) {\n\t\t\t\thash = hash.slice( 1 );\n\t\t\t\t// Per https://html.spec.whatwg.org/multipage/browsing-the-web.html#target-element\n\t\t\t\t// we try the raw fragment first, then the percent-decoded fragment.\n\t\t\t\tif ( !this.reveal( hash ) ) {\n\t\t\t\t\tconst decodedHash = mw.util.percentDecodeFragment( hash );\n\t\t\t\t\tif ( decodedHash ) {\n\t\t\t\t\t\tthis.reveal( decodedHash );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Checks the value of wgInternalRedirectTargetUrl and sets the hash if present.\n\t\t * checkHash() will reveal the collapsed section that contains it afterwards.\n\t\t *\n\t\t * @method\n\t\t */\n\t\tfunction checkInternalRedirectAndHash() {\n\t\t\tconst internalRedirect = mw.config.get( 'wgInternalRedirectTargetUrl' ),\n\t\t\t\tinternalRedirectHash = internalRedirect ? internalRedirect.split( '#' )[1] : false;\n\n\t\t\tif ( internalRedirectHash ) {\n\t\t\t\t// eslint-disable-next-line no-restricted-properties\n\t\t\t\twindow.location.hash = internalRedirectHash;\n\t\t\t}\n\t\t}\n\n\t\tcheckInternalRedirectAndHash();\n\t\tcheckHash();\n\n\t\tutil.getWindow().on( 'hashchange', () => checkHash() );\n\t}\n}\n\nmodule.exports = Toggler;\n","/* global $ */\nconst\n\tutil = require( '../mobile.startup/util' ),\n\tfakeToolbar = require( './fakeToolbar' ),\n\teditorLoadingOverlay = require( './editorLoadingOverlay' ),\n\tOverlayManager = require( '../mobile.startup/OverlayManager' ),\n\t// #ca-edit, .mw-editsection are standard MediaWiki elements\n\t// .edit-link can be added to links anywhere to trigger the editor (e.g. MobileFrontend\n\t// user page creation CTA, edit-full-page overflow menu item)\n\t// Links in content are handled separately to allow reloading the content (T324686)\n\t$editTab = $( '#ca-edit, #ca-editsource, #ca-viewsource, #ca-ve-edit, #ca-ve-create, #ca-createsource' ),\n\thasTwoEditIcons = $editTab.length > 1,\n\tEDITSECTION_SELECTOR = '.mw-editsection a, .edit-link',\n\tuser = mw.user,\n\tCtaDrawer = require( '../mobile.startup/CtaDrawer' ),\n\tveConfig = mw.config.get( 'wgVisualEditorConfig' ),\n\teditorPath = /^\\/editor\\/(\\d+|T-\\d+|all)$/;\n\nlet editorOverride = null;\n\n/**\n * Event handler for edit link clicks. Will prevent default link\n * behaviour and will not allow propagation\n *\n * @method\n * @ignore\n * @param {HTMLElement} elem\n * @param {jQuery.Event} ev\n * @param {Router} router\n */\nfunction onEditLinkClick( elem, ev, router ) {\n\tlet section;\n\tif ( $( EDITSECTION_SELECTOR ).length === 0 ) {\n\t\t// If section edit links are not available, the only edit link\n\t\t// should allow editing the whole page (T232170)\n\t\tsection = 'all';\n\t} else {\n\t\tsection = mw.util.getParamValue( 'section', elem.href ) || 'all';\n\t}\n\t// Don't do anything for section edit links for different pages (transcluded)\n\tif ( mw.config.get( 'wgPageName' ) !== mw.util.getParamValue( 'title', elem.href ) ) {\n\t\treturn;\n\t}\n\tif ( hasTwoEditIcons ) {\n\t\tif ( elem.id === 'ca-ve-edit' || elem.id === 'ca-ve-create' ) {\n\t\t\t// \"Edit\" tab loads the visual editor\n\t\t\teditorOverride = 'VisualEditor';\n\t\t} else if ( elem.id === 'ca-editsource' || elem.id === 'ca-createsource' ) {\n\t\t\t// \"Edit source\" tab loads the source editor\n\t\t\teditorOverride = 'SourceEditor';\n\t\t} else {\n\t\t\t// Any other edit links (e.g. for sections) load the preferred editor\n\t\t}\n\t}\n\trouter.navigate( '#/editor/' + section );\n\t// DO NOT USE stopPropagation or you'll break click tracking in WikimediaEvents\n\t// You DO NOT NEED to\n\t// prevent folding section when clicking Edit by stopping propagation\n\t// as this is a concern of the Toggler class and taken care of by inspecting\n\t// !ev.target.href (see Toggler.js)\n\t// avoid navigating to ?action=edit\n\tev.preventDefault();\n}\n\n/**\n * Retrieve the user's preferred editor setting. If none is set, return the default\n * editor for this wiki.\n *\n * @method\n * @ignore\n * @return {string} Either 'VisualEditor' or 'SourceEditor'\n */\nfunction getPreferredEditor() {\n\tif ( editorOverride ) {\n\t\t// Temporary override, set via the URL for this request\n\t\t// or by clicking the chosen mode when both tabs are shown\n\t\treturn editorOverride;\n\t}\n\tconst preferredEditor = mw.user.options.get( 'mobile-editor' ) || mw.storage.get( 'preferredEditor' );\n\tif ( preferredEditor ) {\n\t\treturn preferredEditor;\n\t}\n\tswitch ( mw.config.get( 'wgMFDefaultEditor' ) ) {\n\t\tcase 'source':\n\t\t\treturn 'SourceEditor';\n\t\tcase 'visual':\n\t\t\treturn 'VisualEditor';\n\t\tcase 'preference':\n\t\t\t// First check if the user has actually used the desktop editor.\n\t\t\t// This is done hackily by checking if they have the preference\n\t\t\t// set to suppress the welcome dialog or user education popups. (T261423)\n\t\t\tif ( mw.user.options.get( 'visualeditor-hidebetawelcome' ) || mw.user.options.get( 'visualeditor-hideusered' ) ) {\n\t\t\t\treturn mw.user.options.get( 'visualeditor-editor' ) === 'visualeditor' ? 'VisualEditor' : 'SourceEditor';\n\t\t\t} else {\n\t\t\t\t// When there is no desktop preference, we use MFFallbackEditor.\n\t\t\t\treturn mw.config.get( 'wgMFFallbackEditor' ) === 'visual' ? 'VisualEditor' : 'SourceEditor';\n\t\t\t}\n\t}\n\t// In the event of misconfiguration, fall back to source\n\treturn 'SourceEditor';\n}\n\n/**\n * Initialize the edit button so that it launches the editor interface when clicked.\n *\n * @method\n * @ignore\n * @param {Page} page The page to edit.\n * @param {Skin} skin\n * @param {module:mobile.startup/PageHTMLParser} currentPageHTMLParser\n * @param {Router} router\n */\nfunction setupEditor( page, skin, currentPageHTMLParser, router ) {\n\tconst\n\t\toverlayManager = OverlayManager.getSingleton(),\n\t\tisNewPage = page.id === 0;\n\n\t$editTab.add( '.edit-link' ).on( 'click.mfeditlink', function ( ev ) {\n\t\tonEditLinkClick( this, ev, overlayManager.router );\n\t} );\n\tmw.hook( 'wikipage.content' ).add( ( $content ) => {\n\t\t// make sure that any .edit-link links in here don't get double-handled\n\t\t$content.find( EDITSECTION_SELECTOR ).off( 'click.mfeditlink' ).on( 'click.mfeditlink', function ( ev ) {\n\t\t\tonEditLinkClick( this, ev, overlayManager.router );\n\t\t} );\n\t} );\n\n\toverlayManager.add( editorPath, ( sectionId ) => {\n\t\tconst\n\t\t\tscrollTop = window.pageYOffset,\n\t\t\t$contentText = $( '#mw-content-text' ),\n\t\t\turl = new URL( location.href ),\n\t\t\teditorOptions = {\n\t\t\t\tfakeToolbar,\n\t\t\t\toverlayManager,\n\t\t\t\tcurrentPageHTMLParser,\n\t\t\t\tfakeScroll: 0,\n\t\t\t\tapi: new mw.Api(),\n\t\t\t\tlicenseMsg: skin.getLicenseMsg(),\n\t\t\t\ttitle: page.title,\n\t\t\t\ttitleObj: page.titleObj,\n\t\t\t\tisAnon: user.isAnon(),\n\t\t\t\tisNewPage,\n\t\t\t\toldId: mw.util.getParamValue( 'oldid' ),\n\t\t\t\tcontentLang: $contentText.attr( 'lang' ),\n\t\t\t\tcontentDir: $contentText.attr( 'dir' ),\n\t\t\t\t// Arrange preload content if we're on a page with those URL parameters\n\t\t\t\tpreload: url.searchParams.get( 'preload' ),\n\t\t\t\tpreloadparams: mw.util.getArrayParam( 'preloadparams', url.searchParams ),\n\t\t\t\teditintro: url.searchParams.get( 'editintro' )\n\t\t\t},\n\t\t\tvisualAbortPromise = $.Deferred();\n\n\t\tconst animationDelayDeferred = util.Deferred();\n\n\t\tlet abortableDataPromise, overlayPromise,\n\t\t\tinitMechanism = mw.util.getParamValue( 'redlink' ) ? 'new' : 'click';\n\n\t\tif ( sectionId !== 'all' ) {\n\t\t\teditorOptions.sectionId = page.isWikiText() ? sectionId : undefined;\n\t\t}\n\n\t\tfunction showLoading() {\n\t\t\tlet $sectionTop, fakeScroll, enableVisualSectionEditing;\n\n\t\t\t$( document.body ).addClass( 've-loading' );\n\n\t\t\tconst $page = $( '#mw-mf-page-center' );\n\t\t\tconst $content = $( '#content' );\n\t\t\tif ( sectionId === '0' || sectionId === 'all' ) {\n\t\t\t\t$sectionTop = $( '#bodyContent' );\n\t\t\t} else {\n\t\t\t\t$sectionTop = $(\n\t\t\t\t\t// ends with section=N\n\t\t\t\t\t'a[href$=\"section=' + sectionId + '\"],' +\n\t\t\t\t\t// contains section=N&...\n\t\t\t\t\t'a[href*=\"section=' + sectionId + '&\"]'\n\t\t\t\t).closest( '.mw-heading, h1, h2, h3, h4, h5, h6' );\n\t\t\t\t// When loading on action=edit URLs, there is no page content\n\t\t\t\tif ( !$sectionTop.length ) {\n\t\t\t\t\t$sectionTop = $( '#bodyContent' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Pretend that we didn't just scroll the page to the top.\n\t\t\t$page.prop( 'scrollTop', scrollTop );\n\t\t\t// Then, pretend that we're scrolling to the position of the clicked heading.\n\t\t\tfakeScroll = $sectionTop[0].getBoundingClientRect().top;\n\t\t\t// Adjust for height of the toolbar.\n\t\t\tfakeScroll -= 48;\n\t\t\tif ( shouldLoadVisualEditor() ) {\n\t\t\t\tenableVisualSectionEditing = veConfig.enableVisualSectionEditing === true ||\n\t\t\t\t\t// === ve.init.mw.MobileArticleTarget.static.trackingName\n\t\t\t\t\tveConfig.enableVisualSectionEditing === 'mobile';\n\t\t\t\tif ( sectionId === '0' || sectionId === 'all' || enableVisualSectionEditing ) {\n\t\t\t\t\t// Adjust for surface padding. Only needed if we're at the beginning of the doc.\n\t\t\t\t\tfakeScroll -= 16;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( sectionId === '0' || sectionId === 'all' ) {\n\t\t\t\t\tfakeScroll -= 16;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$content.css( {\n\t\t\t\t// Use transform instead of scroll for smoother animation (via CSS transitions).\n\t\t\t\ttransform: 'translate( 0, ' + -fakeScroll + 'px )',\n\t\t\t\t// If the clicked heading is near the end of the page, we might need to insert\n\t\t\t\t// some extra space to allow us to scroll \"beyond the end\" of the page.\n\t\t\t\t'padding-bottom': '+=' + fakeScroll,\n\t\t\t\t'margin-bottom': '-=' + fakeScroll\n\t\t\t} );\n\t\t\teditorOptions.fakeScroll = fakeScroll;\n\t\t\tsetTimeout( animationDelayDeferred.resolve, 500 );\n\t\t}\n\n\t\tfunction clearLoading() {\n\t\t\tif ( abortableDataPromise && abortableDataPromise.abort ) {\n\t\t\t\tabortableDataPromise.abort();\n\t\t\t}\n\n\t\t\t$( '#content' ).css( {\n\t\t\t\ttransform: '',\n\t\t\t\t'padding-bottom': '',\n\t\t\t\t'margin-bottom': ''\n\t\t\t} );\n\n\t\t\t$( document.body ).removeClass( 've-loading' );\n\t\t}\n\n\t\tfunction loadBasicEditor() {\n\t\t\t// Note that this option was used when logging a wikitext init later\n\t\t\tinitMechanism = 'tooslow';\n\n\t\t\t// This restarts the loading (whether it was aborted when loading the code or the data)\n\t\t\tvisualAbortPromise.reject();\n\t\t\tif ( abortableDataPromise && abortableDataPromise.abort ) {\n\t\t\t\tabortableDataPromise.abort();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Log init event to edit schema.\n\t\t * Need to log this from outside the Overlay object because that module\n\t\t * won't have loaded yet.\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @param {string} editor name e.g. wikitext or visualeditor\n\t\t * @method\n\t\t */\n\t\tfunction logInit( editor ) {\n\t\t\tmw.track( 'editAttemptStep', {\n\t\t\t\taction: 'init',\n\t\t\t\ttype: 'section',\n\t\t\t\tmechanism: initMechanism,\n\t\t\t\tintegration: 'page',\n\t\t\t\t/* eslint-disable camelcase */\n\t\t\t\teditor_interface: editor\n\t\t\t\t/* eslint-enable camelcase */\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Check whether VisualEditor should be loaded\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {bool}\n\t\t */\n\t\tfunction shouldLoadVisualEditor() {\n\t\t\tconst preferredEditor = getPreferredEditor();\n\n\t\t\treturn page.isVESourceAvailable() || (\n\t\t\t\tpage.isVEVisualAvailable() &&\n\t\t\t\t// If the user prefers visual mode or the user has no preference and\n\t\t\t\t// the visual mode is the default editor for this wiki\n\t\t\t\tpreferredEditor === 'VisualEditor'\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Load source editor\n\t\t *\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {jQuery.Promise} Promise resolved with the editor overlay\n\t\t * @fires mobileFrontend.editorOpening\n\t\t */\n\t\tfunction loadSourceEditor() {\n\t\t\tlogInit( 'wikitext' );\n\t\t\t// Inform other interested code that we're loading the editor\n\t\t\t/**\n\t\t\t * Internal for use in GrowthExperiments only.\n\t\t\t *\n\t\t\t * @event ~'mobileFrontend.editorOpening'\n\t\t\t * @memberof Hooks\n\t\t\t */\n\t\t\tmw.hook( 'mobileFrontend.editorOpening' ).fire();\n\n\t\t\treturn mw.loader.using( 'mobile.editor.overlay' ).then( () => {\n\t\t\t\tconst SourceEditorOverlay = __non_webpack_require__( 'mobile.editor.overlay' ).SourceEditorOverlay;\n\t\t\t\treturn new SourceEditorOverlay( editorOptions );\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Load visual editor. If it fails to load for any reason, load the source editor instead.\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {jQuery.Promise} Promise resolved with the editor overlay\n\t\t */\n\t\tfunction loadVisualEditorMaybe() {\n\t\t\tlogInit( 'visualeditor' );\n\t\t\t// Inform other interested code that we're loading the editor\n\t\t\t/**\n\t\t\t * Internal for use in GrowthExperiments only.\n\t\t\t *\n\t\t\t * @event ~'mobileFrontend.editorOpening'\n\t\t\t * @memberof Hooks\n\t\t\t */\n\t\t\tmw.hook( 'mobileFrontend.editorOpening' ).fire();\n\n\t\t\teditorOptions.mode = mw.config.get( 'wgMFEnableVEWikitextEditor' ) && getPreferredEditor() === 'SourceEditor' ?\n\t\t\t\t'source' :\n\t\t\t\t'visual';\n\t\t\teditorOptions.dataPromise = mw.loader.using( 'ext.visualEditor.targetLoader' ).then( () => {\n\t\t\t\tabortableDataPromise = mw.libs.ve.targetLoader.requestPageData(\n\t\t\t\t\teditorOptions.mode,\n\t\t\t\t\teditorOptions.titleObj.getPrefixedDb(),\n\t\t\t\t\t{\n\t\t\t\t\t\tsessionStore: true,\n\t\t\t\t\t\tsection: editorOptions.sectionId === undefined ?\n\t\t\t\t\t\t\tnull : editorOptions.sectionId,\n\t\t\t\t\t\toldId: editorOptions.oldId || undefined,\n\t\t\t\t\t\tpreload: editorOptions.preload,\n\t\t\t\t\t\tpreloadparams: editorOptions.preloadparams,\n\t\t\t\t\t\teditintro: editorOptions.editintro,\n\t\t\t\t\t\t// Should be ve.init.mw.MobileArticleTarget.static.trackingName,\n\t\t\t\t\t\t// but the class hasn't loaded yet.\n\t\t\t\t\t\ttargetName: 'mobile'\n\t\t\t\t\t} );\n\t\t\t\treturn abortableDataPromise;\n\t\t\t} );\n\n\t\t\tconst visualLoadingPromise = mw.loader.using( 'ext.visualEditor.targetLoader' )\n\t\t\t\t.then(\n\t\t\t\t\t// Load 'mobile.editor.overlay' separately, so that if we fall back to basic\n\t\t\t\t\t// editor, we can display it without waiting for the visual code\n\t\t\t\t\t() => mw.loader.using( 'mobile.editor.overlay' ).then( () => {\n\t\t\t\t\t\tmw.libs.ve.targetLoader.addPlugin( 'ext.visualEditor.mobileArticleTarget' );\n\t\t\t\t\t\tif ( mw.config.get( 'wgMFEnableVEWikitextEditor' ) ) {\n\t\t\t\t\t\t\t// Target loader only loads wikitext editor if the desktop\n\t\t\t\t\t\t\t// preference is set.\n\t\t\t\t\t\t\t// TODO: Have a cleaner API for this instead of duplicating\n\t\t\t\t\t\t\t// the module name here.\n\t\t\t\t\t\t\tmw.libs.ve.targetLoader.addPlugin( 'ext.visualEditor.mwwikitext' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn mw.libs.ve.targetLoader.loadModules( editorOptions.mode );\n\t\t\t\t\t} )\n\t\t\t\t);\n\n\t\t\t// Continue when loading is completed or aborted\n\t\t\tconst visualPromise = $.Deferred();\n\t\t\tvisualLoadingPromise.then( visualPromise.resolve, visualPromise.reject );\n\t\t\tvisualAbortPromise.then( visualPromise.reject, visualPromise.reject );\n\n\t\t\treturn visualPromise\n\t\t\t\t.then( () => {\n\t\t\t\t\tconst editorOverlays = __non_webpack_require__( 'mobile.editor.overlay' );\n\t\t\t\t\tconst VisualEditorOverlay = editorOverlays.VisualEditorOverlay;\n\t\t\t\t\tconst SourceEditorOverlay = editorOverlays.SourceEditorOverlay;\n\t\t\t\t\teditorOptions.SourceEditorOverlay = SourceEditorOverlay;\n\t\t\t\t\treturn new VisualEditorOverlay( editorOptions );\n\t\t\t\t}, () => loadSourceEditor() );\n\t\t}\n\n\t\t// showLoading() has to run after the overlay has opened, which disables page scrolling.\n\t\t// clearLoading() has to run after the loading overlay is hidden in any way\n\t\t// (either when loading is aborted, or when the editor overlay is shown instead).\n\t\tconst loadingOverlay = editorLoadingOverlay(\n\t\t\tshowLoading, clearLoading, shouldLoadVisualEditor() ? loadBasicEditor : null\n\t\t);\n\n\t\tif ( shouldLoadVisualEditor() ) {\n\t\t\toverlayPromise = loadVisualEditorMaybe();\n\t\t} else {\n\t\t\toverlayPromise = loadSourceEditor();\n\t\t}\n\n\t\t// Wait for the scroll animation to finish before we show the editor overlay\n\t\tutil.Promise.all( [ overlayPromise, animationDelayDeferred ] ).then( ( overlay ) => {\n\t\t\t// Wait for the data to load before we show the editor overlay\n\t\t\toverlay.getLoadingPromise().catch( ( error ) => {\n\t\t\t\tif ( visualAbortPromise.state() === 'rejected' ) {\n\t\t\t\t\treturn loadSourceEditor().then( ( sourceOverlay ) => {\n\t\t\t\t\t\toverlay = sourceOverlay;\n\t\t\t\t\t\treturn overlay.getLoadingPromise();\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\treturn $.Deferred().reject( error ).promise();\n\t\t\t} ).then( () => {\n\t\t\t\t// Make sure the user did not close the loading overlay while we were waiting\n\t\t\t\tconst overlayData = overlayManager.stack[0];\n\t\t\t\tif ( !overlayData || overlayData.overlay !== loadingOverlay ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Show the editor!\n\t\t\t\toverlayManager.replaceCurrent( overlay );\n\t\t\t}, ( error, apiResponse ) => {\n\t\t\t\t// Could not load the editor.\n\t\t\t\toverlayManager.router.back();\n\t\t\t\tif ( error.show ) {\n\t\t\t\t\t// Probably a blockMessageDrawer returned because the user is blocked.\n\t\t\t\t\tdocument.body.appendChild( error.$el[ 0 ] );\n\t\t\t\t\terror.show();\n\t\t\t\t} else if ( apiResponse ) {\n\t\t\t\t\tmw.notify( editorOptions.api.getErrorMessage( apiResponse ) );\n\t\t\t\t} else {\n\t\t\t\t\tmw.notify( mw.msg( 'mobile-frontend-editor-error-loading' ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\n\t\t// Reset the temporary override for the next load\n\t\teditorOverride = null;\n\n\t\treturn loadingOverlay;\n\t} );\n\n\t$( '#ca-edit a, a#ca-edit, #ca-editsource a, a#ca-editsource' ).prop( 'href', ( i, href ) => {\n\t\tconst editUrl = new URL( href, location.href );\n\t\t// By default the editor opens section 0 (lead section), rather than the whole article.\n\t\t// This might be changed in the future (T210659).\n\t\teditUrl.searchParams.set( 'section', '0' );\n\t\treturn editUrl.toString();\n\t} );\n\n\t// We use wgAction instead of getParamValue('action') as the former can be\n\t// overridden by hooks to stop the editor loading automatically.\n\tif ( !router.getPath() && ( mw.util.getParamValue( 'veaction' ) || mw.config.get( 'wgAction' ) === 'edit' ) ) {\n\t\tif ( mw.util.getParamValue( 'veaction' ) === 'edit' ) {\n\t\t\teditorOverride = 'VisualEditor';\n\t\t} else if ( mw.util.getParamValue( 'veaction' ) === 'editsource' ) {\n\t\t\teditorOverride = 'SourceEditor';\n\t\t}\n\t\t// else: action=edit, for which we allow the default to take effect\n\t\tconst fragment = '#/editor/' + ( mw.util.getParamValue( 'section' ) || ( mw.config.get( 'wgAction' ) === 'edit' ? 'all' : '0' ) );\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\tif ( window.history && history.pushState ) {\n\t\t\t// We're reformatting the action=edit URL into a view URL and\n\t\t\t// replacing it into the history, and then will fall through to\n\t\t\t// router.navigate which will move us to the editing URL for the\n\t\t\t// mobile site. We do this because the editor overlay deeply\n\t\t\t// expects to have been opened on top of an actual page, and e.g.\n\t\t\t// closing the editor via the X will produce unexpected behavior\n\t\t\t// otherwise.\n\t\t\tconst url = new URL( location.href );\n\t\t\turl.searchParams.delete( 'action' );\n\t\t\turl.searchParams.delete( 'veaction' );\n\t\t\turl.searchParams.delete( 'section' );\n\t\t\thistory.replaceState( null, document.title, url );\n\t\t}\n\t\tutil.docReady( () => {\n\t\t\trouter.navigate( fragment );\n\t\t} );\n\t}\n}\n\n/**\n * Hide any section id icons in the page. This will not hide the edit icon in the page action\n * menu.\n *\n * @method\n * @ignore\n * @param {module:mobile.startup/PageHTMLParser} currentPageHTMLParser\n */\nfunction hideSectionEditIcons( currentPageHTMLParser ) {\n\tcurrentPageHTMLParser.$el.find( '.mw-editsection' ).hide();\n}\n\n/**\n * Show a drawer with log in / sign up buttons.\n *\n * @method\n * @ignore\n * @param {Router} router\n */\nfunction bindEditLinksLoginDrawer( router ) {\n\tlet drawer;\n\tfunction showLoginDrawer() {\n\t\tif ( !drawer ) {\n\t\t\tdrawer = new CtaDrawer( {\n\t\t\t\tcontent: mw.msg( 'mobile-frontend-editor-disabled-anon' ),\n\t\t\t\tsignupQueryParams: {\n\t\t\t\t\twarning: 'mobile-frontend-watchlist-signup-action'\n\t\t\t\t}\n\t\t\t} );\n\t\t\tdocument.body.appendChild( drawer.$el[ 0 ] );\n\t\t}\n\t\tdrawer.show();\n\t}\n\t$editTab.on( 'click', ( ev ) => {\n\t\tshowLoginDrawer();\n\t\tev.preventDefault();\n\t} );\n\tmw.hook( 'wikipage.content' ).add( ( $content ) => {\n\t\t$content.find( EDITSECTION_SELECTOR ).on( 'click', ( ev ) => {\n\t\t\tshowLoginDrawer();\n\t\t\tev.preventDefault();\n\t\t} );\n\t} );\n\trouter.addRoute( editorPath, () => {\n\t\tshowLoginDrawer();\n\t} );\n\trouter.checkRoute();\n}\n\n/**\n * Setup the editor if the user can edit the page otherwise show a sorry toast.\n *\n * @method\n * @ignore\n * @param {Page} currentPage\n * @param {module:mobile.startup/PageHTMLParser} currentPageHTMLParser\n * @param {Skin} skin\n * @param {Router} router\n */\nfunction init( currentPage, currentPageHTMLParser, skin, router ) {\n\tlet editErrorMessage, editRestrictions;\n\t// see: https://www.mediawiki.org/wiki/Manual:Interface/JavaScript#Page-specific\n\tconst isReadOnly = mw.config.get( 'wgMinervaReadOnly' );\n\tconst isEditable = !isReadOnly && mw.config.get( 'wgIsProbablyEditable' );\n\n\tif ( isEditable ) {\n\t\t// Edit button updated in setupEditor.\n\t\tsetupEditor( currentPage, skin, currentPageHTMLParser, router );\n\t} else {\n\t\thideSectionEditIcons( currentPageHTMLParser );\n\t\teditRestrictions = mw.config.get( 'wgRestrictionEdit' );\n\t\tif ( mw.user.isAnon() && Array.isArray( editRestrictions ) && !editRestrictions.length ) {\n\t\t\tbindEditLinksLoginDrawer( router );\n\t\t} else {\n\t\t\tconst $link = $( '<a>' ).attr( 'href', mw.util.getUrl( mw.config.get( 'wgPageName' ), { action: 'edit' } ) );\n\t\t\teditErrorMessage = isReadOnly ? mw.msg( 'apierror-readonly' ) : mw.message( 'mobile-frontend-editor-disabled', $link ).parseDom();\n\t\t\tbindEditLinksSorryToast( editErrorMessage, router );\n\t\t}\n\t}\n}\n\n/**\n * Wire up events that ensure we\n * show a toast message with sincere condolences when user navigates to\n * #/editor or clicks on an edit button\n *\n * @method\n * @ignore\n * @param {string} msg Message for sorry message\n * @param {Router} router\n */\nfunction bindEditLinksSorryToast( msg, router ) {\n\t$editTab.on( 'click', ( ev ) => {\n\t\tmw.notify( msg );\n\t\tev.preventDefault();\n\t} );\n\tmw.hook( 'wikipage.content' ).add( ( $content ) => {\n\t\t$content.find( EDITSECTION_SELECTOR ).on( 'click', ( ev ) => {\n\t\t\tmw.notify( msg );\n\t\t\tev.preventDefault();\n\t\t} );\n\t} );\n\trouter.addRoute( editorPath, () => {\n\t\tmw.notify( msg );\n\t} );\n\trouter.checkRoute();\n}\n\nmodule.exports = function ( currentPage, currentPageHTMLParser, skin ) {\n\t// If not supported, do not setup.\n\tif ( !mw.config.get( 'wgMFIsSupportedEditRequest' ) ) {\n\t\treturn;\n\t}\n\tconst router = __non_webpack_require__( 'mediawiki.router' );\n\n\tif ( currentPage.inNamespace( 'file' ) && currentPage.id === 0 ) {\n\t\t// Is a new file page (enable upload image only) T60311\n\t\tbindEditLinksSorryToast( mw.msg( 'mobile-frontend-editor-uploadenable' ), router );\n\t} else {\n\t\t// Edit button is currently hidden. A call to init() will update it as needed.\n\t\tinit( currentPage, currentPageHTMLParser, skin, router );\n\t}\n};\n","const\n\tfakeToolbar = require( './fakeToolbar' ),\n\tIconButton = require( '../mobile.startup/IconButton' ),\n\tOverlay = require( '../mobile.startup/Overlay' );\n\n/* global $ */\n\n/**\n * Like loadingOverlay(), but with a fake editor toolbar instead of the spinner.\n *\n * @private\n * @param {Function} afterShow Callback which runs after overlay is shown\n * @param {Function} afterHide Callback which runs after overlay is hidden\n * @param {Function} [loadBasicEditor] Callback for the \"Use basic editor\" button\n * @return {module:mobile.startup/Overlay}\n */\nmodule.exports = function editorLoadingOverlay( afterShow, afterHide, loadBasicEditor ) {\n\tlet timeout;\n\tconst\n\t\t$fakeToolbar = fakeToolbar(),\n\t\t$loadBasicWrapper = $( '<div>' ).addClass( 've-loadbasiceditor' ),\n\t\tloadBasicButton = new IconButton( {\n\t\t\tlabel: mw.msg( 'mobile-frontend-editor-loadbasiceditor' ),\n\t\t\taction: 'progressive',\n\t\t\tweight: 'normal',\n\t\t\tsize: 'medium',\n\t\t\tisIconOnly: false,\n\t\t\ticon: null\n\t\t} ),\n\t\toverlay = new Overlay( {\n\t\t\tclassName: 'overlay overlay-loading',\n\t\t\tnoHeader: true,\n\t\t\tisBorderBox: false,\n\t\t\tonBeforeExit: ( exit ) => {\n\t\t\t\texit();\n\t\t\t\tafterHide();\n\t\t\t\tif ( timeout ) {\n\t\t\t\t\tclearTimeout( timeout );\n\t\t\t\t}\n\t\t\t}\n\t\t} ),\n\t\tlogFeatureUse = function ( feature, action ) {\n\t\t\tmw.track( 'visualEditorFeatureUse', {\n\t\t\t\tfeature,\n\t\t\t\taction,\n\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\teditor_interface: 'visualeditor'\n\t\t\t} );\n\t\t};\n\n\toverlay.show = function () {\n\t\tOverlay.prototype.show.call( this );\n\t\tafterShow();\n\t};\n\n\toverlay.$el.find( '.overlay-content' ).append( $fakeToolbar );\n\n\tif ( loadBasicEditor ) {\n\t\toverlay.$el.find( '.overlay-content' ).append(\n\t\t\t$loadBasicWrapper.append(\n\t\t\t\t$( '<p>' ).text( mw.msg( 'mobile-frontend-editor-loadingtooslow' ) ),\n\t\t\t\tloadBasicButton.$el\n\t\t\t)\n\t\t);\n\n\t\ttimeout = setTimeout( () => {\n\t\t\t$loadBasicWrapper.addClass( 've-loadbasiceditor-shown' );\n\t\t\tlogFeatureUse( 'mobileVisualFallback', 'context-show' );\n\t\t}, 3000 );\n\n\t\tloadBasicButton.$el.on( 'click', () => {\n\t\t\t$loadBasicWrapper.removeClass( 've-loadbasiceditor-shown' );\n\t\t\tlogFeatureUse( 'mobileVisualFallback', 'fallback-confirm' );\n\t\t\tloadBasicEditor();\n\t\t} );\n\t}\n\n\t// Animate the toolbar sliding into place.\n\t$fakeToolbar.addClass( 'toolbar-hidden' );\n\tsetTimeout( () => {\n\t\t$fakeToolbar.addClass( 'toolbar-shown' );\n\t\tsetTimeout( () => {\n\t\t\t$fakeToolbar.addClass( 'toolbar-shown-done' );\n\t\t}, 250 );\n\t} );\n\n\treturn overlay;\n};\n","const icons = require( '../mobile.startup/icons' );\n\n/* global $ */\nmodule.exports = function fakeToolbar() {\n\tconst $goBack = icons.cancel().$el;\n\n\t// FIXME: Should not be a button, instead should be an icon with text\n\tconst $loadingMessage = icons.spinner( {\n\t\ttagName: 'span',\n\t\tisIconOnly: false,\n\t\tlabel: mw.msg( 'mobile-frontend-editor-loading' )\n\t} ).$el;\n\n\t// Wrappers similar to .overlay-header-container, .overlay-header and .oo-ui-toolbar\n\tconst $fakeToolbar = $( '<div>' )\n\t\t.addClass( 've-mobile-fakeToolbar-container' )\n\t\t.append( $( '<div>' )\n\t\t\t.addClass( 've-mobile-fakeToolbar-header' )\n\t\t\t// Minerva has some complicated styling for this class, so we have to include it\n\t\t\t.addClass( 'overlay-header' )\n\t\t\t.append( $( '<div>' )\n\t\t\t\t.addClass( 've-mobile-fakeToolbar' )\n\t\t\t\t.append( $goBack, $loadingMessage )\n\t\t\t)\n\t\t);\n\n\treturn $fakeToolbar;\n};\n","const browser = require( '../mobile.startup/Browser' ).getSingleton();\n\n/**\n * Checks if sections should be collapsed by default.\n *\n * @ignore\n *\n * @return {boolean}\n */\nfunction isCollapsedByDefault() {\n\treturn !browser.isWideScreen() &&\n\t\t// Section collapsing can be disabled in MobilePreferences\n\t\t!document.documentElement.classList.contains(\n\t\t\t'mf-expand-sections-clientpref-1'\n\t\t);\n}\n\nmodule.exports = isCollapsedByDefault;\n","const lazyImageLoader = require( '../mobile.startup/lazyImages/lazyImageLoader' );\n\n/**\n * @namespace Hooks\n */\n\n/**\n * Initialise lazy loading images which utilizes native browser support.\n *\n * @private\n */\nfunction initNative() {\n\t// Regardless of whether or not lazy load is turned on\n\t// We need to load in all images before print\n\twindow.addEventListener( 'beforeprint', () => {\n\t\t// Printing documents with images that are lazy loaded is broken in Safari\n\t\t// https://bugs.webkit.org/show_bug.cgi?id=224547\n\t\tArray.prototype.forEach.call(\n\t\t\tdocument.querySelectorAll( 'img' ),\n\t\t\t( img ) => {\n\t\t\t\timg.loading = 'eager';\n\t\t\t}\n\t\t);\n\t} );\n}\n/**\n * Initialise lazy loading images to supplement the HTML changes inside the\n * MobileFormatter.\n *\n * @param {jQuery} $container\n * @private\n */\nfunction init( $container ) {\n\n\t// T360781 - since this is invoked via hook, the value of $container is not guaranteed.\n\t// If undefined, return early since no further work can be done on $container.\n\tif ( !( $container[ 0 ] instanceof HTMLElement ) ) {\n\t\treturn;\n\t}\n\n\t// When using Parsoid switch to native lazy loading (T230812)\n\tif ( $container.find( '[data-mw-parsoid-version]' ).length ) {\n\t\treturn initNative();\n\t}\n\n\tconst imagePlaceholders = lazyImageLoader.queryPlaceholders( $container[ 0 ] );\n\n\t// Regardless of whether or not lazy load is turned on\n\t// We need to load in all images before print\n\twindow.addEventListener( 'beforeprint', () => {\n\t\tlazyImageLoader.loadImages( imagePlaceholders );\n\t} );\n\n\tif ( !mw.config.get( 'wgMFLazyLoadImages' ) ) {\n\t\treturn;\n\t}\n\n\t// eslint-disable-next-line compat/compat\n\tconst observer = new IntersectionObserver(\n\t\t( entries ) => {\n\t\t\tentries.forEach( ( entry ) => {\n\t\t\t\tconst placeholder = entry.target;\n\t\t\t\t// If intersecting load image and stop observing it to free up resources.\n\t\t\t\tif ( entry.isIntersecting ) {\n\t\t\t\t\tlazyImageLoader.loadImage( placeholder );\n\t\t\t\t\tobserver.unobserve( placeholder );\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\t// See https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n\t\t{\n\t\t\t// Setup the area for observing.\n\t\t\t// By default the root is the viewport.\n\t\t\t// We want the detection area to be as tall as 150% of the viewport height,\n\t\t\t// allowing elements to be detected before they reach the viewport.\n\t\t\t// This is achieved with a 50% bottom margin.\n\t\t\trootMargin: '0px 0px 50% 0px',\n\t\t\t// The default is 0 (meaning as soon as even one pixel is visible,\n\t\t\t// the callback will be run), however we explicitly set this so that\n\t\t\t// it is clear we have made this choice in case we want to revisit later.\n\t\t\tthreshold: 0\n\t\t}\n\t);\n\n\t// observe all the placeholders\n\timagePlaceholders.forEach( ( placeholder ) => {\n\t\tobserver.observe( placeholder );\n\t} );\n}\n\n/**\n * Make modifications after an image was lazy loaded, stable for use.\n *\n * @event ~'mobileFrontend.loadLazyImages'\n * @memberof Hooks\n * @param {jQuery} $container\n */\nmw.hook( 'mobileFrontend.loadLazyImages' ).add( ( $container ) => {\n\tconst imagePlaceholders = lazyImageLoader.queryPlaceholders( $container[ 0 ] );\n\tlazyImageLoader.loadImages( imagePlaceholders );\n} );\n\nconst exports = function () {\n\tmw.hook( 'wikipage.content' ).add( init );\n};\n\nexports.test = {\n\tinitNative\n};\n\nmodule.exports = exports;\n","// FIXME: make this an object with a constructor to facilitate testing\n// (see https://bugzilla.wikimedia.org/show_bug.cgi?id=44264)\n/**\n * mobileFrontend namespace\n *\n * @private\n */\nlet url;\n\nconst\n\ttoggling = require( './toggling' ),\n\tlazyLoadedImages = require( './lazyLoadedImages' ),\n\teditor = require( './editor' ),\n\tcurrentPage = require( '../mobile.startup/currentPage' )(),\n\tcurrentPageHTMLParser = require( '../mobile.startup/currentPageHTMLParser' )(),\n\tmfUtil = require( '../mobile.startup/util' ),\n\t$window = mfUtil.getWindow(),\n\tSkin = require( '../mobile.startup/Skin' ),\n\teventBus = require( '../mobile.startup/eventBusSingleton' );\n\nconst skin = Skin.getSingleton();\n\n/**\n * Given 2 functions, it returns a function that will run both with it's\n * context and parameters and return the results combined\n *\n * @private\n * @param {Function} fn1\n * @param {Function} fn2\n * @return {Function} which returns void\n */\nfunction apply2( fn1, fn2 ) {\n\treturn function () {\n\t\tfn1.apply( this, arguments );\n\t\tfn2.apply( this, arguments );\n\t};\n}\n\n/**\n * The `window`'s resize event debounced at 100 ms.\n * The `resize:throttled` event is the `window`'s\n * resize event throttled to 200 ms.\n *\n * @event resize\n * @memberof window\n */\n\n/**\n * The `window`'s scroll event debounced at 100 ms.\n * The `scroll:throttled` event is the `window`'s\n * scroll event throttled to 200 ms.\n *\n * @event scroll\n * @memberof window\n */\n\n$window\n\t.on( 'resize', apply2(\n\t\tmw.util.debounce( () => {\n\t\t\teventBus.emit( 'resize' );\n\t\t}, 100 ),\n\t\tmw.util.throttle( () => {\n\t\t\teventBus.emit( 'resize:throttled' );\n\t\t}, 200 )\n\t) )\n\t.on( 'scroll', apply2(\n\t\tmw.util.debounce( () => {\n\t\t\teventBus.emit( 'scroll' );\n\t\t}, 100 ),\n\t\tmw.util.throttle( () => {\n\t\t\teventBus.emit( 'scroll:throttled' );\n\t\t}, 200 )\n\t) );\n\n// Hide URL flags used to pass state through reloads\n// venotify is normally handled in ve.init.mw.DesktopArticleTarget.init.js\n// but that's not loaded on mobile\n// eslint-disable-next-line no-restricted-properties\nif ( window.history && history.pushState ) {\n\t// eslint-disable-next-line no-restricted-properties\n\turl = new URL( window.location.href );\n\tif ( url.searchParams.has( 'venotify' ) || url.searchParams.has( 'mfnotify' ) ) {\n\t\turl.searchParams.delete( 'venotify' );\n\t\turl.searchParams.delete( 'mfnotify' );\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\twindow.history.replaceState( null, document.title, url.toString() );\n\t}\n}\n\n// Recruit volunteers through the console\n// (note console.log may not be a function so check via apply)\n/* eslint-disable no-console */\nif ( window.console && window.console.log && window.console.log.apply &&\n\t\tmw.config.get( 'wgMFEnableJSConsoleRecruitment' ) ) {\n\tconsole.log( mw.msg( 'mobile-frontend-console-recruit' ) );\n}\n/* eslint-enable no-console */\n\neditor( currentPage, currentPageHTMLParser, skin );\ntoggling();\nlazyLoadedImages();\n","const isCollapsedByDefault = require( './isCollapsedByDefault' );\n\n/**\n * Sets attributes on collapsible header based on collapsed state\n *\n * @method\n * @param {HTMLElement} heading span element containing heading text\n * @param {HTMLElement} icon span element for icon\n * @param {boolean} isCollapsed collapsed state to set\n * @ignore\n */\nfunction setCollapsedHeadingState( heading, icon, isCollapsed ) {\n\t// update the dropdown state based on the content visibility\n\tif ( isCollapsed ) {\n\t\theading.setAttribute( 'aria-expanded', 'false' );\n\t\ticon.classList.add( 'mf-icon-expand' );\n\t\ticon.classList.remove( 'mf-icon-collapse' );\n\t} else {\n\t\theading.setAttribute( 'aria-expanded', 'true' );\n\t\ticon.classList.add( 'mf-icon-collapse' );\n\t\ticon.classList.remove( 'mf-icon-expand' );\n\t}\n\n\t/**\n\t * Internal for use inside ReaderExperiments\n\t *\n\t * @event ~'readerExperiments.section-toggled'\n\t * @memberof Hooks\n\t */\n\tmw.hook( 'readerExperiments.section-toggled' ).fire( {\n\t\theading,\n\t\tisExpanded: !isCollapsed\n\t} );\n}\n\n/**\n * Sets attributes on collapsible elements based on collapsed state\n *\n * @method\n * @param {HTMLElement} content div element containing collapsible content\n * @param {HTMLElement} heading div element containing heading text\n * @param {HTMLElement} icon span element for icon\n * @param {boolean} isCollapsed collapsed state to set\n * @ignore\n */\nfunction setCollapsedState( content, heading, icon, isCollapsed ) {\n\t// show the content if hidden, hide if shown (until found so find in page works)\n\tcontent.hidden = isCollapsed ? 'until-found' : false;\n\n\tsetCollapsedHeadingState( heading, icon, isCollapsed );\n}\n\n/**\n * Toggles collapsible state for a heading\n *\n * @method\n * @param {HTMLElement} content div element containing collapsible content\n * @param {HTMLElement} heading div element containing heading text\n * @param {HTMLElement} icon span element for icon\n * @ignore\n */\nfunction toggle( content, heading, icon ) {\n\tconst currentlyHidden = content.hidden;\n\tsetCollapsedState( content, heading, icon,\n\t\t// This should reflect **new** collapsed state\n\t\t!currentlyHidden );\n}\n\n/**\n * Prepares a heading wrapper element for collapsible functionality.\n *\n * @method\n * @param {HTMLElement} wrapper The heading wrapper element\n * @param {HTMLElement} content The content element associated with this heading\n * @return {HTMLElement} The created icon element\n * @ignore\n */\nfunction prepareHeadingWrapper( wrapper, content ) {\n\twrapper.classList.add( 'mf-collapsible-heading' );\n\tcontent.classList.add( 'mf-collapsible-content' );\n\n\t// Update the heading wrapper to account for semantics of collapsing sections\n\twrapper.setAttribute( 'tabindex', '0' );\n\twrapper.setAttribute( 'role', 'button' );\n\twrapper.setAttribute( 'aria-controls', content.id );\n\n\t// Create the dropdown arrow icon\n\tconst icon = document.createElement( 'span' );\n\ticon.classList.add( 'mf-icon', 'mf-icon--small', 'mf-collapsible-icon' );\n\ticon.setAttribute( 'aria-hidden', true );\n\twrapper.prepend( icon );\n\n\treturn icon;\n}\n\n/**\n * Attaches event listeners to a heading wrapper for collapsible functionality.\n *\n * @method\n * @param {HTMLElement} wrapper The heading wrapper element\n * @param {HTMLElement} content The content element associated with this heading\n * @param {HTMLElement} icon The icon element\n * @ignore\n */\nfunction attachEventListeners( wrapper, content, icon ) {\n\t// T389820 toggle the icon by expanding the heading on match.\n\tcontent.addEventListener( 'beforematch', () => {\n\t\tsetCollapsedHeadingState( wrapper, icon, false );\n\t} );\n\n\t// Register the click handler\n\twrapper.addEventListener( 'click', ( ev ) => {\n\t\t// Only toggle if a non-link was clicked.\n\t\t// We don't want sections to collapse if the edit link is clicked for example.\n\t\tconst clickedLink = ev.target.closest( 'a' );\n\t\tif ( !clickedLink ) {\n\t\t\ttoggle( content, wrapper, icon );\n\t\t}\n\t} );\n\n\t// Register the keypress handler\n\twrapper.addEventListener( 'keypress', ( ev ) => {\n\t\t// Only toggle if a non-link was clicked.\n\t\t// We don't want sections to collapse if the edit link is clicked for example.\n\t\tconst clickedLink = ev.target.closest( 'a' );\n\t\t// Only handle keypresses on the \"Enter\" or \"Space\" keys\n\t\tif ( !clickedLink && ( ev.which === 13 || ev.which === 32 ) ) {\n\t\t\ttoggle( content, wrapper, icon );\n\t\t}\n\t} );\n}\n\n/**\n * Initialises collapsing code.\n *\n * @method\n * @param {HTMLElement} container to enable collapsing on\n * @ignore\n */\nfunction init( container ) {\n\t// These classes override site settings and user preferences. For example:\n\t// * ...-collapsed used on talk pages by DiscussionTools. (T321618, T322628)\n\t// * ...-expanded used in previews (T336572)\n\tlet isCollapsed;\n\tconst override = container.closest( '.collapsible-headings-collapsed, .collapsible-headings-expanded' );\n\tif ( override ) {\n\t\tisCollapsed = override.classList.contains( 'collapsible-headings-collapsed' );\n\t} else {\n\t\t// Check site config and user preferences\n\t\tisCollapsed = isCollapsedByDefault();\n\t}\n\n\tconst headingWrappers = Array.from(\n\t\tcontainer.querySelectorAll( '.mw-parser-output > section > .mw-heading' )\n\t);\n\n\theadingWrappers.forEach( ( wrapper ) => {\n\t\tconst content = wrapper.nextElementSibling;\n\t\tif ( content.tagName !== 'DIV' ) {\n\t\t\treturn;\n\t\t}\n\t\tconst icon = prepareHeadingWrapper( wrapper, content );\n\n\t\tattachEventListeners( wrapper, content, icon );\n\t\tsetCollapsedState( content, wrapper, icon, isCollapsed );\n\t} );\n}\n\nmodule.exports = { init };\n","module.exports = function () {\n\tconst\n\t\tcurrentPage = require( '../mobile.startup/currentPage' )(),\n\t\tToggler = require( './Toggler' ),\n\t\tsectionCollapsing = require( './sectionCollapsing' ),\n\t\teventBus = require( '../mobile.startup/eventBusSingleton' );\n\n\t/**\n\t * Initialises toggling code.\n\t *\n\t * @method\n\t * @param {jQuery.Object} $container to enable toggling on\n\t * @param {string} prefix a prefix to use for the id.\n\t * @param {Page} page The current page\n\t * @ignore\n\t */\n\tfunction init( $container, prefix, page ) {\n\t\tconst isParsoidEnabled = !!document.querySelector( '.mw-parser-output[data-mw-parsoid-version]' );\n\t\tif ( isParsoidEnabled ) {\n\t\t\tsectionCollapsing.init( $container[0] );\n\t\t} else {\n\t\t\t// Only handle headings in content processed by MakeSectionsTransform.\n\t\t\t// Remove event handler added by MakeSectionsTransform::interimTogglingSupport().\n\t\t\t$container.find( '.section-heading' ).removeAttr( 'onclick' );\n\t\t\t// Cleanup global as it is no longer needed. We check if it's undefined because\n\t\t\t// there is no guarantee this won't be run on other skins e.g. Vector or cached HTML.\n\t\t\tif ( window.mfTempOpenSection !== undefined ) {\n\t\t\t\tdelete window.mfTempOpenSection;\n\t\t\t}\n\t\t\t// eslint-disable-next-line no-new\n\t\t\tnew Toggler( {\n\t\t\t\t$container,\n\t\t\t\tprefix,\n\t\t\t\tpage,\n\t\t\t\teventBus\n\t\t\t} );\n\t\t}\n\t}\n\n\tif (\n\t\t// Avoid this running on Watchlist.\n\t\t!currentPage.inNamespace( 'special' ) &&\n\t\t(\n\t\t\tmw.config.get( 'wgAction' ) === 'view' ||\n\t\t\tmw.config.get( 'wgAction' ) === 'edit'\n\t\t)\n\t) {\n\t\tmw.hook( 'wikipage.content' ).add( ( $container ) => {\n\t\t\tlet $contentContainer = $container.find( '.mw-parser-output' );\n\t\t\t// If there was no mw-parser-output wrapper, just use the parent.\n\t\t\tif ( $contentContainer.length === 0 ) {\n\t\t\t\t$contentContainer = $container;\n\t\t\t}\n\t\t\tinit( $contentContainer, 'content-', currentPage );\n\t\t} );\n\t}\n};\n"],"names":["util","escapeSelector","arrowOptions","icon","isSmall","additionalClassNames","Icon","isCollapsedByDefault","module","exports","constructor","options","this","eventBus","$container","prefix","page","_enable","undefined","_isCollapsedByDefault","$override","closest","length","hasClass","_getHeadingTarget","wrapperElement","querySelector","toggle","$heading","fromSaved","$button","data","find","target","wasExpanded","classList","contains","add","rotation","newIndicator","$indicatorElement","replaceWith","$el","attr","$content","next","removeClass","get","setAttribute","addClass","removeAttr","mw","requestIdleCallback","hook","fire","heading","isExpanded","reveal","id","$target","e","parents","prev","window","scrollTo","offset","top","_createHeadingButton","initiallyCollapsed","$serverIndicator","headingElement","button","document","createElement","type","indicator","insertBefore","firstChild","Array","from","childNodes","forEach","node","nodeType","Node","TEXT_NODE","appendChild","createTextNode","textContent","ELEMENT_NODE","tagName","innerHTML","children","each","i","headingEl","$indicator","is","$buttonIndicator","first","not","remove","shouldBeCollapsed","on","ev","preventDefault","checkHash","hash","location","indexOf","slice","decodedHash","percentDecodeFragment","internalRedirect","config","internalRedirectHash","split","checkInternalRedirectAndHash","getWindow","fakeToolbar","editorLoadingOverlay","OverlayManager","$editTab","$","hasTwoEditIcons","EDITSECTION_SELECTOR","user","CtaDrawer","veConfig","editorPath","editorOverride","onEditLinkClick","elem","router","section","getParamValue","href","navigate","getPreferredEditor","preferredEditor","storage","bindEditLinksSorryToast","msg","notify","addRoute","checkRoute","currentPage","currentPageHTMLParser","skin","inNamespace","editErrorMessage","editRestrictions","isReadOnly","overlayManager","getSingleton","isNewPage","off","sectionId","scrollTop","pageYOffset","$contentText","url","URL","editorOptions","fakeScroll","api","Api","licenseMsg","getLicenseMsg","title","titleObj","isAnon","oldId","contentLang","contentDir","preload","searchParams","preloadparams","getArrayParam","editintro","visualAbortPromise","Deferred","animationDelayDeferred","abortableDataPromise","overlayPromise","initMechanism","logInit","editor","track","action","mechanism","integration","editor_interface","shouldLoadVisualEditor","isVESourceAvailable","isVEVisualAvailable","loadSourceEditor","loader","using","then","SourceEditorOverlay","isWikiText","loadingOverlay","$sectionTop","enableVisualSectionEditing","body","$page","prop","getBoundingClientRect","css","transform","setTimeout","resolve","abort","reject","mode","dataPromise","libs","ve","targetLoader","requestPageData","getPrefixedDb","sessionStore","targetName","visualLoadingPromise","addPlugin","loadModules","visualPromise","editorOverlays","VisualEditorOverlay","loadVisualEditorMaybe","Promise","all","overlay","getLoadingPromise","catch","error","state","sourceOverlay","promise","overlayData","stack","replaceCurrent","apiResponse","back","show","getErrorMessage","editUrl","set","toString","getPath","fragment","history","pushState","delete","replaceState","docReady","setupEditor","hide","hideSectionEditIcons","isArray","drawer","showLoginDrawer","content","signupQueryParams","warning","bindEditLinksLoginDrawer","$link","getUrl","message","parseDom","init","IconButton","Overlay","afterShow","afterHide","loadBasicEditor","timeout","$fakeToolbar","$loadBasicWrapper","loadBasicButton","label","weight","size","isIconOnly","className","noHeader","isBorderBox","onBeforeExit","exit","clearTimeout","logFeatureUse","feature","prototype","call","append","text","icons","$goBack","cancel","$loadingMessage","spinner","browser","isWideScreen","documentElement","lazyImageLoader","initNative","addEventListener","querySelectorAll","img","loading","HTMLElement","imagePlaceholders","queryPlaceholders","loadImages","observer","IntersectionObserver","entries","entry","placeholder","isIntersecting","loadImage","unobserve","rootMargin","threshold","observe","test","toggling","lazyLoadedImages","$window","Skin","apply2","fn1","fn2","apply","arguments","debounce","emit","throttle","has","console","log","setCollapsedHeadingState","isCollapsed","setCollapsedState","hidden","container","override","wrapper","nextElementSibling","prepend","prepareHeadingWrapper","which","attachEventListeners","Toggler","sectionCollapsing","$contentContainer","mfTempOpenSection"],"sourceRoot":""}