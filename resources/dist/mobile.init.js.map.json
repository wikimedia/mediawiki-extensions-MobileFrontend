{"version":3,"file":"mobile.init.js","mappings":"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","sources":["webpack://mfModules/./src/mobile.init/editor.js","webpack://mfModules/./src/mobile.init/editorLoadingOverlay.js","webpack://mfModules/./src/mobile.init/eventLogging/schemaEditAttemptStep.js","webpack://mfModules/./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js","webpack://mfModules/./src/mobile.init/lazyLoadedImages.js","webpack://mfModules/./src/mobile.init/mobile.init.js","webpack://mfModules/./src/mobile.init/toggling.js"],"sourcesContent":["/* global $ */\nvar M = require( '../mobile.startup/moduleLoaderSingleton' ),\n\tutil = require( '../mobile.startup/util' ),\n\teditorLoadingOverlay = require( './editorLoadingOverlay' ),\n\tOverlayManager = require( '../mobile.startup/OverlayManager' ),\n\t// #ca-edit, .mw-editsection are standard MediaWiki elements\n\t// .edit-link comes from MobileFrontend user page creation CTA\n\t// Links in content are handled separately to allow reloading the content (T324686)\n\t$editTab = $( '#ca-edit' ),\n\tEDITSECTION_SELECTOR = '.mw-editsection a, .edit-link',\n\tuser = mw.user,\n\tCtaDrawer = require( '../mobile.startup/CtaDrawer' ),\n\tcontentModel = mw.config.get( 'wgPageContentModel' ),\n\tveConfig = mw.config.get( 'wgVisualEditorConfig' ),\n\teditCount = mw.config.get( 'wgUserEditCount' ),\n\teditorPath = /^\\/editor\\/(\\d+|T-\\d+|all)$/;\n\n/**\n * Event handler for edit link clicks. Will prevent default link\n * behaviour and will not allow propagation\n *\n * @method\n * @ignore\n * @param {HTMLElement} elem\n * @param {jQuery.Event} ev\n * @param {Router} router\n */\nfunction onEditLinkClick( elem, ev, router ) {\n\tvar section;\n\tif ( $( EDITSECTION_SELECTOR ).length === 0 ) {\n\t\t// If section edit links are not available, the only edit link\n\t\t// should allow editing the whole page (T232170)\n\t\tsection = 'all';\n\t} else {\n\t\tsection = mw.util.getParamValue( 'section', elem.href ) || 'all';\n\t}\n\t// Don't do anything for section edit links for different pages (transcluded)\n\tif ( mw.config.get( 'wgPageName' ) !== mw.util.getParamValue( 'title', elem.href ) ) {\n\t\treturn;\n\t}\n\trouter.navigate( '#/editor/' + section );\n\t// DO NOT USE stopPropagation or you'll break click tracking in WikimediaEvents\n\t// You DO NOT NEED to\n\t// prevent folding section when clicking Edit by stopping propagation\n\t// as this is a concern of the Toggler class and taken care of by inspecting\n\t// !ev.target.href (see Toggler.js)\n\t// avoid navigating to ?action=edit\n\tev.preventDefault();\n}\n\n/**\n * Retrieve the user's preferred editor setting. If none is set, return the default\n * editor for this wiki.\n *\n * @method\n * @ignore\n * @return {string} Either 'VisualEditor' or 'SourceEditor'\n */\nfunction getPreferredEditor() {\n\tvar defaultEditor, tokenData,\n\t\tpreferredEditor = mw.user.options.get( 'mobile-editor' ) || mw.storage.get( 'preferredEditor' );\n\tif ( preferredEditor ) {\n\t\treturn preferredEditor;\n\t}\n\tdefaultEditor = mw.config.get( 'wgMFDefaultEditor' );\n\t// Cleaning up after ABTest, remove soon\n\ttokenData = mw.storage.getObject( 'MFDefaultEditorABToken' );\n\tif ( tokenData && tokenData.expires < Date.now() ) {\n\t\t// The storage never expires by itself. We should keep this for a while, even if we remove\n\t\t// the rest of this code, to clean up after ourselves.\n\t\tmw.storage.remove( 'MFDefaultEditorABToken' );\n\t\ttokenData = null;\n\t}\n\tswitch ( defaultEditor ) {\n\t\tcase 'source':\n\t\t\treturn 'SourceEditor';\n\t\tcase 'visual':\n\t\t\treturn 'VisualEditor';\n\t\tcase 'preference':\n\t\t\t// First check if the user has actually used the desktop editor.\n\t\t\t// This is done hackily by checking if they have the preference\n\t\t\t// set to suppress the welcome dialog or user education popups. (T261423)\n\t\t\tif ( mw.user.options.get( 'visualeditor-hidebetawelcome' ) || mw.user.options.get( 'visualeditor-hideusered' ) ) {\n\t\t\t\treturn mw.user.options.get( 'visualeditor-editor' ) === 'visualeditor' ? 'VisualEditor' : 'SourceEditor';\n\t\t\t} else {\n\t\t\t\t// We don't know what their preference is.\n\t\t\t\t// For now, continue to give them the source editor.\n\t\t\t\treturn 'SourceEditor';\n\t\t\t}\n\t}\n\t// In the event of misconfiguration, fall back to source\n\treturn 'SourceEditor';\n}\n\n/**\n * Initialize the edit button so that it launches the editor interface when clicked.\n *\n * @method\n * @ignore\n * @param {Page} page The page to edit.\n * @param {Skin} skin\n * @param {PageHTMLParser} currentPageHTMLParser\n * @param {Router} router\n */\nfunction setupEditor( page, skin, currentPageHTMLParser, router ) {\n\tvar uri, fragment, editorOverride,\n\t\toverlayManager = OverlayManager.getSingleton(),\n\t\tisNewPage = page.id === 0,\n\t\tfirstInitDone = false;\n\n\t$editTab.on( 'click', function ( ev ) {\n\t\tonEditLinkClick( this, ev, overlayManager.router );\n\t} );\n\tmw.hook( 'wikipage.content' ).add( function ( $content ) {\n\t\t$content.find( EDITSECTION_SELECTOR ).on( 'click', function ( ev ) {\n\t\t\tonEditLinkClick( this, ev, overlayManager.router );\n\t\t} );\n\t} );\n\n\toverlayManager.add( editorPath, function ( sectionId ) {\n\t\tvar\n\t\t\tscrollTop = window.pageYOffset,\n\t\t\t$contentText = $( '#mw-content-text' ),\n\t\t\teditorOptions = {\n\t\t\t\toverlayManager: overlayManager,\n\t\t\t\tcurrentPageHTMLParser: currentPageHTMLParser,\n\t\t\t\tfakeScroll: 0,\n\t\t\t\tapi: new mw.Api(),\n\t\t\t\tlicenseMsg: skin.getLicenseMsg(),\n\t\t\t\ttitle: page.title,\n\t\t\t\ttitleObj: page.titleObj,\n\t\t\t\tisAnon: user.isAnon(),\n\t\t\t\tisNewPage: isNewPage,\n\t\t\t\teditCount: editCount,\n\t\t\t\toldId: mw.util.getParamValue( 'oldid' ),\n\t\t\t\tcontentLang: $contentText.attr( 'lang' ),\n\t\t\t\tcontentDir: $contentText.attr( 'dir' ),\n\t\t\t\tsessionId: mw.config.get( 'wgWMESchemaEditAttemptStepSessionId' ) ||\n\t\t\t\t\tmw.Uri().query.editingStatsId ||\n\t\t\t\t\tuser.generateRandomSessionId()\n\t\t\t},\n\t\t\tanimationDelayDeferred, abortableDataPromise, loadingOverlay, overlayPromise,\n\t\t\tinitMechanism = mw.util.getParamValue( 'redlink' ) ? 'new' : 'click';\n\n\t\tif ( sectionId !== 'all' ) {\n\t\t\teditorOptions.sectionId = page.isWikiText() ? sectionId : undefined;\n\t\t}\n\n\t\tfunction showLoading() {\n\t\t\tvar $page, $content, $sectionTop, fakeScroll, enableVisualSectionEditing;\n\n\t\t\t$( document.body ).addClass( 've-loading' );\n\n\t\t\t$page = $( '#mw-mf-page-center' );\n\t\t\t$content = $( '#content' );\n\t\t\tif ( sectionId === '0' || sectionId === 'all' ) {\n\t\t\t\t$sectionTop = $( '#bodyContent' );\n\t\t\t} else {\n\t\t\t\t$sectionTop = $( '[data-section=\"' + sectionId + '\"]' )\n\t\t\t\t\t.closest( 'h1, h2, h3, h4, h5, h6' );\n\t\t\t\t// When loading on action=edit URLs, there is no page content\n\t\t\t\tif ( !$sectionTop.length ) {\n\t\t\t\t\t$sectionTop = $( '#bodyContent' );\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Pretend that we didn't just scroll the page to the top.\n\t\t\t$page.prop( 'scrollTop', scrollTop );\n\t\t\t// Then, pretend that we're scrolling to the position of the clicked heading.\n\t\t\tfakeScroll = $sectionTop[0].getBoundingClientRect().top;\n\t\t\t// Adjust for height of the toolbar.\n\t\t\tfakeScroll -= 48;\n\t\t\tif ( shouldLoadVisualEditor() ) {\n\t\t\t\tenableVisualSectionEditing = veConfig.enableVisualSectionEditing === true ||\n\t\t\t\t\t// === ve.init.mw.MobileArticleTarget.static.trackingName\n\t\t\t\t\tveConfig.enableVisualSectionEditing === 'mobile';\n\t\t\t\tif ( sectionId === '0' || sectionId === 'all' || enableVisualSectionEditing ) {\n\t\t\t\t\t// Adjust for surface padding. Only needed if we're at the beginning of the doc.\n\t\t\t\t\tfakeScroll -= 16;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( sectionId === '0' || sectionId === 'all' ) {\n\t\t\t\t\tfakeScroll -= 16;\n\t\t\t\t}\n\t\t\t}\n\t\t\t$content.css( {\n\t\t\t\t// Use transform instead of scroll for smoother animation (via CSS transitions).\n\t\t\t\ttransform: 'translate( 0, ' + -fakeScroll + 'px )',\n\t\t\t\t// If the clicked heading is near the end of the page, we might need to insert\n\t\t\t\t// some extra space to allow us to scroll \"beyond the end\" of the page.\n\t\t\t\t'padding-bottom': '+=' + fakeScroll,\n\t\t\t\t'margin-bottom': '-=' + fakeScroll\n\t\t\t} );\n\t\t\teditorOptions.fakeScroll = fakeScroll;\n\t\t\tsetTimeout( animationDelayDeferred.resolve, 500 );\n\t\t}\n\n\t\tfunction clearLoading() {\n\t\t\tif ( abortableDataPromise && abortableDataPromise.abort ) {\n\t\t\t\tabortableDataPromise.abort();\n\t\t\t}\n\n\t\t\t$( '#content' ).css( {\n\t\t\t\ttransform: '',\n\t\t\t\t'padding-bottom': '',\n\t\t\t\t'margin-bottom': ''\n\t\t\t} );\n\n\t\t\t$( document.body ).removeClass( 've-loading' );\n\t\t}\n\n\t\t/**\n\t\t * Log init event to edit schema.\n\t\t * Need to log this from outside the Overlay object because that module\n\t\t * won't have loaded yet.\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @param {string} editor name e.g. wikitext or visualeditor\n\t\t * @method\n\t\t */\n\t\tfunction logInit( editor ) {\n\t\t\tif ( firstInitDone ) {\n\t\t\t\teditorOptions.sessionId = user.generateRandomSessionId();\n\t\t\t}\n\t\t\tmw.track( 'mf.schemaEditAttemptStep', {\n\t\t\t\taction: 'init',\n\t\t\t\ttype: 'section',\n\t\t\t\tmechanism: initMechanism,\n\t\t\t\t/* eslint-disable camelcase */\n\t\t\t\teditor_interface: editor,\n\t\t\t\tediting_session_id: editorOptions.sessionId\n\t\t\t\t/* eslint-enable camelcase */\n\t\t\t} );\n\t\t\tfirstInitDone = true;\n\t\t}\n\n\t\t/**\n\t\t * Check whether VisualEditor should be loaded\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {bool}\n\t\t */\n\t\tfunction shouldLoadVisualEditor() {\n\t\t\tvar\n\t\t\t\t// FIXME: Should we consider default site options and user prefs?\n\t\t\t\tisVisualEditorEnabled = !!veConfig,\n\t\t\t\tpreferredEditor = getPreferredEditor(),\n\t\t\t\tvisualEditorNamespaces = ( veConfig && veConfig.namespaces ) || [];\n\n\t\t\treturn isVisualEditorEnabled &&\n\n\t\t\t\t// Only for pages with a wikitext content model\n\t\t\t\tpage.isWikiText() &&\n\n\t\t\t\t// Only in enabled namespaces\n\t\t\t\tvisualEditorNamespaces.indexOf( mw.config.get( 'wgNamespaceNumber' ) ) !== -1 &&\n\n\t\t\t\t// Not on pages which are outputs of the Page Translation feature\n\t\t\t\tmw.config.get( 'wgTranslatePageTranslation' ) !== 'translation' &&\n\n\t\t\t\t(\n\t\t\t\t\t// If the user prefers the VisualEditor or the user has no preference and\n\t\t\t\t\t// the VisualEditor is the default editor for this wiki\n\t\t\t\t\tpreferredEditor === 'VisualEditor' ||\n\t\t\t\t\t// We've loaded it via the URL for this request\n\t\t\t\t\teditorOverride === 'VisualEditor'\n\t\t\t\t) &&\n\n\t\t\t\teditorOverride !== 'SourceEditor';\n\t\t}\n\n\t\t/**\n\t\t * Load source editor\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {jQuery.Promise} Promise resolved with the editor overlay\n\t\t */\n\t\tfunction loadSourceEditor() {\n\t\t\tlogInit( 'wikitext' );\n\t\t\t// Inform other interested code that we're loading the editor\n\t\t\tmw.hook( 'mobileFrontend.editorOpening' ).fire();\n\n\t\t\treturn mw.loader.using( 'mobile.editor.overlay' ).then( function () {\n\t\t\t\tvar SourceEditorOverlay = M.require( 'mobile.editor.overlay/SourceEditorOverlay' );\n\t\t\t\treturn new SourceEditorOverlay( editorOptions );\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Load visual editor. If it fails to load for any reason, load the source editor instead.\n\t\t *\n\t\t * @private\n\t\t * @ignore\n\t\t * @method\n\t\t * @return {jQuery.Promise} Promise resolved with the editor overlay\n\t\t */\n\t\tfunction loadVisualEditorMaybe() {\n\t\t\tlogInit( 'visualeditor' );\n\t\t\t// Inform other interested code that we're loading the editor\n\t\t\tmw.hook( 'mobileFrontend.editorOpening' ).fire();\n\n\t\t\teditorOptions.mode = 'visual';\n\t\t\teditorOptions.dataPromise = mw.loader.using( 'ext.visualEditor.targetLoader' ).then( function () {\n\t\t\t\tabortableDataPromise = mw.libs.ve.targetLoader.requestPageData(\n\t\t\t\t\teditorOptions.mode,\n\t\t\t\t\teditorOptions.titleObj.getPrefixedDb(),\n\t\t\t\t\t{\n\t\t\t\t\t\tsessionStore: true,\n\t\t\t\t\t\tsection: editorOptions.sectionId === undefined ?\n\t\t\t\t\t\t\tnull : editorOptions.sectionId,\n\t\t\t\t\t\toldId: editorOptions.oldId || undefined,\n\t\t\t\t\t\t// Should be ve.init.mw.MobileArticleTarget.static.trackingName,\n\t\t\t\t\t\t// but the class hasn't loaded yet.\n\t\t\t\t\t\ttargetName: 'mobile'\n\t\t\t\t\t} );\n\t\t\t\treturn abortableDataPromise;\n\t\t\t} );\n\n\t\t\treturn mw.loader.using( 'ext.visualEditor.targetLoader' )\n\t\t\t\t.then( function () {\n\t\t\t\t\tmw.libs.ve.targetLoader.addPlugin( 'mobile.editor.ve' );\n\t\t\t\t\treturn mw.libs.ve.targetLoader.loadModules( editorOptions.mode );\n\t\t\t\t} )\n\t\t\t\t.then( function () {\n\t\t\t\t\tvar VisualEditorOverlay = M.require( 'mobile.editor.overlay/VisualEditorOverlay' ),\n\t\t\t\t\t\tSourceEditorOverlay = M.require( 'mobile.editor.overlay/SourceEditorOverlay' );\n\t\t\t\t\teditorOptions.SourceEditorOverlay = SourceEditorOverlay;\n\t\t\t\t\treturn new VisualEditorOverlay( editorOptions );\n\t\t\t\t}, function () {\n\t\t\t\t\treturn loadSourceEditor();\n\t\t\t\t} );\n\t\t}\n\n\t\tanimationDelayDeferred = util.Deferred();\n\n\t\t// showLoading() has to run after the overlay has opened, which disables page scrolling.\n\t\t// clearLoading() has to run after the loading overlay is hidden in any way\n\t\t// (either when loading is aborted, or when the editor overlay is shown instead).\n\t\tloadingOverlay = editorLoadingOverlay( showLoading, clearLoading );\n\n\t\tif ( shouldLoadVisualEditor() ) {\n\t\t\toverlayPromise = loadVisualEditorMaybe();\n\t\t} else {\n\t\t\toverlayPromise = loadSourceEditor();\n\t\t}\n\n\t\t// Wait for the scroll animation to finish before we show the editor overlay\n\t\tutil.Promise.all( [ overlayPromise, animationDelayDeferred ] ).then( function ( overlay ) {\n\t\t\t// Wait for the data to load before we show the editor overlay\n\t\t\toverlay.getLoadingPromise().then( function () {\n\t\t\t\t// Make sure the user did not close the loading overlay while we were waiting\n\t\t\t\tvar overlayData = overlayManager.stack[0];\n\t\t\t\tif ( !overlayData || overlayData.overlay !== loadingOverlay ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Show the editor!\n\t\t\t\toverlayManager.replaceCurrent( overlay );\n\t\t\t}, function ( error, apiResponse ) {\n\t\t\t\t// Could not load the editor.\n\t\t\t\toverlayManager.router.back();\n\t\t\t\tif ( error.show ) {\n\t\t\t\t\t// Probably a blockMessageDrawer returned because the user is blocked.\n\t\t\t\t\tdocument.body.appendChild( error.$el[ 0 ] );\n\t\t\t\t\terror.show();\n\t\t\t\t} else if ( apiResponse ) {\n\t\t\t\t\tmw.notify( editorOptions.api.getErrorMessage( apiResponse ) );\n\t\t\t\t} else {\n\t\t\t\t\tmw.notify( mw.msg( 'mobile-frontend-editor-error-loading' ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\n\t\treturn loadingOverlay;\n\t} );\n\n\t$( '#ca-edit a' ).prop( 'href', function ( i, href ) {\n\t\ttry {\n\t\t\tvar editUri = new mw.Uri( href );\n\t\t\t// By default the editor opens section 0 (lead section), rather than the whole article.\n\t\t\t// This might be changed in the future (T210659).\n\t\t\teditUri.query.section = '0';\n\t\t\treturn editUri.toString();\n\t\t} catch ( e ) {\n\t\t\t// T106244 - the href couldn't be parsed likely due to invalid UTF-8\n\t\t\treturn href;\n\t\t}\n\t} );\n\n\t// We use wgAction instead of getParamValue('action') as the former can be\n\t// overridden by hooks to stop the editor loading automatically.\n\tif ( !router.getPath() && ( mw.util.getParamValue( 'veaction' ) || mw.config.get( 'wgAction' ) === 'edit' ) ) {\n\t\tif ( mw.util.getParamValue( 'veaction' ) === 'edit' ) {\n\t\t\teditorOverride = 'VisualEditor';\n\t\t} else if ( mw.util.getParamValue( 'veaction' ) === 'editsource' ) {\n\t\t\teditorOverride = 'SourceEditor';\n\t\t}\n\t\t// else: action=edit, for which we allow the default to take effect\n\t\tfragment = '#/editor/' + ( mw.util.getParamValue( 'section' ) || ( mw.config.get( 'wgAction' ) === 'edit' ? 'all' : '0' ) );\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\tif ( window.history && history.pushState ) {\n\t\t\turi = mw.Uri();\n\t\t\tdelete uri.query.action;\n\t\t\tdelete uri.query.veaction;\n\t\t\tdelete uri.query.section;\n\t\t\t// Note: replaceState rather than pushState, because we're\n\t\t\t// just reformatting the URL to the equivalent-meaning for the\n\t\t\t// mobile site.\n\t\t\thistory.replaceState( null, document.title, uri.toString() + fragment );\n\t\t} else {\n\t\t\trouter.navigate( fragment );\n\t\t}\n\t}\n}\n\n/**\n * Hide any section id icons in the page. This will not hide the edit icon in the page action\n * menu.\n *\n * @method\n * @ignore\n * @param {PageHTMLParser} currentPageHTMLParser\n */\nfunction hideSectionEditIcons( currentPageHTMLParser ) {\n\tcurrentPageHTMLParser.$el.find( '.mw-editsection' ).hide();\n}\n\n/**\n * Show a drawer with log in / sign up buttons.\n *\n * @method\n * @ignore\n * @param {Router} router\n */\nfunction bindEditLinksLoginDrawer( router ) {\n\tvar drawer;\n\tfunction showLoginDrawer() {\n\t\tif ( !drawer ) {\n\t\t\tdrawer = new CtaDrawer( {\n\t\t\t\tcontent: mw.msg( 'mobile-frontend-editor-disabled-anon' ),\n\t\t\t\tsignupQueryParams: {\n\t\t\t\t\twarning: 'mobile-frontend-watchlist-signup-action'\n\t\t\t\t}\n\t\t\t} );\n\t\t\tdocument.body.appendChild( drawer.$el[ 0 ] );\n\t\t}\n\t\tdrawer.show();\n\t}\n\t$editTab.on( 'click', function ( ev ) {\n\t\tshowLoginDrawer();\n\t\tev.preventDefault();\n\t} );\n\tmw.hook( 'wikipage.content' ).add( function ( $content ) {\n\t\t$content.find( EDITSECTION_SELECTOR ).on( 'click', function ( ev ) {\n\t\t\tshowLoginDrawer();\n\t\t\tev.preventDefault();\n\t\t} );\n\t} );\n\trouter.route( editorPath, function () {\n\t\tshowLoginDrawer();\n\t} );\n\trouter.checkRoute();\n}\n\n/**\n * Setup the editor if the user can edit the page otherwise show a sorry toast.\n *\n * @method\n * @ignore\n * @param {Page} currentPage\n * @param {PageHTMLParser} currentPageHTMLParser\n * @param {Skin} skin\n * @param {Router} router\n */\nfunction init( currentPage, currentPageHTMLParser, skin, router ) {\n\tvar isReadOnly, isEditable, editErrorMessage, editRestrictions;\n\t// see: https://www.mediawiki.org/wiki/Manual:Interface/JavaScript#Page-specific\n\tisReadOnly = mw.config.get( 'wgMinervaReadOnly' );\n\tisEditable = !isReadOnly && mw.config.get( 'wgIsProbablyEditable' );\n\n\tif ( isEditable ) {\n\t\t// Edit button updated in setupEditor.\n\t\tsetupEditor( currentPage, skin, currentPageHTMLParser, router );\n\t} else {\n\t\thideSectionEditIcons( currentPageHTMLParser );\n\t\teditRestrictions = mw.config.get( 'wgRestrictionEdit' );\n\t\tif ( mw.user.isAnon() && Array.isArray( editRestrictions ) && !editRestrictions.length ) {\n\t\t\tbindEditLinksLoginDrawer( router );\n\t\t} else {\n\t\t\tvar $link = $( '<a>' ).attr( 'href', '/wiki/' + mw.config.get( 'wgPageName' ) + '?action=edit' );\n\t\t\teditErrorMessage = isReadOnly ? mw.msg( 'apierror-readonly' ) : mw.message( 'mobile-frontend-editor-disabled', $link ).parseDom();\n\t\t\tbindEditLinksSorryToast( editErrorMessage, router );\n\t\t}\n\t}\n}\n\n/**\n * Wire up events that ensure we\n * show a toast message with sincere condolences when user navigates to\n * #/editor or clicks on an edit button\n *\n * @method\n * @ignore\n * @param {string} msg Message for sorry message\n * @param {Router} router\n */\nfunction bindEditLinksSorryToast( msg, router ) {\n\t$editTab.on( 'click', function ( ev ) {\n\t\tmw.notify( msg );\n\t\tev.preventDefault();\n\t} );\n\tmw.hook( 'wikipage.content' ).add( function ( $content ) {\n\t\t$content.find( EDITSECTION_SELECTOR ).on( 'click', function ( ev ) {\n\t\t\tmw.notify( msg );\n\t\t\tev.preventDefault();\n\t\t} );\n\t} );\n\trouter.route( editorPath, function () {\n\t\tmw.notify( msg );\n\t} );\n\trouter.checkRoute();\n}\n\nmodule.exports = function ( currentPage, currentPageHTMLParser, skin ) {\n\tvar isMissing = currentPage.id === 0,\n\t\trouter = mw.loader.require( 'mediawiki.router' ),\n\t\tisEditingSupported = router.isSupported();\n\n\tif ( contentModel !== 'wikitext' ) {\n\t\t// Only load the wikitext editor on wikitext. Otherwise we'll rely on the fallback behaviour\n\t\t// (You can test this on MediaWiki:Common.css) ?action=edit url (T173800)\n\t\treturn;\n\t}\n\n\tif ( mw.util.getParamValue( 'undo' ) ) {\n\t\t// Our fancy editor doesn't support undo, but we can rely on the fallback.\n\t\treturn;\n\t}\n\n\tif ( !isEditingSupported ) {\n\t\t// Browser doesn't support mobile editor use the fallback editor.\n\t\treturn;\n\t}\n\n\tif ( currentPage.inNamespace( 'file' ) && isMissing ) {\n\t\t// Is a new file page (enable upload image only) T60311\n\t\tbindEditLinksSorryToast( mw.msg( 'mobile-frontend-editor-uploadenable' ), router );\n\t} else {\n\t\t// Edit button is currently hidden. A call to init() will update it as needed.\n\t\tinit( currentPage, currentPageHTMLParser, skin, router );\n\t}\n};\n","var\n\tfakeToolbar = require( './fakeToolbar' ),\n\tOverlay = require( '../mobile.startup/Overlay' );\n\n/**\n * Like loadingOverlay(), but with a fake editor toolbar instead of the spinner.\n *\n * @param {Function} afterShow Callback which runs after overlay is shown\n * @param {Function} afterHide Callback which runs after overlay is hidden\n * @return {Overlay}\n */\nfunction editorLoadingOverlay( afterShow, afterHide ) {\n\tvar\n\t\t$fakeToolbar = fakeToolbar(),\n\t\toverlay = new Overlay( {\n\t\t\tclassName: 'overlay overlay-loading',\n\t\t\tnoHeader: true,\n\t\t\tisBorderBox: false,\n\t\t\tonBeforeExit: function ( exit ) {\n\t\t\t\texit();\n\t\t\t\tafterHide();\n\t\t\t}\n\t\t} );\n\n\toverlay.show = function () {\n\t\tOverlay.prototype.show.call( this );\n\t\tafterShow();\n\t};\n\n\t$fakeToolbar.appendTo( overlay.$el.find( '.overlay-content' ) );\n\n\t// Animate the toolbar sliding into place.\n\t$fakeToolbar.addClass( 'toolbar-hidden' );\n\tsetTimeout( function () {\n\t\t$fakeToolbar.addClass( 'toolbar-shown' );\n\t\tsetTimeout( function () {\n\t\t\t$fakeToolbar.addClass( 'toolbar-shown-done' );\n\t\t}, 250 );\n\t} );\n\n\treturn overlay;\n}\n\nmodule.exports = editorLoadingOverlay;\n","module.exports = function () {\n\tvar trackdebug = !!mw.util.getParamValue( 'trackdebug' ),\n\t\tutil = require( '../../mobile.startup/util' );\n\n\tif ( !mw.config.exists( 'wgWMESchemaEditAttemptStepSamplingRate' ) ) {\n\t\treturn;\n\t}\n\n\t( function () {\n\t\tvar // Schema class is provided by ext.eventLogging\n\t\t\tSchema = mw.eventLog.Schema,\n\t\t\tuser = mw.user,\n\t\t\tsampleRate = mw.config.get( 'wgWMESchemaEditAttemptStepSamplingRate' ),\n\t\t\tactionPrefixMap = {\n\t\t\t\tfirstChange: 'first_change',\n\t\t\t\tsaveIntent: 'save_intent',\n\t\t\t\tsaveAttempt: 'save_attempt',\n\t\t\t\tsaveSuccess: 'save_success',\n\t\t\t\tsaveFailure: 'save_failure'\n\t\t\t},\n\t\t\ttiming = {},\n\t\t\t/**\n\t\t\t * Edit schema\n\t\t\t * https://meta.wikimedia.org/wiki/Schema:EditAttemptStep\n\t\t\t */\n\t\t\t/* eslint-disable camelcase */\n\t\t\tschemaEditAttemptStep = new Schema(\n\t\t\t\t'EditAttemptStep',\n\t\t\t\tsampleRate,\n\t\t\t\t{\n\t\t\t\t\tpage_id: mw.config.get( 'wgArticleId' ),\n\t\t\t\t\trevision_id: mw.config.get( 'wgRevisionId' ),\n\t\t\t\t\tpage_title: mw.config.get( 'wgPageName' ),\n\t\t\t\t\tpage_ns: mw.config.get( 'wgNamespaceNumber' ),\n\t\t\t\t\tuser_id: user.getId(),\n\t\t\t\t\tuser_class: user.isAnon() ? 'IP' : undefined,\n\t\t\t\t\tuser_editcount: mw.config.get( 'wgUserEditCount', 0 ),\n\t\t\t\t\tmw_version: mw.config.get( 'wgVersion' ),\n\t\t\t\t\tplatform: 'phone',\n\t\t\t\t\tintegration: 'page',\n\t\t\t\t\tpage_token: user.getPageviewToken(),\n\t\t\t\t\tsession_token: user.sessionId(),\n\t\t\t\t\tversion: 1\n\t\t\t\t}\n\t\t\t);\n\t\t\t/* eslint-enable camelcase */\n\n\t\tfunction log() {\n\t\t\t// mw.log is a no-op unless resource loader is in debug mode, so\n\t\t\t// this allows trackdebug to work independently (T211698)\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log.apply( console, arguments );\n\t\t}\n\n\t\tfunction computeDuration( action, event, timeStamp ) {\n\t\t\t// This is duplicated from the VisualEditor extension\n\t\t\t// (ve.init.mw.trackSubscriber.js). Changes to this should be kept in\n\t\t\t// sync with that file, so the data remains consistent.\n\t\t\tif ( event.timing !== undefined ) {\n\t\t\t\treturn event.timing;\n\t\t\t}\n\n\t\t\tswitch ( action ) {\n\t\t\t\tcase 'ready':\n\t\t\t\t\treturn timeStamp - timing.init;\n\t\t\t\tcase 'loaded':\n\t\t\t\t\treturn timeStamp - timing.init;\n\t\t\t\tcase 'firstChange':\n\t\t\t\t\treturn timeStamp - timing.ready;\n\t\t\t\tcase 'saveIntent':\n\t\t\t\t\treturn timeStamp - timing.ready;\n\t\t\t\tcase 'saveAttempt':\n\t\t\t\t\treturn timeStamp - timing.saveIntent;\n\t\t\t\tcase 'saveSuccess':\n\t\t\t\tcase 'saveFailure':\n\t\t\t\t\t// HERE BE DRAGONS: the caller must compute these themselves\n\t\t\t\t\t// for sensible results. Deliberately sabotage any attempts to\n\t\t\t\t\t// use the default by returning -1\n\t\t\t\t\tmw.log.warn( 'mf.schemaEditAttemptStep: Do not rely on default timing value for saveSuccess/saveFailure' );\n\t\t\t\t\treturn -1;\n\t\t\t\tcase 'abort':\n\t\t\t\t\tswitch ( event.abort_type ) {\n\t\t\t\t\t\tcase 'preinit':\n\t\t\t\t\t\t\treturn timeStamp - timing.init;\n\t\t\t\t\t\tcase 'nochange':\n\t\t\t\t\t\tcase 'switchwith':\n\t\t\t\t\t\tcase 'switchwithout':\n\t\t\t\t\t\tcase 'switchnochange':\n\t\t\t\t\t\tcase 'abandon':\n\t\t\t\t\t\t\treturn timeStamp - timing.ready;\n\t\t\t\t\t\tcase 'abandonMidsave':\n\t\t\t\t\t\t\treturn timeStamp - timing.saveAttempt;\n\t\t\t\t\t}\n\t\t\t\t\tmw.log.warn( 'mf.schemaEditAttemptStep: Unrecognized abort type', event.type );\n\t\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tmw.log.warn( 'mf.schemaEditAttemptStep: Unrecognized action', action );\n\t\t\treturn -1;\n\t\t}\n\n\t\tmw.trackSubscribe( 'mf.schemaEditAttemptStep', function ( topic, data ) {\n\t\t\tvar actionPrefix = actionPrefixMap[ data.action ] || data.action,\n\t\t\t\ttimeStamp = mw.now(),\n\t\t\t\tduration = 0;\n\n\t\t\t// These are always the same for every event, but they can't be set in defaults,\n\t\t\t// because the mw.config values are not present yet then, because they are set\n\t\t\t// by JS code in editor.js. This is a little silly.\n\t\t\tif ( !mw.storage.get( 'preferredEditor' ) ) {\n\t\t\t\t// This check serves to stop us logging the id/bucket after the user has\n\t\t\t\t// switched editors for the first time. Future pageloads won't even set\n\t\t\t\t// the config values.\n\t\t\t\tif ( mw.config.get( 'wgMFSchemaEditAttemptStepAnonymousUserId' ) ) {\n\t\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\t\tdata.anonymous_user_token = mw.config.get( 'wgMFSchemaEditAttemptStepAnonymousUserId' );\n\t\t\t\t}\n\t\t\t\tif ( mw.config.get( 'wgMFSchemaEditAttemptStepBucket' ) ) {\n\t\t\t\t\tdata.bucket = mw.config.get( 'wgMFSchemaEditAttemptStepBucket' );\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( !data.anonymous_user_token ) {\n\t\t\t\t// DiscussionTools a/b test\n\t\t\t\tif ( mw.config.get( 'wgDiscussionToolsABTestBucket' ) ) {\n\t\t\t\t\tdata.bucket = mw.config.get( 'wgDiscussionToolsABTestBucket' );\n\t\t\t\t}\n\t\t\t\tif ( mw.user.isAnon() ) {\n\t\t\t\t\tvar token = mw.cookie.get( 'DTABid', '' );\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\t\t\tdata.anonymous_user_token = token;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Schema's kind of a mess of special properties\n\t\t\tif ( data.action === 'init' || data.action === 'abort' || data.action === 'saveFailure' ) {\n\t\t\t\tdata[ actionPrefix + '_type' ] = data.type;\n\t\t\t}\n\t\t\tif ( data.action === 'init' || data.action === 'abort' ) {\n\t\t\t\tdata[ actionPrefix + '_mechanism' ] = data.mechanism;\n\t\t\t}\n\t\t\tif ( data.action !== 'init' ) {\n\t\t\t\t// Schema actually does have an init_timing field, but we don't want to\n\t\t\t\t// store it because it's not meaningful.\n\t\t\t\tduration = Math.round( computeDuration( data.action, data, timeStamp ) );\n\t\t\t\tdata[ actionPrefix + '_timing' ] = duration;\n\t\t\t}\n\t\t\tif ( data.action === 'saveFailure' ) {\n\t\t\t\tdata[ actionPrefix + '_message' ] = data.message;\n\t\t\t}\n\n\t\t\t// Remove renamed properties\n\t\t\tdelete data.type;\n\t\t\tdelete data.mechanism;\n\t\t\tdelete data.timing;\n\t\t\tdelete data.message;\n\t\t\t// eslint-disable-next-line camelcase\n\t\t\tdata.is_oversample =\n\t\t\t\t!mw.eventLog.inSample( 1 / sampleRate );\n\n\t\t\tif ( data.action === 'abort' && data.abort_type !== 'switchnochange' ) {\n\t\t\t\ttiming = {};\n\t\t\t} else {\n\t\t\t\ttiming[ data.action ] = timeStamp;\n\t\t\t}\n\n\t\t\t// Switching between visual and source produces a chain of\n\t\t\t// abort/ready/loaded events and no init event, so suppress them for\n\t\t\t// consistency with desktop VE's logging.\n\t\t\tif ( data.abort_type === 'switchnochange' ) {\n\t\t\t\t// The initial abort, flagged as a switch\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( timing.abort ) {\n\t\t\t\t// An abort was previously logged\n\t\t\t\tif ( data.action === 'ready' ) {\n\t\t\t\t\t// Just discard the ready\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( data.action === 'loaded' ) {\n\t\t\t\t\t// Switch has finished; remove the abort timing so we stop discarding events.\n\t\t\t\t\tdelete timing.abort;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( trackdebug ) {\n\t\t\t\tlog( topic + '.' + data.action, duration + 'ms', data, schemaEditAttemptStep.defaults );\n\t\t\t} else {\n\t\t\t\tschemaEditAttemptStep.log( data, (\n\t\t\t\t\tmw.config.get( 'wgWMESchemaEditAttemptStepOversample' ) ||\n\t\t\t\t\tmw.config.get( 'wgMFSchemaEditAttemptStepOversample' ) === 'all' ||\n\t\t\t\t\t// wikitext / visualeditor\n\t\t\t\t\tdata.editor_interface === mw.config.get( 'wgMFSchemaEditAttemptStepOversample' )\n\t\t\t\t) ? 1 : sampleRate );\n\n\t\t\t\t// T309013: Also log via the Metrics Platform:\n\t\t\t\tvar eventName = 'eas.mf.' + actionPrefix,\n\t\t\t\t\tcustomData = util.extend(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// Platform can be derived from the agent_client_platform_family\n\t\t\t\t\t\t\t// context attribute mixed in by the JavaScript Metrics Platform\n\t\t\t\t\t\t\t// Client. The context attribute will be \"desktop_browser\" or\n\t\t\t\t\t\t\t// \"mobile_browser\" depending on whether the MobileFrontend extension\n\t\t\t\t\t\t\t// has signalled that it is enabled.\n\t\t\t\t\t\t\t// platform: 'phone',\n\n\t\t\t\t\t\t\tintegration: 'page'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata\n\t\t\t\t\t);\n\n\t\t\t\tdelete customData.action;\n\n\t\t\t\t// Sampling rate (and therefore whether a stream should oversample) is captured in\n\t\t\t\t// the stream config ($wgEventStreams).\n\t\t\t\tdelete customData.is_oversample;\n\n\t\t\t\tmw.eventLog.dispatch( eventName, customData );\n\t\t\t}\n\t\t} );\n\n\t}() );\n};\n","module.exports = function () {\n\tvar trackdebug = !!mw.util.getParamValue( 'trackdebug' );\n\n\tif ( !mw.config.exists( 'wgWMESchemaEditAttemptStepSamplingRate' ) ) {\n\t\treturn;\n\t}\n\n\t// VisualEditorFeatureUse is intended to log whenever EditAttemptStep\n\t// does, so this file references its config for sampling rates and\n\t// oversampling.\n\n\t( function () {\n\t\tvar // Schema class provided by ext.eventLogging\n\t\t\tSchema = mw.eventLog.Schema,\n\t\t\tuser = mw.user,\n\t\t\tsampleRate = mw.config.get( 'wgWMESchemaEditAttemptStepSamplingRate' ),\n\t\t\t/**\n\t\t\t * Feature use schema\n\t\t\t * https://meta.wikimedia.org/wiki/Schema:VisualEditorFeatureUse\n\t\t\t */\n\t\t\t/* eslint-disable camelcase */\n\t\t\tschemaVisualEditorFeatureUse = new Schema(\n\t\t\t\t'VisualEditorFeatureUse',\n\t\t\t\tsampleRate,\n\t\t\t\t{\n\t\t\t\t\tuser_id: user.getId(),\n\t\t\t\t\tuser_editcount: mw.config.get( 'wgUserEditCount', 0 ),\n\t\t\t\t\tplatform: 'phone',\n\t\t\t\t\tintegration: 'page'\n\t\t\t\t}\n\t\t\t);\n\t\t\t/* eslint-enable camelcase */\n\n\t\tfunction log() {\n\t\t\t// mw.log is a no-op unless resource loader is in debug mode, so\n\t\t\t// this allows trackdebug to work independently (T211698)\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log.apply( console, arguments );\n\t\t}\n\n\t\tmw.trackSubscribe( 'mf.schemaVisualEditorFeatureUse', function ( topic, data ) {\n\t\t\tvar event = {\n\t\t\t\tfeature: data.feature,\n\t\t\t\taction: data.action,\n\t\t\t\teditingSessionId: data.editing_session_id,\n\t\t\t\t// eslint-disable-next-line camelcase\n\t\t\t\teditor_interface: data.editor_interface\n\t\t\t};\n\n\t\t\tif ( trackdebug ) {\n\t\t\t\tlog( topic, event, schemaVisualEditorFeatureUse.defaults );\n\t\t\t} else {\n\t\t\t\tschemaVisualEditorFeatureUse.log( event, (\n\t\t\t\t\tmw.config.get( 'wgWMESchemaEditAttemptStepOversample' ) ||\n\t\t\t\t\tmw.config.get( 'wgMFSchemaEditAttemptStepOversample' ) === 'visualeditor' ||\n\t\t\t\t\tmw.config.get( 'wgMFSchemaEditAttemptStepOversample' ) === 'all'\n\t\t\t\t) ? 1 : sampleRate );\n\n\t\t\t\t// T309602: Also log via the Metrics Platform:\n\t\t\t\tvar eventName = 'vefu.' + data.action;\n\n\t\t\t\t/* eslint-disable camelcase */\n\t\t\t\tvar customData = {\n\t\t\t\t\tfeature: data.feature,\n\t\t\t\t\tediting_session_id: data.editing_session_id,\n\t\t\t\t\teditor_interface: data.editor_interface,\n\t\t\t\t\tintegration: 'page'\n\t\t\t\t};\n\t\t\t\t/* eslint-enable camelcase */\n\n\t\t\t\tmw.eventLog.dispatch( eventName, customData );\n\t\t\t}\n\t\t} );\n\n\t}() );\n};\n","/* global $ */\nconst lazyImageLoader = require( '../mobile.startup/lazyImages/lazyImageLoader' );\n\n/**\n * Initialise lazy loading images to supplement the HTML changes inside the\n * MobileFormatter.\n *\n * @param {jQuery} $container\n */\nfunction init( $container ) {\n\tconst imagePlaceholders = lazyImageLoader.queryPlaceholders( $container[ 0 ] );\n\n\t// Regardless of whether or not lazy load is turned on\n\t// We need to load in all images before print\n\twindow.addEventListener( 'beforeprint', function () {\n\t\tlazyImageLoader.loadImages( imagePlaceholders );\n\t} );\n\n\tif ( !mw.config.get( 'wgMFLazyLoadImages' ) ) {\n\t\treturn;\n\t}\n\n\tif ( 'IntersectionObserver' in window ) {\n\t\tconst observer = new IntersectionObserver(\n\t\t\t( entries ) => {\n\t\t\t\tentries.forEach( ( entry ) => {\n\t\t\t\t\tconst placeholder = entry.target;\n\t\t\t\t\t// If intersecting load image and stop observing it to free up resources.\n\t\t\t\t\tif ( entry.isIntersecting ) {\n\t\t\t\t\t\tlazyImageLoader.loadImage( placeholder );\n\t\t\t\t\t\tobserver.unobserve( placeholder );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\t// See https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n\t\t\t{\n\t\t\t\t// Setup the area for observing.\n\t\t\t\t// By default the root is the viewport.\n\t\t\t\t// We want the detection area to be as tall as 150% of the viewport height,\n\t\t\t\t// allowing elements to be detected before they reach the viewport.\n\t\t\t\t// This is achieved with a 50% bottom margin.\n\t\t\t\trootMargin: '0px 0px 50% 0px',\n\t\t\t\t// The default is 0 (meaning as soon as even one pixel is visible,\n\t\t\t\t// the callback will be run), however we explicitly set this so that\n\t\t\t\t// it is clear we have made this choice in case we want to revisit later.\n\t\t\t\tthreshold: 0\n\t\t\t}\n\t\t);\n\n\t\t// observe all the placeholders\n\t\timagePlaceholders.forEach( ( placeholder ) => {\n\t\t\tobserver.observe( placeholder );\n\t\t} );\n\t} else {\n\t\t/**\n\t\t * Adds the following class to identify the tap to click images on\n\t\t * older browsers that do not support IntersectionObserver:\n\t\t * lazy-image-placeholder--tap\n\t\t */\n\t\t// eslint-disable-next-line mediawiki/class-doc\n\t\t$( imagePlaceholders ).addClass( `${lazyImageLoader.placeholderClass}--tap` );\n\n\t\t// Tap to show (see T246767)\n\t\tdocument.addEventListener( 'click', function ( ev ) {\n\t\t\tif ( imagePlaceholders.indexOf( ev.target ) > -1 ) {\n\t\t\t\tlazyImageLoader.loadImage( ev.target );\n\t\t\t}\n\t\t} );\n\t}\n}\n\nmodule.exports = function () {\n\tmw.hook( 'wikipage.content' ).add( init );\n};\n","// FIXME: make this an object with a constructor to facilitate testing\n// (see https://bugzilla.wikimedia.org/show_bug.cgi?id=44264)\n/**\n * mobileFrontend namespace\n *\n * @class mw.mobileFrontend\n * @singleton\n */\nvar skin,\n\turl,\n\t{ USER_FONT_SIZE_REGULAR, USER_FONT_SIZES } = require( '../constants' ),\n\tstorage = mw.storage,\n\ttoggling = require( './toggling' ),\n\tlazyLoadedImages = require( './lazyLoadedImages' ),\n\tskinName = mw.config.get( 'skin' ),\n\tisPageContentModelEditable = mw.config.get( 'wgMFIsPageContentModelEditable' ),\n\teditorAvailableSkins = mw.config.get( 'wgMFEditorAvailableSkins' ),\n\teditor = require( './editor' ),\n\tcurrentPage = require( '../mobile.startup/currentPage' )(),\n\tcurrentPageHTMLParser = require( '../mobile.startup/currentPageHTMLParser' )(),\n\tmfUtil = require( '../mobile.startup/util' ),\n\t$window = mfUtil.getWindow(),\n\tSkin = require( '../mobile.startup/Skin' ),\n\teventBus = require( '../mobile.startup/eventBusSingleton' ),\n\tschemaEditAttemptStep = require( './eventLogging/schemaEditAttemptStep' ),\n\tschemaVisualEditorFeatureUse = require( './eventLogging/schemaVisualEditorFeatureUse' );\n\nskin = Skin.getSingleton();\n\n/**\n * Given 2 functions, it returns a function that will run both with it's\n * context and parameters and return the results combined\n *\n * @private\n * @param {Function} fn1\n * @param {Function} fn2\n * @return {Function} which returns void\n */\nfunction apply2( fn1, fn2 ) {\n\treturn function () {\n\t\tfn1.apply( this, arguments );\n\t\tfn2.apply( this, arguments );\n\t};\n}\n\n/**\n * The `window`'s resize event debounced at 100 ms.\n * The `resize:throttled` event is the `window`'s\n * resize event throttled to 200 ms.\n *\n * @event resize\n */\n\n/**\n * The `window`'s scroll event debounced at 100 ms.\n * The `scroll:throttled` event is the `window`'s\n * scroll event throttled to 200 ms.\n *\n * @event scroll\n */\n\n$window\n\t.on( 'resize', apply2(\n\t\tmw.util.debounce( function () { eventBus.emit( 'resize' ); }, 100 ),\n\t\tmw.util.throttle( function () { eventBus.emit( 'resize:throttled' ); }, 200 )\n\t) )\n\t.on( 'scroll', apply2(\n\t\tmw.util.debounce( function () { eventBus.emit( 'scroll' ); }, 100 ),\n\t\tmw.util.throttle( function () { eventBus.emit( 'scroll:throttled' ); }, 200 )\n\t) );\n\n/**\n * Updates the font size based on the current value in storage\n */\nfunction updateFontSize() {\n\tconst userFontSize = storage.get( 'userFontSize', USER_FONT_SIZE_REGULAR );\n\t// The following classes are used here:\n\t// * mf-font-size-small\n\t// * mf-font-size-regular\n\t// * mf-font-size-large\n\t// * mf-font-size-x-large\n\t/* eslint-disable mediawiki/class-doc */\n\tUSER_FONT_SIZES.forEach( function ( fontSize ) {\n\t\tconst fontClass = `mf-font-size-${fontSize}`;\n\t\tif ( fontSize === userFontSize ) {\n\t\t\tdocument.documentElement.classList.add( fontClass );\n\t\t} else {\n\t\t\t// If Safari's back/forward cache is being used the previous class may be present.\n\t\t\tdocument.documentElement.classList.remove( fontClass );\n\t\t}\n\t} );\n\t/* eslint-enable mediawiki/class-doc */\n}\n\n// Hide URL flags used to pass state through reloads\n// venotify is normally handled in ve.init.mw.DesktopArticleTarget.init.js\n// but that's not loaded on mobile\n// eslint-disable-next-line no-restricted-properties\nif ( window.history && history.pushState ) {\n\t// eslint-disable-next-line no-restricted-properties\n\turl = new URL( window.location.href );\n\tif ( url.searchParams.has( 'venotify' ) || url.searchParams.has( 'mfnotify' ) ) {\n\t\turl.searchParams.delete( 'venotify' );\n\t\turl.searchParams.delete( 'mfnotify' );\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\twindow.history.replaceState( null, document.title, url.toString() );\n\t}\n}\n\n// Font must be updated on back button press as users may click\n// back after changing font.\nwindow.addEventListener( 'pageshow', function () {\n\tupdateFontSize();\n} );\n\nupdateFontSize();\n\n// Recruit volunteers through the console\n// (note console.log may not be a function so check via apply)\n/* eslint-disable no-console */\nif ( window.console && window.console.log && window.console.log.apply &&\n\t\tmw.config.get( 'wgMFEnableJSConsoleRecruitment' ) ) {\n\tconsole.log( mw.msg( 'mobile-frontend-console-recruit' ) );\n}\n/* eslint-enable no-console */\n\n// setup editor\nif ( !currentPage.inNamespace( 'special' ) && isPageContentModelEditable ) {\n\t// Mobile editor commonly doesn't work well with other skins than Minerva (it looks horribly\n\t// broken without some styles that are only defined by Minerva). So we only enable it for the\n\t// skin that wants it.\n\tif ( editorAvailableSkins.indexOf( skinName ) !== -1 ) {\n\t\t// TODO: This code should not even be loaded on desktop.\n\t\t// Remove this check when that is fixed (T216537).\n\t\tif ( mw.config.get( 'wgMFMode' ) !== null ) {\n\t\t\teditor( currentPage, currentPageHTMLParser, skin );\n\t\t}\n\t}\n}\n\ntoggling();\nlazyLoadedImages();\n\n// Set up recording for the events we track. The module 'ext.eventLogging'\n// should already be loaded (this doesn't trigger a new HTTP request), but we\n// don't specify a hard dependency because EventLogging may not be installed.\nmw.loader.using( 'ext.eventLogging' ).then( function () {\n\tschemaEditAttemptStep();\n\tschemaVisualEditorFeatureUse();\n} );\n","module.exports = function () {\n\tvar\n\t\tcurrentPage = require( '../mobile.startup/currentPage' )(),\n\t\tToggler = require( '../mobile.startup/Toggler' ),\n\t\teventBus = require( '../mobile.startup/eventBusSingleton' );\n\n\t/**\n\t * Initialises toggling code.\n\t *\n\t * @method\n\t * @param {jQuery.Object} $container to enable toggling on\n\t * @param {string} prefix a prefix to use for the id.\n\t * @param {Page} page The current page\n\t * @ignore\n\t */\n\tfunction init( $container, prefix, page ) {\n\t\t// Only handle headings in content processed by MakeSectionsTransform.\n\t\t// Remove event handler added by MakeSectionsTransform::interimTogglingSupport().\n\t\t$container.find( '.section-heading' ).removeAttr( 'onclick' );\n\t\t// Cleanup global as it is no longer needed. We check if it's undefined because\n\t\t// there is no guarantee this won't be run on other skins e.g. Vector or cached HTML.\n\t\tif ( window.mfTempOpenSection !== undefined ) {\n\t\t\tdelete window.mfTempOpenSection;\n\t\t}\n\t\t// eslint-disable-next-line no-new\n\t\tnew Toggler( {\n\t\t\t$container: $container,\n\t\t\tprefix: prefix,\n\t\t\tpage: page,\n\t\t\teventBus: eventBus\n\t\t} );\n\t}\n\n\tif (\n\t\t// Avoid this running on Watchlist.\n\t\t!currentPage.inNamespace( 'special' ) &&\n\t\tmw.config.get( 'wgAction' ) === 'view'\n\t) {\n\t\tmw.hook( 'wikipage.content' ).add( function ( $container ) {\n\t\t\tvar $contentContainer = $container.find( '.mw-parser-output' );\n\t\t\t// If there was no mw-parser-output wrapper, just use the parent.\n\t\t\tif ( $contentContainer.length === 0 ) {\n\t\t\t\t$contentContainer = $container;\n\t\t\t}\n\t\t\tinit( $contentContainer, 'content-', currentPage );\n\t\t} );\n\t}\n};\n"],"names":["M","require","util","editorLoadingOverlay","OverlayManager","$editTab","$","EDITSECTION_SELECTOR","user","mw","CtaDrawer","contentModel","config","get","veConfig","editCount","editorPath","onEditLinkClick","elem","ev","router","section","length","getParamValue","href","navigate","preventDefault","init","currentPage","currentPageHTMLParser","skin","isReadOnly","editRestrictions","page","uri","fragment","editorOverride","overlayManager","getSingleton","isNewPage","id","firstInitDone","on","this","hook","add","$content","find","sectionId","animationDelayDeferred","abortableDataPromise","loadingOverlay","overlayPromise","scrollTop","window","pageYOffset","$contentText","editorOptions","fakeScroll","api","Api","licenseMsg","getLicenseMsg","title","titleObj","isAnon","oldId","contentLang","attr","contentDir","sessionId","Uri","query","editingStatsId","generateRandomSessionId","initMechanism","logInit","editor","track","action","type","mechanism","editor_interface","editing_session_id","shouldLoadVisualEditor","isVisualEditorEnabled","preferredEditor","defaultEditor","tokenData","options","storage","getObject","expires","Date","now","remove","getPreferredEditor","visualEditorNamespaces","namespaces","isWikiText","indexOf","loadSourceEditor","fire","loader","using","then","undefined","Deferred","$page","$sectionTop","enableVisualSectionEditing","document","body","addClass","closest","prop","getBoundingClientRect","top","css","transform","setTimeout","resolve","abort","removeClass","mode","dataPromise","libs","ve","targetLoader","requestPageData","getPrefixedDb","sessionStore","targetName","addPlugin","loadModules","VisualEditorOverlay","SourceEditorOverlay","Promise","all","overlay","getLoadingPromise","overlayData","stack","replaceCurrent","error","apiResponse","back","show","appendChild","$el","notify","getErrorMessage","msg","i","editUri","toString","e","getPath","history","pushState","veaction","replaceState","setupEditor","hide","hideSectionEditIcons","Array","isArray","drawer","showLoginDrawer","content","signupQueryParams","warning","route","checkRoute","bindEditLinksLoginDrawer","$link","bindEditLinksSorryToast","message","parseDom","module","exports","isMissing","isEditingSupported","isSupported","inNamespace","fakeToolbar","Overlay","afterShow","afterHide","$fakeToolbar","className","noHeader","isBorderBox","onBeforeExit","exit","prototype","call","appendTo","Schema","sampleRate","actionPrefixMap","timing","schemaEditAttemptStep","trackdebug","exists","eventLog","firstChange","saveIntent","saveAttempt","saveSuccess","saveFailure","page_id","revision_id","page_title","page_ns","user_id","getId","user_class","user_editcount","mw_version","platform","integration","page_token","getPageviewToken","session_token","version","trackSubscribe","topic","data","actionPrefix","timeStamp","duration","anonymous_user_token","bucket","token","cookie","Math","round","event","ready","log","warn","abort_type","computeDuration","is_oversample","inSample","console","apply","arguments","defaults","eventName","customData","extend","dispatch","schemaVisualEditorFeatureUse","feature","editingSessionId","lazyImageLoader","$container","imagePlaceholders","queryPlaceholders","addEventListener","loadImages","observer","IntersectionObserver","entries","forEach","entry","placeholder","target","isIntersecting","loadImage","unobserve","rootMargin","threshold","observe","concat","placeholderClass","url","_require","USER_FONT_SIZE_REGULAR","USER_FONT_SIZES","toggling","lazyLoadedImages","skinName","isPageContentModelEditable","editorAvailableSkins","$window","getWindow","Skin","eventBus","apply2","fn1","fn2","updateFontSize","userFontSize","fontSize","fontClass","documentElement","classList","debounce","emit","throttle","URL","location","searchParams","has","delete","Toggler","$contentContainer","prefix","removeAttr","mfTempOpenSection"],"sourceRoot":""}