(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[799],{"./src/mobile.languages.structured/LanguageSearcher.js":(e,t,s)=>{const a=s("./src/mobile.startup/View.js"),n=s("./src/mobile.startup/util.js"),l=s("./src/mobile.languages.structured/util.js");e.exports=class extends a{constructor(e){const t=l.getStructuredLanguages(e.languages,e.variants,l.getFrequentlyUsedLanguages(),e.showSuggestedLanguages,e.deviceLanguage);super(n.extend({className:"language-searcher",events:{"click a":"onLinkClick","click .language-search-banner":"onSearchBannerClick","input .search":"onSearchInput"},inputPlaceholder:mw.msg("mobile-frontend-languages-structured-overlay-search-input-placeholder"),allLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-all-languages-header").toLocaleUpperCase(),suggestedLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-suggested-languages-header").toLocaleUpperCase(),noResultsFoundHeader:mw.msg("mobile-frontend-languages-structured-overlay-no-results"),noResultsFoundMessage:mw.msg("mobile-frontend-languages-structured-overlay-no-results-body"),allLanguages:t.all,allLanguagesCount:t.all.length,suggestedLanguages:t.suggested,suggestedLanguagesCount:t.suggested.length,showSuggestedLanguagesHeader:t.suggested.length>0},e));const s=e.onOpen;s&&setTimeout((()=>{s(this)}),0)}get template(){return n.template('\n<div class="panel">\n\t<div class="panel-body search-box">\n\t\t<input type="search" class="search" placeholder="{{inputPlaceholder}}">\n\t</div>\n</div>\n\n<div class="overlay-content-body">\n\t{{#showSuggestedLanguagesHeader}}\n\t<h3 class="list-header">{{suggestedLanguagesHeader}}</h3>\n\t{{/showSuggestedLanguagesHeader}}\n\t{{#suggestedLanguagesCount}}\n\t<ol class="site-link-list suggested-languages">\n\t\t{{#suggestedLanguages}}\n\t\t\t<li>\n\t\t\t\t<a href="{{url}}" class="{{lang}}" hreflang="{{lang}}" lang="{{lang}}" dir="{{dir}}">\n\t\t\t\t\t<span class="autonym">{{autonym}}</span>\n\t\t\t\t\t{{#title}}\n\t\t\t\t\t\t<span class="title">{{title}}</span>\n\t\t\t\t\t{{/title}}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t{{/suggestedLanguages}}\n\t</ol>\n\t{{/suggestedLanguagesCount}}\n\t{{#bannerHTML}}\n\t<div class="language-search-banner">\n\t\t{{{.}}}\n\t</div>\n\t{{/bannerHTML}}\n\t{{#allLanguagesCount}}\n\t<h3 class="list-header">{{allLanguagesHeader}} ({{allLanguagesCount}})</h3>\n\t<ul class="site-link-list all-languages">\n\t\t{{#allLanguages}}\n\t\t\t<li>\n\t\t\t\t<a href="{{url}}" class="{{lang}}" hreflang="{{lang}}" lang="{{lang}}" dir="{{dir}}">\n\t\t\t\t\t<span class="autonym">{{autonym}}</span>\n\t\t\t\t\t{{#title}}\n\t\t\t\t\t\t<span class="title">{{title}}</span>\n\t\t\t\t\t{{/title}}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t{{/allLanguages}}\n\t</ul>\n\t{{/allLanguagesCount}}\n\t<section class="empty-results hidden">\n\t\t<h4 class="empty-results-header">{{noResultsFoundHeader}}</h4>\n\t\t<p class="empty-results-body">{{noResultsFoundMessage}}</p>\n\t</section>\n</div>\n\t')}postRender(){this.$siteLinksList=this.$el.find(".site-link-list"),this.$languageItems=this.$siteLinksList.find("a"),this.$subheaders=this.$el.find("h3"),this.$emptyResultsSection=this.$el.find(".empty-results")}addBanner(e,t){this.options.bannerHTML=e,this.options.bannerFirstLanguage=t,this.options.showSuggestedLanguagesHeader=!0,this.render()}onSearchBannerClick(){this.$el.find(".search").val(this.options.bannerFirstLanguage).trigger("input")}onLinkClick(e){const t=this.$el.find(e.currentTarget).attr("lang");mw.hook("mobileFrontend.languageSearcher.linkClick").fire(t),l.saveLanguageUsageCount(t,l.getFrequentlyUsedLanguages())}onSearchInput(e){const t=void 0===e.originalEvent?"entrypoint-banner":"ui";this.filterLanguages(e.target.value.toLowerCase(),t)}filterLanguages(e,t){const s=[];e?(this.options.languages.forEach((t=>{const a=t.langname;(t.autonym.toLowerCase().indexOf(e)>-1||a&&a.toLowerCase().indexOf(e)>-1||t.lang.toLowerCase().indexOf(e)>-1)&&s.push(t.lang)})),this.options.variants&&this.options.variants.forEach((t=>{(t.autonym.toLowerCase().indexOf(e)>-1||t.lang.toLowerCase().indexOf(e)>-1)&&s.push(t.lang)})),this.$languageItems.addClass("hidden"),s.length?(this.$siteLinksList.find(`.${mw.util.escapeRegExp(s.join(",."))}`).removeClass("hidden"),this.$emptyResultsSection.addClass("hidden")):(this.$emptyResultsSection.removeClass("hidden"),mw.hook("mobileFrontend.languageSearcher.noresults").fire(e,this.$emptyResultsSection.get(0),t)),this.$siteLinksList.addClass("filtered"),this.$subheaders.addClass("hidden")):(this.$languageItems.removeClass("hidden"),this.$siteLinksList.removeClass("filtered"),this.$subheaders.removeClass("hidden"),this.$emptyResultsSection.addClass("hidden"))}}},"./src/mobile.languages.structured/mobile.languages.structured.js":(e,t,s)=>{const a=s("./src/mobile.startup/moduleLoaderSingleton.js"),n=s("./src/mobile.languages.structured/LanguageSearcher.js");a.define("mobile.languages.structured/LanguageSearcher",n)},"./src/mobile.languages.structured/rtlLanguages.js":e=>{e.exports=["acm","aeb","aeb-arab","apc","ar","arc","arq","ary","arz","azb","bcc","bgn","bqi","ckb","dv","fa","glk","he","hno","khw","kk-arab","kk-cn","ks","ks-arab","ku-arab","lki","lrc","luz","ms-arab","mzn","nqo","pnb","ps","sd","sdh","skr","skr-arab","ug","ug-arab","ur","yi"]},"./src/mobile.languages.structured/util.js":(e,t,s)=>{const a=s("./src/mobile.startup/util.js"),n=s("./src/mobile.languages.structured/rtlLanguages.js");e.exports={getDir:function(e){const t=n.indexOf(e.lang)>-1?"rtl":"ltr";return a.extend({},e,{dir:t})},getStructuredLanguages:function(e,t,s,a,n){const l=Object.prototype.hasOwnProperty;let r=0,g=0,u=[],i=[];n=function(e,t){let s;const a=Object.prototype.hasOwnProperty,n={};if(!t)return;const l=t.indexOf("-");return-1!==l&&(s=t.slice(0,l)),e.forEach((e=>{e.lang!==s&&e.lang!==t||(n[e.lang]=!0)})),a.call(n,t)?t:a.call(n,s)?s:void 0}(e,n),n&&(Object.keys(s).forEach((e=>{const t=s[e];r=r<t?t:r,g=g>t?t:g})),s[n]=r+1);const o=e=>e.dir?e:this.getDir(e);return a?e.map(o).forEach((e=>{l.call(s,e.lang)?(e.frequency=s[e.lang],u.push(e)):i.push(e)})):i=e.map(o),t&&a&&t.map(o).forEach((e=>{l.call(s,e.lang)?e.frequency=s[e.lang]:e.frequency=g-1,u.push(e)})),u=u.sort(((e,t)=>t.frequency-e.frequency)),i=i.sort((function(e,t){return e.autonym.toLocaleLowerCase()<t.autonym.toLocaleLowerCase()?-1:1})),{suggested:u,all:i}},getFrequentlyUsedLanguages:function(){const e=mw.storage.get("langMap");return e?JSON.parse(e):{}},saveFrequentlyUsedLanguages:function(e){mw.storage.set("langMap",JSON.stringify(e))},saveLanguageUsageCount:function(e,t){let s=t[e]||0;s+=1,t[e]=s>100?100:s,this.saveFrequentlyUsedLanguages(t)}}}},e=>{e.O(0,[569],(()=>e(e.s="./src/mobile.languages.structured/mobile.languages.structured.js")));var t=e.O();(this.mfModules=this.mfModules||{})["mobile.languages.structured"]=t}]);
//# sourceMappingURL=mobile.languages.structured.js.map.json