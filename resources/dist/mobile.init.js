(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[243],{"./src/mobile.init/Toggler.js":(e,t,i)=>{const o=i("./src/mobile.startup/util.js"),n=o.escapeSelector,a={icon:"expand",isSmall:!0,additionalClassNames:"indicator"},s=i("./src/mobile.startup/Icon.js"),l=i("./src/mobile.init/isCollapsedByDefault.js");e.exports=class{constructor(e){this.eventBus=e.eventBus,this.$container=e.$container,this.prefix=e.prefix,this.page=e.page,this._enable()}isCollapsedByDefault(){if(void 0===this._isCollapsedByDefault){const e=this.$container.closest(".collapsible-headings-collapsed, .collapsible-headings-expanded");e.length?this._isCollapsedByDefault=e.hasClass("collapsible-headings-collapsed"):this._isCollapsedByDefault=l()}return this._isCollapsedByDefault}_getHeadingTarget(e){return e.querySelector("h1, h2, h3, h4, h5, h6")||e}toggle(e,t){let i=e.data("button")||e.find("button.collapsible-heading-button");if(i.length||(i=e),!t&&(i.hasClass("collapsible-heading-button-disabled")||i.hasClass("collapsible-heading-disabled")))return!1;const o=this._getHeadingTarget(e[0]),n=o.classList.contains("open-block");o.classList.toggle("open-block"),o.classList.add("collapsible-heading"),a.rotation=n?0:180;const l=new s(a),r=e.data("indicator")||i.find(".indicator");r&&r.length&&(r.replaceWith(l.$el),e.data("indicator",l.$el)),i.attr("aria-expanded",n?"false":"true");const c=e.next();return c.hasClass("open-block")?(c.removeClass("open-block"),c.get(0).setAttribute("hidden","until-found")):(c.addClass("open-block"),c.removeAttr("hidden")),mw.requestIdleCallback((()=>{mw.hook("readerExperiments.section-toggled").fire({heading:e.get(0),isExpanded:!n})})),!0}reveal(e){let t;try{t=this.$container.find("#"+n(e))}catch(e){}if(!t||!t.length)return!1;let i=t.parents(".collapsible-heading, .section-heading");return i.length||(i=t.parents(".collapsible-block").prev(".section-heading")),i.length&&((i.data("button")||i.find("button.collapsible-heading-button")).length?this._getHeadingTarget(i[0]).classList.contains("open-block")||this.toggle(i):i.hasClass("collapsible-heading")&&!i.hasClass("open-block")&&this.toggle(i)),i.length&&window.scrollTo(0,t.offset().top),!0}_createHeadingButton(e,t,i,o){const n=this._getHeadingTarget(e);if(n===e)return null;const l=document.createElement("button");l.classList.add("collapsible-heading-button"),l.type="button",l.setAttribute("aria-controls",t),l.setAttribute("aria-expanded",i?"false":"true"),a.rotation=i?0:180;const r=new s(a);return o&&o.length&&o.replaceWith(r.$el),l.insertBefore(r.$el[0],l.firstChild),Array.from(n.childNodes).forEach((e=>{e.nodeType===Node.TEXT_NODE?l.appendChild(document.createTextNode(e.textContent)):e.nodeType===Node.ELEMENT_NODE&&("A"===e.tagName?l.appendChild(e):e.classList.contains("indicator")||l.appendChild(e))})),n.innerHTML="",n.appendChild(l),l}_enable(){this.$container.children(".section-heading").each(((e,t)=>{const i=this.$container.find(t),o=i.find(".indicator"),n=this.prefix+"collapsible-block-"+e;if(i.next().is("section")){const t=i.next("section"),a=this.isCollapsedByDefault();let s=i.find("button.collapsible-heading-button");const l=this._getHeadingTarget(i[0]),r=t.hasClass("open-block")||l.classList.contains("open-block");if(s.length){const e=s.find(".indicator").first();e.length&&i.find(".indicator").not(e).remove()}else{const e=!r&&a;this._createHeadingButton(i[0],n,e,o),s=i.find("button.collapsible-heading-button")}l.classList.add("collapsible-heading"),i.data("section-number",e).data("button",s),!s.length&&i.hasClass("collapsible-heading")&&(s=i),s.on("click",(e=>{e.target.closest("a")||(e.preventDefault(),this.toggle(i))}));const c=s.find(".indicator").first();i.data("indicator",c),t.addClass("collapsible-block").attr({id:n}).on("beforematch",(()=>this.toggle(i))).addClass("collapsible-block-js"),r?(l.classList.add("open-block"),t.addClass("open-block"),t.removeAttr("hidden")):a?t.get(0).setAttribute("hidden","until-found"):(l.classList.add("open-block"),t.addClass("open-block")),s.attr("aria-expanded",r||!a?"true":"false")}}));const e=()=>{let e=window.location.hash;if(0===e.indexOf("#")&&(e=e.slice(1),!this.reveal(e))){const t=mw.util.percentDecodeFragment(e);t&&this.reveal(t)}};!function(){const e=mw.config.get("wgInternalRedirectTargetUrl"),t=!!e&&e.split("#")[1];t&&(window.location.hash=t)}(),e(),o.getWindow().on("hashchange",(()=>e()))}}},"./src/mobile.init/editor.js":(e,t,i)=>{const o=i("./src/mobile.startup/util.js"),n=i("./src/mobile.init/fakeToolbar.js"),a=i("./src/mobile.init/editorLoadingOverlay.js"),s=i("./src/mobile.startup/OverlayManager.js"),l=$("#ca-edit, #ca-editsource, #ca-viewsource, #ca-ve-edit, #ca-ve-create, #ca-createsource"),r=l.length>1,c=".mw-editsection a, .edit-link",d=mw.user,u=i("./src/mobile.startup/CtaDrawer.js"),m=mw.config.get("wgVisualEditorConfig"),g=/^\/editor\/(\d+|T-\d+|all)$/;let p=null;function f(e,t,i){let o;o=0===$(c).length?"all":mw.util.getParamValue("section",e.href)||"all",mw.config.get("wgPageName")===mw.util.getParamValue("title",e.href)&&(r&&("ca-ve-edit"===e.id||"ca-ve-create"===e.id?p="VisualEditor":"ca-editsource"!==e.id&&"ca-createsource"!==e.id||(p="SourceEditor")),i.navigate("#/editor/"+o),t.preventDefault())}function h(){if(p)return p;const e=mw.user.options.get("mobile-editor")||mw.storage.get("preferredEditor");if(e)return e;switch(mw.config.get("wgMFDefaultEditor")){case"source":return"SourceEditor";case"visual":return"VisualEditor";case"preference":return mw.user.options.get("visualeditor-hidebetawelcome")||mw.user.options.get("visualeditor-hideusered")?"visualeditor"===mw.user.options.get("visualeditor-editor")?"VisualEditor":"SourceEditor":"visual"===mw.config.get("wgMFFallbackEditor")?"VisualEditor":"SourceEditor"}return"SourceEditor"}function b(e,t){l.on("click",(t=>{mw.notify(e),t.preventDefault()})),mw.hook("wikipage.content").add((t=>{t.find(c).on("click",(t=>{mw.notify(e),t.preventDefault()}))})),t.addRoute(g,(()=>{mw.notify(e)})),t.checkRoute()}e.exports=function(e,t,i){if(!mw.config.get("wgMFIsSupportedEditRequest"))return;const r=require("mediawiki.router");e.inNamespace("file")&&0===e.id?b(mw.msg("mobile-frontend-editor-uploadenable"),r):function(e,t,i,r){let w,v;const y=mw.config.get("wgMinervaReadOnly");if(!y&&mw.config.get("wgIsProbablyEditable"))!function(e,t,i,r){const u=s.getSingleton(),b=0===e.id;if(l.add(".edit-link").on("click.mfeditlink",(function(e){f(this,e,u.router)})),mw.hook("wikipage.content").add((e=>{e.find(c).off("click.mfeditlink").on("click.mfeditlink",(function(e){f(this,e,u.router)}))})),u.add(g,(s=>{const l=window.pageYOffset,r=$("#mw-content-text"),c=new URL(location.href),g={fakeToolbar:n,overlayManager:u,currentPageHTMLParser:i,fakeScroll:0,api:new mw.Api,licenseMsg:t.getLicenseMsg(),title:e.title,titleObj:e.titleObj,isAnon:d.isAnon(),isNewPage:b,oldId:mw.util.getParamValue("oldid"),contentLang:r.attr("lang"),contentDir:r.attr("dir"),preload:c.searchParams.get("preload"),preloadparams:mw.util.getArrayParam("preloadparams",c.searchParams),editintro:c.searchParams.get("editintro")},f=$.Deferred(),w=o.Deferred();let v,y,k=mw.util.getParamValue("redlink")?"new":"click";function E(e){mw.track("editAttemptStep",{action:"init",type:"section",mechanism:k,integration:"page",editor_interface:e})}function C(){const t=h();return e.isVESourceAvailable()||e.isVEVisualAvailable()&&"VisualEditor"===t}function x(){return E("wikitext"),mw.hook("mobileFrontend.editorOpening").fire(),mw.loader.using("mobile.editor.overlay").then((()=>new(0,require("mobile.editor.overlay").SourceEditorOverlay)(g)))}"all"!==s&&(g.sectionId=e.isWikiText()?s:void 0);const L=a((function(){let e,t,i;$(document.body).addClass("ve-loading");const o=$("#mw-mf-page-center"),n=$("#content");"0"===s||"all"===s?e=$("#bodyContent"):(e=$('a[href$="section='+s+'"],a[href*="section='+s+'&"]').closest(".mw-heading, h1, h2, h3, h4, h5, h6"),e.length||(e=$("#bodyContent"))),o.prop("scrollTop",l),t=e[0].getBoundingClientRect().top,t-=48,C()?(i=!0===m.enableVisualSectionEditing||"mobile"===m.enableVisualSectionEditing,("0"===s||"all"===s||i)&&(t-=16)):"0"!==s&&"all"!==s||(t-=16),n.css({transform:"translate( 0, "+-t+"px )","padding-bottom":"+="+t,"margin-bottom":"-="+t}),g.fakeScroll=t,setTimeout(w.resolve,500)}),(function(){v&&v.abort&&v.abort(),$("#content").css({transform:"","padding-bottom":"","margin-bottom":""}),$(document.body).removeClass("ve-loading")}),C()?function(){k="tooslow",f.reject(),v&&v.abort&&v.abort()}:null);return y=C()?function(){E("visualeditor"),mw.hook("mobileFrontend.editorOpening").fire(),g.mode=mw.config.get("wgMFEnableVEWikitextEditor")&&"SourceEditor"===h()?"source":"visual",g.dataPromise=mw.loader.using("ext.visualEditor.targetLoader").then((()=>(v=mw.libs.ve.targetLoader.requestPageData(g.mode,g.titleObj.getPrefixedDb(),{sessionStore:!0,section:void 0===g.sectionId?null:g.sectionId,oldId:g.oldId||void 0,preload:g.preload,preloadparams:g.preloadparams,editintro:g.editintro,targetName:"mobile"}),v)));const e=mw.loader.using("ext.visualEditor.targetLoader").then((()=>mw.loader.using("mobile.editor.overlay").then((()=>(mw.libs.ve.targetLoader.addPlugin("ext.visualEditor.mobileArticleTarget"),mw.config.get("wgMFEnableVEWikitextEditor")&&mw.libs.ve.targetLoader.addPlugin("ext.visualEditor.mwwikitext"),mw.libs.ve.targetLoader.loadModules(g.mode)))))),t=$.Deferred();return e.then(t.resolve,t.reject),f.then(t.reject,t.reject),t.then((()=>{const e=require("mobile.editor.overlay"),t=e.VisualEditorOverlay,i=e.SourceEditorOverlay;return g.SourceEditorOverlay=i,new t(g)}),(()=>x()))}():x(),o.Promise.all([y,w]).then((e=>{e.getLoadingPromise().catch((t=>"rejected"===f.state()?x().then((t=>(e=t).getLoadingPromise())):$.Deferred().reject(t).promise())).then((()=>{const t=u.stack[0];t&&t.overlay===L&&u.replaceCurrent(e)}),((e,t)=>{u.router.back(),e.show?(document.body.appendChild(e.$el[0]),e.show()):t?mw.notify(g.api.getErrorMessage(t)):mw.notify(mw.msg("mobile-frontend-editor-error-loading"))}))})),p=null,L})),$("#ca-edit a, a#ca-edit, #ca-editsource a, a#ca-editsource").prop("href",((e,t)=>{const i=new URL(t,location.href);return i.searchParams.set("section","0"),i.toString()})),!r.getPath()&&(mw.util.getParamValue("veaction")||"edit"===mw.config.get("wgAction"))){"edit"===mw.util.getParamValue("veaction")?p="VisualEditor":"editsource"===mw.util.getParamValue("veaction")&&(p="SourceEditor");const e="#/editor/"+(mw.util.getParamValue("section")||("edit"===mw.config.get("wgAction")?"all":"0"));if(window.history&&history.pushState){const e=new URL(location.href);e.searchParams.delete("action"),e.searchParams.delete("veaction"),e.searchParams.delete("section"),history.replaceState(null,document.title,e)}o.docReady((()=>{r.navigate(e)}))}}(e,i,t,r);else if(function(e){e.$el.find(".mw-editsection").hide()}(t),v=mw.config.get("wgRestrictionEdit"),mw.user.isAnon()&&Array.isArray(v)&&!v.length)!function(e){let t;function i(){t||(t=new u({content:mw.msg("mobile-frontend-editor-disabled-anon"),signupQueryParams:{warning:"mobile-frontend-watchlist-signup-action"}}),document.body.appendChild(t.$el[0])),t.show()}l.on("click",(e=>{i(),e.preventDefault()})),mw.hook("wikipage.content").add((e=>{e.find(c).on("click",(e=>{i(),e.preventDefault()}))})),e.addRoute(g,(()=>{i()})),e.checkRoute()}(r);else{const e=$("<a>").attr("href",mw.util.getUrl(mw.config.get("wgPageName"),{action:"edit"}));w=y?mw.msg("apierror-readonly"):mw.message("mobile-frontend-editor-disabled",e).parseDom(),b(w,r)}}(e,t,i,r)}},"./src/mobile.init/editorLoadingOverlay.js":(e,t,i)=>{const o=i("./src/mobile.init/fakeToolbar.js"),n=i("./src/mobile.startup/IconButton.js"),a=i("./src/mobile.startup/Overlay.js");e.exports=function(e,t,i){let s;const l=o(),r=$("<div>").addClass("ve-loadbasiceditor"),c=new n({label:mw.msg("mobile-frontend-editor-loadbasiceditor"),action:"progressive",weight:"normal",size:"medium",isIconOnly:!1,icon:null}),d=new a({className:"overlay overlay-loading",noHeader:!0,isBorderBox:!1,onBeforeExit:e=>{e(),t(),s&&clearTimeout(s)}}),u=function(e,t){mw.track("visualEditorFeatureUse",{feature:e,action:t,editor_interface:"visualeditor"})};return d.show=function(){a.prototype.show.call(this),e()},d.$el.find(".overlay-content").append(l),i&&(d.$el.find(".overlay-content").append(r.append($("<p>").text(mw.msg("mobile-frontend-editor-loadingtooslow")),c.$el)),s=setTimeout((()=>{r.addClass("ve-loadbasiceditor-shown"),u("mobileVisualFallback","context-show")}),3e3),c.$el.on("click",(()=>{r.removeClass("ve-loadbasiceditor-shown"),u("mobileVisualFallback","fallback-confirm"),i()}))),l.addClass("toolbar-hidden"),setTimeout((()=>{l.addClass("toolbar-shown"),setTimeout((()=>{l.addClass("toolbar-shown-done")}),250)})),d}},"./src/mobile.init/fakeToolbar.js":(e,t,i)=>{const o=i("./src/mobile.startup/icons.js");e.exports=function(){const e=o.cancel().$el,t=o.spinner({tagName:"span",isIconOnly:!1,label:mw.msg("mobile-frontend-editor-loading")}).$el;return $("<div>").addClass("ve-mobile-fakeToolbar-container").append($("<div>").addClass("ve-mobile-fakeToolbar-header").addClass("overlay-header").append($("<div>").addClass("ve-mobile-fakeToolbar").append(e,t)))}},"./src/mobile.init/isCollapsedByDefault.js":(e,t,i)=>{const o=i("./src/mobile.startup/Browser.js").getSingleton();e.exports=function(){return!o.isWideScreen()&&!document.documentElement.classList.contains("mf-expand-sections-clientpref-1")}},"./src/mobile.init/lazyLoadedImages.js":(e,t,i)=>{const o=i("./src/mobile.startup/lazyImages/lazyImageLoader.js");function n(){window.addEventListener("beforeprint",(()=>{Array.prototype.forEach.call(document.querySelectorAll("img"),(e=>{e.loading="eager"}))}))}function a(e){if(!(e[0]instanceof HTMLElement))return;if(e.find("[data-mw-parsoid-version]").length)return n();const t=o.queryPlaceholders(e[0]);if(window.addEventListener("beforeprint",(()=>{o.loadImages(t)})),!mw.config.get("wgMFLazyLoadImages"))return;const i=new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target;e.isIntersecting&&(o.loadImage(t),i.unobserve(t))}))}),{rootMargin:"0px 0px 50% 0px",threshold:0});t.forEach((e=>{i.observe(e)}))}mw.hook("mobileFrontend.loadLazyImages").add((e=>{const t=o.queryPlaceholders(e[0]);o.loadImages(t)}));const s=function(){mw.hook("wikipage.content").add(a)};s.test={initNative:n},e.exports=s},"./src/mobile.init/mobile.init.js":(e,t,i)=>{let o;const n=i("./src/mobile.init/toggling.js"),a=i("./src/mobile.init/lazyLoadedImages.js"),s=i("./src/mobile.init/editor.js"),l=i("./src/mobile.startup/currentPage.js")(),r=i("./src/mobile.startup/currentPageHTMLParser.js")(),c=i("./src/mobile.startup/util.js").getWindow(),d=i("./src/mobile.startup/Skin.js"),u=i("./src/mobile.startup/eventBusSingleton.js"),m=d.getSingleton();function g(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}c.on("resize",g(mw.util.debounce((()=>{u.emit("resize")}),100),mw.util.throttle((()=>{u.emit("resize:throttled")}),200))).on("scroll",g(mw.util.debounce((()=>{u.emit("scroll")}),100),mw.util.throttle((()=>{u.emit("scroll:throttled")}),200))),window.history&&history.pushState&&(o=new URL(window.location.href),(o.searchParams.has("venotify")||o.searchParams.has("mfnotify"))&&(o.searchParams.delete("venotify"),o.searchParams.delete("mfnotify"),window.history.replaceState(null,document.title,o.toString()))),window.console&&window.console.log&&window.console.log.apply&&mw.config.get("wgMFEnableJSConsoleRecruitment")&&console.log(mw.msg("mobile-frontend-console-recruit")),s(l,r,m),n(),a()},"./src/mobile.init/sectionCollapsing.js":(e,t,i)=>{const o=i("./src/mobile.init/isCollapsedByDefault.js");function n(e,t,i){i?(e.setAttribute("aria-expanded","false"),t.classList.add("mf-icon-expand"),t.classList.remove("mf-icon-collapse")):(e.setAttribute("aria-expanded","true"),t.classList.add("mf-icon-collapse"),t.classList.remove("mf-icon-expand")),mw.hook("readerExperiments.section-toggled").fire({heading:e,isExpanded:!i})}function a(e,t,i,o){e.hidden=!!o&&"until-found",n(t,i,o)}function s(e,t,i){a(e,t,i,!e.hidden)}e.exports={init:function(e){let t;const i=e.closest(".collapsible-headings-collapsed, .collapsible-headings-expanded");t=i?i.classList.contains("collapsible-headings-collapsed"):o(),Array.from(e.querySelectorAll(".mw-parser-output > section > .mw-heading")).forEach((e=>{const i=e.nextElementSibling;if("DIV"!==i.tagName)return;const o=function(e,t){e.classList.add("mf-collapsible-heading"),t.classList.add("mf-collapsible-content"),e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-controls",t.id);const i=document.createElement("span");return i.classList.add("mf-icon","mf-icon--small","mf-collapsible-icon"),i.setAttribute("aria-hidden",!0),e.prepend(i),i}(e,i);!function(e,t,i){t.addEventListener("beforematch",(()=>{n(e,i,!1)})),e.addEventListener("click",(o=>{o.target.closest("a")||s(t,e,i)})),e.addEventListener("keypress",(o=>{o.target.closest("a")||13!==o.which&&32!==o.which||s(t,e,i)}))}(e,i,o),a(i,e,o,t)}))}}},"./src/mobile.init/toggling.js":(e,t,i)=>{e.exports=function(){const e=i("./src/mobile.startup/currentPage.js")(),t=i("./src/mobile.init/Toggler.js"),o=i("./src/mobile.init/sectionCollapsing.js"),n=i("./src/mobile.startup/eventBusSingleton.js");e.inNamespace("special")||"view"!==mw.config.get("wgAction")&&"edit"!==mw.config.get("wgAction")||mw.hook("wikipage.content").add((i=>{let a=i.find(".mw-parser-output");0===a.length&&(a=i),function(e,i,a){document.querySelector(".mw-parser-output[data-mw-parsoid-version]")?o.init(e[0]):(e.find(".section-heading").removeAttr("onclick"),void 0!==window.mfTempOpenSection&&delete window.mfTempOpenSection,new t({$container:e,prefix:"content-",page:a,eventBus:n}))}(a,0,e)}))}}},e=>{e.O(0,[569],(()=>e(e.s="./src/mobile.init/mobile.init.js")));var t=e.O();(this.mfModules=this.mfModules||{})["mobile.init"]=t}]);
//# sourceMappingURL=mobile.init.js.map.json