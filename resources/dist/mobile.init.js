(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[243],{"./src/mobile.init/editor.js":(e,t,i)=>{var n=i("./src/mobile.startup/moduleLoaderSingleton.js"),o=i("./src/mobile.startup/util.js"),a=i("./src/mobile.init/editorLoadingOverlay.js"),r=i("./src/mobile.startup/OverlayManager.js"),s=$("#ca-edit"),c=".mw-editsection a, .edit-link",l=mw.user,m=i("./src/mobile.startup/CtaDrawer.js"),d=mw.config.get("wgPageContentModel"),g=mw.config.get("wgVisualEditorConfig"),u=mw.config.get("wgUserEditCount"),w=/^\/editor\/(\d+|T-\d+|all)$/;function f(e,t,i){var n;n=0===$(c).length?"all":mw.util.getParamValue("section",e.href)||"all",mw.config.get("wgPageName")===mw.util.getParamValue("title",e.href)&&(i.navigate("#/editor/"+n),t.preventDefault())}function p(e,t,i,d){var p,h;if(!(p=mw.config.get("wgMinervaReadOnly"))&&mw.config.get("wgIsProbablyEditable"))!function(e,t,i,m){var d,p,v,h=r.getSingleton(),b=0===e.id,S=!1;s.on("click",(function(e){f(this,e,h.router)})),mw.hook("wikipage.content").add((function(e){e.find(c).on("click",(function(e){f(this,e,h.router)}))})),h.add(w,(function(r){var s,c,m,d,w=window.pageYOffset,f=$("#mw-content-text"),p={overlayManager:h,currentPageHTMLParser:i,fakeScroll:0,api:new mw.Api,licenseMsg:t.getLicenseMsg(),title:e.title,titleObj:e.titleObj,isAnon:l.isAnon(),isNewPage:b,editCount:u,oldId:mw.util.getParamValue("oldid"),contentLang:f.attr("lang"),contentDir:f.attr("dir"),sessionId:mw.config.get("wgWMESchemaEditAttemptStepSessionId")||mw.Uri().query.editingStatsId||l.generateRandomSessionId()},y=mw.util.getParamValue("redlink")?"new":"click";function E(e){S&&(p.sessionId=l.generateRandomSessionId()),mw.track("mf.schemaEditAttemptStep",{action:"init",type:"section",mechanism:y,editor_interface:e,editing_session_id:p.sessionId}),S=!0}function k(){var t=!!g,i=function(){var e,t,i=mw.user.options.get("mobile-editor")||mw.storage.get("preferredEditor");if(i)return i;switch(e=mw.config.get("wgMFDefaultEditor"),(t=mw.storage.getObject("MFDefaultEditorABToken"))&&t.expires<Date.now()&&(mw.storage.remove("MFDefaultEditorABToken"),t=null),e){case"source":return"SourceEditor";case"visual":return"VisualEditor";case"preference":return(mw.user.options.get("visualeditor-hidebetawelcome")||mw.user.options.get("visualeditor-hideusered"))&&"visualeditor"===mw.user.options.get("visualeditor-editor")?"VisualEditor":"SourceEditor"}return"SourceEditor"}(),n=g&&g.namespaces||[];return t&&e.isWikiText()&&-1!==n.indexOf(mw.config.get("wgNamespaceNumber"))&&"translation"!==mw.config.get("wgTranslatePageTranslation")&&("VisualEditor"===i||"VisualEditor"===v)&&"SourceEditor"!==v}function _(){return E("wikitext"),mw.hook("mobileFrontend.editorOpening").fire(),mw.loader.using("mobile.editor.overlay").then((function(){return new(n.require("mobile.editor.overlay/SourceEditorOverlay"))(p)}))}return"all"!==r&&(p.sectionId=e.isWikiText()?r:void 0),s=o.Deferred(),m=a((function(){var e,t,i,n,o;$(document.body).addClass("ve-loading"),e=$("#mw-mf-page-center"),t=$("#content"),"0"===r||"all"===r?i=$("#bodyContent"):(i=$('[data-section="'+r+'"]').closest("h1, h2, h3, h4, h5, h6")).length||(i=$("#bodyContent")),e.prop("scrollTop",w),n=i[0].getBoundingClientRect().top,n-=48,k()?(o=!0===g.enableVisualSectionEditing||"mobile"===g.enableVisualSectionEditing,("0"===r||"all"===r||o)&&(n-=16)):"0"!==r&&"all"!==r||(n-=16),t.css({transform:"translate( 0, "+-n+"px )","padding-bottom":"+="+n,"margin-bottom":"-="+n}),p.fakeScroll=n,setTimeout(s.resolve,500)}),(function(){c&&c.abort&&c.abort(),$("#content").css({transform:"","padding-bottom":"","margin-bottom":""}),$(document.body).removeClass("ve-loading")})),k()?(E("visualeditor"),mw.hook("mobileFrontend.editorOpening").fire(),p.mode="visual",p.dataPromise=mw.loader.using("ext.visualEditor.targetLoader").then((function(){return c=mw.libs.ve.targetLoader.requestPageData(p.mode,p.titleObj.getPrefixedDb(),{sessionStore:!0,section:void 0===p.sectionId?null:p.sectionId,oldId:p.oldId||void 0,targetName:"mobile"})})),d=mw.loader.using("ext.visualEditor.targetLoader").then((function(){return mw.libs.ve.targetLoader.addPlugin("mobile.editor.ve"),mw.libs.ve.targetLoader.loadModules(p.mode)})).then((function(){var e=n.require("mobile.editor.overlay/VisualEditorOverlay"),t=n.require("mobile.editor.overlay/SourceEditorOverlay");return p.SourceEditorOverlay=t,new e(p)}),(function(){return _()}))):d=_(),o.Promise.all([d,s]).then((function(e){e.getLoadingPromise().then((function(){var t=h.stack[0];t&&t.overlay===m&&h.replaceCurrent(e)}),(function(e,t){h.router.back(),e.show?(document.body.appendChild(e.$el[0]),e.show()):t?mw.notify(p.api.getErrorMessage(t)):mw.notify(mw.msg("mobile-frontend-editor-error-loading"))}))})),m})),$("#ca-edit a").prop("href",(function(e,t){try{var i=new mw.Uri(t);return i.query.section="0",i.toString()}catch(e){return t}})),m.getPath()||!mw.util.getParamValue("veaction")&&"edit"!==mw.config.get("wgAction")||("edit"===mw.util.getParamValue("veaction")?v="VisualEditor":"editsource"===mw.util.getParamValue("veaction")&&(v="SourceEditor"),p="#/editor/"+(mw.util.getParamValue("section")||("edit"===mw.config.get("wgAction")?"all":"0")),window.history&&history.pushState?(delete(d=mw.Uri()).query.action,delete d.query.veaction,delete d.query.section,history.replaceState(null,document.title,d.toString()+p)):m.navigate(p))}(e,i,t,d);else if(function(e){e.$el.find(".mw-editsection").hide()}(t),h=mw.config.get("wgRestrictionEdit"),mw.user.isAnon()&&Array.isArray(h)&&!h.length)!function(e){var t;function i(){t||(t=new m({content:mw.msg("mobile-frontend-editor-disabled-anon"),signupQueryParams:{warning:"mobile-frontend-watchlist-signup-action"}}),document.body.appendChild(t.$el[0])),t.show()}s.on("click",(function(e){i(),e.preventDefault()})),mw.hook("wikipage.content").add((function(e){e.find(c).on("click",(function(e){i(),e.preventDefault()}))})),e.route(w,(function(){i()})),e.checkRoute()}(d);else{var b=$("<a>").attr("href","/wiki/"+mw.config.get("wgPageName")+"?action=edit");v(p?mw.msg("apierror-readonly"):mw.message("mobile-frontend-editor-disabled",b).parseDom(),d)}}function v(e,t){s.on("click",(function(t){mw.notify(e),t.preventDefault()})),mw.hook("wikipage.content").add((function(t){t.find(c).on("click",(function(t){mw.notify(e),t.preventDefault()}))})),t.route(w,(function(){mw.notify(e)})),t.checkRoute()}e.exports=function(e,t,i){var n=0===e.id,o=mw.loader.require("mediawiki.router"),a=o.isSupported();"wikitext"===d&&(mw.util.getParamValue("undo")||a&&(e.inNamespace("file")&&n?v(mw.msg("mobile-frontend-editor-uploadenable"),o):p(e,t,i,o)))}},"./src/mobile.init/editorLoadingOverlay.js":(e,t,i)=>{var n=i("./src/mobile.init/fakeToolbar.js"),o=i("./src/mobile.startup/Overlay.js");e.exports=function(e,t){var i=n(),a=new o({className:"overlay overlay-loading",noHeader:!0,isBorderBox:!1,onBeforeExit:function(e){e(),t()}});return a.show=function(){o.prototype.show.call(this),e()},i.appendTo(a.$el.find(".overlay-content")),i.addClass("toolbar-hidden"),setTimeout((function(){i.addClass("toolbar-shown"),setTimeout((function(){i.addClass("toolbar-shown-done")}),250)})),a}},"./src/mobile.init/eventLogging/schemaEditAttemptStep.js":(e,t,i)=>{e.exports=function(){var e,t,n,o,a,r,s=!!mw.util.getParamValue("trackdebug"),c=i("./src/mobile.startup/util.js");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&(e=mw.eventLog.Schema,t=mw.user,n=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),o={firstChange:"first_change",saveIntent:"save_intent",saveAttempt:"save_attempt",saveSuccess:"save_success",saveFailure:"save_failure"},a={},r=new e("EditAttemptStep",n,{page_id:mw.config.get("wgArticleId"),revision_id:mw.config.get("wgRevisionId"),page_title:mw.config.get("wgPageName"),page_ns:mw.config.get("wgNamespaceNumber"),user_id:t.getId(),user_class:t.isAnon()?"IP":void 0,user_editcount:mw.config.get("wgUserEditCount",0),mw_version:mw.config.get("wgVersion"),platform:"phone",integration:"page",page_token:t.getPageviewToken(),session_token:t.sessionId(),version:1}),mw.trackSubscribe("mf.schemaEditAttemptStep",(function(e,t){var i=o[t.action]||t.action,l=mw.now(),m=0;if(mw.storage.get("preferredEditor")||(mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")&&(t.anonymous_user_token=mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")),mw.config.get("wgMFSchemaEditAttemptStepBucket")&&(t.bucket=mw.config.get("wgMFSchemaEditAttemptStepBucket"))),!t.anonymous_user_token&&(mw.config.get("wgDiscussionToolsABTestBucket")&&(t.bucket=mw.config.get("wgDiscussionToolsABTestBucket")),mw.user.isAnon())){var d=mw.cookie.get("DTABid","");d&&(t.anonymous_user_token=d)}if("init"!==t.action&&"abort"!==t.action&&"saveFailure"!==t.action||(t[i+"_type"]=t.type),"init"!==t.action&&"abort"!==t.action||(t[i+"_mechanism"]=t.mechanism),"init"!==t.action&&(m=Math.round(function(e,t,i){if(void 0!==t.timing)return t.timing;switch(e){case"ready":case"loaded":return i-a.init;case"firstChange":case"saveIntent":return i-a.ready;case"saveAttempt":return i-a.saveIntent;case"saveSuccess":case"saveFailure":return mw.log.warn("mf.schemaEditAttemptStep: Do not rely on default timing value for saveSuccess/saveFailure"),-1;case"abort":switch(t.abort_type){case"preinit":return i-a.init;case"nochange":case"switchwith":case"switchwithout":case"switchnochange":case"abandon":return i-a.ready;case"abandonMidsave":return i-a.saveAttempt}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized abort type",t.type),-1}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized action",e),-1}(t.action,t,l)),t[i+"_timing"]=m),"saveFailure"===t.action&&(t[i+"_message"]=t.message),delete t.type,delete t.mechanism,delete t.timing,delete t.message,t.is_oversample=!mw.eventLog.inSample(1/n),"abort"===t.action&&"switchnochange"!==t.abort_type?a={}:a[t.action]=l,"switchnochange"!==t.abort_type){if(a.abort){if("ready"===t.action)return;if("loaded"===t.action)return void delete a.abort}if(s)!function(){console.log.apply(console,arguments)}(e+"."+t.action,m+"ms",t,r.defaults);else{r.log(t,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||t.editor_interface===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:n);var g="eas.mf."+i,u=c.extend({integration:"page"},t);delete u.action,delete u.is_oversample,mw.eventLog.dispatch(g,u)}}})))}},"./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js":e=>{e.exports=function(){var e,t,i,n,o=!!mw.util.getParamValue("trackdebug");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&(e=mw.eventLog.Schema,t=mw.user,i=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),n=new e("VisualEditorFeatureUse",i,{user_id:t.getId(),user_editcount:mw.config.get("wgUserEditCount",0),platform:"phone",integration:"page"}),mw.trackSubscribe("mf.schemaVisualEditorFeatureUse",(function(e,t){var a={feature:t.feature,action:t.action,editingSessionId:t.editing_session_id,editor_interface:t.editor_interface};if(o)!function(){console.log.apply(console,arguments)}(e,a,n.defaults);else{n.log(a,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"visualeditor"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:i);var r="vefu."+t.action,s={feature:t.feature,editing_session_id:t.editing_session_id,editor_interface:t.editor_interface,integration:"page"};mw.eventLog.dispatch(r,s)}})))}},"./src/mobile.init/lazyLoadedImages.js":(e,t,i)=>{var n=i("./src/mobile.startup/lazyImages/lazyImageLoader.js");function o(e){var t=n.queryPlaceholders(e[0]);if(window.addEventListener("beforeprint",(function(){n.loadImages(t)})),mw.config.get("wgMFLazyLoadImages"))if("IntersectionObserver"in window){var i=new IntersectionObserver((function(e){e.forEach((function(e){var t=e.target;e.isIntersecting&&(n.loadImage(t),i.unobserve(t))}))}),{rootMargin:"0px 0px 50% 0px",threshold:0});t.forEach((function(e){i.observe(e)}))}else $(t).addClass("".concat(n.placeholderClass,"--tap")),document.addEventListener("click",(function(e){t.indexOf(e.target)>-1&&n.loadImage(e.target)}))}e.exports=function(){mw.hook("wikipage.content").add(o)}},"./src/mobile.init/mobile.init.js":(e,t,i)=>{var n,o,a=i("./src/constants.js"),r=a.USER_FONT_SIZE_REGULAR,s=a.USER_FONT_SIZES,c=mw.storage,l=i("./src/mobile.init/toggling.js"),m=i("./src/mobile.init/lazyLoadedImages.js"),d=mw.config.get("skin"),g=mw.config.get("wgMFIsPageContentModelEditable"),u=mw.config.get("wgMFEditorAvailableSkins"),w=i("./src/mobile.init/editor.js"),f=i("./src/mobile.startup/currentPage.js")(),p=i("./src/mobile.startup/currentPageHTMLParser.js")(),v=i("./src/mobile.startup/util.js").getWindow(),h=i("./src/mobile.startup/Skin.js"),b=i("./src/mobile.startup/eventBusSingleton.js"),S=i("./src/mobile.init/eventLogging/schemaEditAttemptStep.js"),y=i("./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js");function E(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function k(){var e=c.get("userFontSize",r);s.forEach((function(t){var i="mf-font-size-".concat(t);t===e?document.documentElement.classList.add(i):document.documentElement.classList.remove(i)}))}n=h.getSingleton(),v.on("resize",E(mw.util.debounce((function(){b.emit("resize")}),100),mw.util.throttle((function(){b.emit("resize:throttled")}),200))).on("scroll",E(mw.util.debounce((function(){b.emit("scroll")}),100),mw.util.throttle((function(){b.emit("scroll:throttled")}),200))),window.history&&history.pushState&&((o=new URL(window.location.href)).searchParams.has("venotify")||o.searchParams.has("mfnotify"))&&(o.searchParams.delete("venotify"),o.searchParams.delete("mfnotify"),window.history.replaceState(null,document.title,o.toString())),window.addEventListener("pageshow",(function(){k()})),k(),window.console&&window.console.log&&window.console.log.apply&&mw.config.get("wgMFEnableJSConsoleRecruitment")&&console.log(mw.msg("mobile-frontend-console-recruit")),!f.inNamespace("special")&&g&&-1!==u.indexOf(d)&&null!==mw.config.get("wgMFMode")&&w(f,p,n),l(),m(),mw.loader.using("ext.eventLogging").then((function(){S(),y()}))},"./src/mobile.init/toggling.js":(e,t,i)=>{e.exports=function(){var e=i("./src/mobile.startup/currentPage.js")(),t=i("./src/mobile.startup/Toggler.js"),n=i("./src/mobile.startup/eventBusSingleton.js");e.inNamespace("special")||"view"!==mw.config.get("wgAction")||mw.hook("wikipage.content").add((function(i){var o=i.find(".mw-parser-output");0===o.length&&(o=i),function(e,i,o){e.find(".section-heading").removeAttr("onclick"),void 0!==window.mfTempOpenSection&&delete window.mfTempOpenSection,new t({$container:e,prefix:"content-",page:o,eventBus:n})}(o,0,e)}))}}},e=>{e.O(0,[569],(()=>e(e.s="./src/mobile.init/mobile.init.js")));var t=e.O();(this.mfModules=this.mfModules||{})["mobile.init"]=t}]);
//# sourceMappingURL=mobile.init.js.map.json