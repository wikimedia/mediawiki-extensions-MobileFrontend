{"version":3,"file":"mobile.special.mobileoptions.scripts.js","mappings":"mIACA,IAAIA,EAAUC,GAAGD,QAChBE,EAAcD,GAAGE,KAAKD,YACtBE,EAAM,IAAIH,GAAGI,IACbC,EAAUC,EAAAA,mCAAAA,eACVC,EAAQD,EAAS,4CACjBE,EAAcF,EAAS,mDACvBG,EAAsB,iBACtBC,EAAMV,GAAGU,IAETC,EAAyB,UASzBC,EAAgB,eAMjB,SAASC,EAAQC,GACXA,EACJP,EAAMQ,iBAAkBL,EAAK,kCAE7BV,GAAGa,OAAQH,EAAK,iCAElB,CAQA,SAASM,EAAaC,EAASC,GAC9B,IAAIC,EAASC,EAAG,SAQhB,OAPAD,EAAOE,OAAQD,EAAG,YAAaE,KAAML,IACrCE,EAAOE,OACND,EAAG,SACDG,SAAU,sBACVD,KAAMJ,IAGF,IAAIM,GAAGC,GAAGC,YAAa,CAC7BC,MAAOR,GAET,CA6LAnB,GAAG4B,OAAOC,MAAO,mBAAoBC,MA1CrC,WACC,IAAIC,EAAQX,EAAG,mBACdY,EAAcZ,EAAG,uBACjBa,EAAab,EAAG,sBAChBc,EAAU,GAENF,EAAYG,QAChBD,EAAQE,KAAM,CACbC,IAAKL,EACLM,SAAU,WAAa,IAGpBL,EAAWE,QACfD,EAAQE,KAAM,CACbC,IAAKJ,EACLK,SAAU,SAAWC,IACdA,GAAS/B,EAAYgC,eAAeC,oBAGzCjC,EAAYgC,eAAeE,0BAE7B,IAhFH,SAAwBC,EAAeZ,GACtCY,EAAcC,SAAS,SAAWC,GACjC,IAECC,EACAC,EACAC,EAHAC,EAAiBJ,EAAaR,IAK/BU,EAAevB,GAAGC,GAAGyB,OAAQD,GAC7BD,EAAYD,EAAaI,UAEzBL,EAAe,IAAItB,GAAGC,GAAG2B,mBAAoB,CAC5Cb,MAAOQ,EAAaM,gBAKRF,SAASG,YAAaN,GAInCA,EAAUO,OAKVP,EAAUQ,GAAI,UAAU,WAEvBR,EAAUS,KAAM,YAAY,GAC5BX,EAAaY,SAAUX,EAAaM,aACrC,IACAP,EAAaU,GAAI,UAAU,SAAWjB,GAErCM,EAAaP,SAAUC,GAMvBO,EAAaY,SAAW,WAAa,EAErCV,EAAUW,KAAM,SACdC,KAAM,UAAWrB,GACnB1B,GAAQ,GAKRgD,YAAY,WACX9B,EAAM+B,QAAS,SAChB,GAAG,IACJ,GACD,GACD,CA8BCC,CAAe7B,EAASH,IAKtB1B,EAAQ2D,gBAGThE,GAAGiE,OAAOC,IAAK,kCA1HjB,SAAqCnC,GACpC,IAAIoC,EAAIC,EAERD,EAAK,IAAI3C,GAAGC,GAAG2B,mBAAoB,CAClCiB,KAAM5D,EACN8B,MAA8C,SAAvCxC,EAAQmE,IAAKzD,KAErB2D,EAAU,IAAI5C,GAAGC,GAAG6C,YACnBH,EACA,CACCxC,MAAOX,EACNhB,GAAGU,IAAK,0CACRV,GAAGU,IAAK,gDACPyC,WAGJgB,EAAGX,GAAI,UAAU,SAAWjB,GAC3BxC,EAAQwE,IAAK9D,EAAqB8B,EAAQ,OAAS,SACnD1B,GACD,IAEAuD,EAAQjB,SAASqB,UAAWzC,EAC7B,CAsGE0C,CAA4B1C,GAGxB/B,GAAGiE,OAAOC,IAAK,0BAjLrB,SAA+BnC,GAC9B,IAAI2C,EAAaC,EAChBC,EAAoB5E,GAAGE,KAAK2E,SAC3B5E,EAAYiE,IAAKtD,GACjBZ,GAAGE,KAAK4E,QAAQZ,IAAKtD,GACvB+D,EAAsB,IAAInD,GAAGC,GAAGsD,oBAAqB,CACpDxC,MAAOqC,GAAmBjE,EAC1BmE,QAAS,CACR,CACCE,KA1DoB,QA2DpBrD,MAAOjB,EAAK,6CAEb,CACCsE,KAAMrE,EACNgB,MAAOjB,EAAK,8CAEb,CACCsE,KAhEoB,QAiEpBrD,MAAOjB,EAAK,6CAEb,CACCsE,KAnEqB,SAoErBrD,MAAOjB,EAAK,iDAIfgE,EAAc,IAAIlD,GAAGC,GAAG6C,YACvBK,EACA,CACChD,MAAOX,EAAahB,GAAGU,IAAK,oCAC3BV,GAAGU,IAAK,qCAAuCyC,WAGlDwB,EAAoBnB,GAAI,UAAU,SAAWjB,GACvCvC,GAAGE,KAAK2E,SACZ5E,EAAYsE,IAAK3D,EAAe2B,GAEhCpC,EAAI8E,WAAYrE,EAAe2B,GAEhC1B,GACD,IAEA6D,EAAYvB,SAASqB,UAAWzC,EACjC,CAuIEmD,CAAsBnD,EAExB,G","sources":["webpack://mfModules/./src/mobile.special.mobileoptions.scripts.js"],"sourcesContent":["/* global $ */\nvar storage = mw.storage,\n\tclientPrefs = mw.user.clientPrefs,\n\tapi = new mw.Api(),\n\tbrowser = require( './mobile.startup/Browser' ).getSingleton(),\n\ttoast = require( './mobile.startup/showOnPageReload' ),\n\tamcOutreach = require( './mobile.startup/amcOutreach/amcOutreach' ),\n\tEXPAND_SECTIONS_KEY = 'expandSections',\n\tmsg = mw.msg,\n\tUSER_FONT_SIZE_SMALL = 'small',\n\tUSER_FONT_SIZE_REGULAR = 'regular',\n\tUSER_FONT_SIZE_LARGE = 'large',\n\tUSER_FONT_SIZE_XLARGE = 'xlarge',\n\t// FIXME: This value should be synced between back-end and front-end code,\n\t// but it's currently hard-coded because ResourceLoader virtual imports\n\t// i.e. require( './config.json') are incompatible with the\n\t// Webpack build. Requires updating to Webpack 5 and common.js magic comments.\n\t// https://webpack.js.org/configuration/module/#moduleparserjavascriptcommonjsmagiccomments\n\t// e.g: require(/* webpackIgnore: true */ './config.json');\n\tFONT_SIZE_KEY = 'mf-font-size';\n/**\n * Notifies the user that settings were asynchronously saved.\n *\n * @param {boolean} [isPending] if set toast will show after page has been reloaded.\n */\nfunction notify( isPending ) {\n\tif ( isPending ) {\n\t\ttoast.showOnPageReload( msg( 'mobile-frontend-settings-save' ) );\n\t} else {\n\t\tmw.notify( msg( 'mobile-frontend-settings-save' ) );\n\t}\n}\n/**\n * Creates a label for use with a form input\n *\n * @param {string} heading\n * @param {string} description\n * @return {OO.ui.LabelWidget}\n */\nfunction createLabel( heading, description ) {\n\tvar $label = $( '<div>' );\n\t$label.append( $( '<strong>' ).text( heading ) );\n\t$label.append(\n\t\t$( '<div>' )\n\t\t\t.addClass( 'option-description' )\n\t\t\t.text( description )\n\t);\n\n\treturn new OO.ui.LabelWidget( {\n\t\tlabel: $label\n\t} );\n}\n\n/**\n * Adds a font changer field to the form\n *\n * @param {jQuery.Object} $form\n */\nfunction addFontChangerToForm( $form ) {\n\tvar fontChanger, fontChangerDropdown,\n\t\tcurrentFontSize = ( mw.user.isAnon() ) ?\n\t\t\tclientPrefs.get( FONT_SIZE_KEY ) :\n\t\t\tmw.user.options.get( FONT_SIZE_KEY );\n\tfontChangerDropdown = new OO.ui.DropdownInputWidget( {\n\t\tvalue: currentFontSize || USER_FONT_SIZE_REGULAR,\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdata: USER_FONT_SIZE_SMALL,\n\t\t\t\tlabel: msg( 'mobile-frontend-fontchanger-option-small' )\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: USER_FONT_SIZE_REGULAR,\n\t\t\t\tlabel: msg( 'mobile-frontend-fontchanger-option-medium' )\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: USER_FONT_SIZE_LARGE,\n\t\t\t\tlabel: msg( 'mobile-frontend-fontchanger-option-large' )\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: USER_FONT_SIZE_XLARGE,\n\t\t\t\tlabel: msg( 'mobile-frontend-fontchanger-option-xlarge' )\n\t\t\t}\n\t\t]\n\t} );\n\tfontChanger = new OO.ui.FieldLayout(\n\t\tfontChangerDropdown,\n\t\t{\n\t\t\tlabel: createLabel( mw.msg( 'mobile-frontend-fontchanger-link' ),\n\t\t\t\tmw.msg( 'mobile-frontend-fontchanger-desc' ) ).$element\n\t\t}\n\t);\n\tfontChangerDropdown.on( 'change', function ( value ) {\n\t\tif ( mw.user.isAnon() ) {\n\t\t\tclientPrefs.set( FONT_SIZE_KEY, value );\n\t\t} else {\n\t\t\tapi.saveOption( FONT_SIZE_KEY, value );\n\t\t}\n\t\tnotify();\n\t} );\n\n\tfontChanger.$element.prependTo( $form );\n}\n\n/**\n * Adds an expand all sections field to the form\n *\n * @param {jQuery.Object} $form\n */\nfunction addExpandAllSectionsToForm( $form ) {\n\tvar cb, cbField;\n\n\tcb = new OO.ui.ToggleSwitchWidget( {\n\t\tname: EXPAND_SECTIONS_KEY,\n\t\tvalue: storage.get( EXPAND_SECTIONS_KEY ) === 'true'\n\t} );\n\tcbField = new OO.ui.FieldLayout(\n\t\tcb,\n\t\t{\n\t\t\tlabel: createLabel(\n\t\t\t\tmw.msg( 'mobile-frontend-expand-sections-status' ),\n\t\t\t\tmw.msg( 'mobile-frontend-expand-sections-description' )\n\t\t\t).$element\n\t\t}\n\t);\n\tcb.on( 'change', function ( value ) {\n\t\tstorage.set( EXPAND_SECTIONS_KEY, value ? 'true' : 'false' );\n\t\tnotify();\n\t} );\n\n\tcbField.$element.prependTo( $form );\n}\n\n/**\n * Helper method to infuse checkbox elements with OO magic\n * Additionally it applies all known hacks to make it mobile friendly\n *\n * @param {Object[]} toggleObjects an array of toggle objects to infuse\n * @param {jQuery.Object} $form form to submit when there is interaction with toggle\n */\nfunction infuseToggles( toggleObjects, $form ) {\n\ttoggleObjects.forEach( function ( toggleObject ) {\n\t\tvar\n\t\t\t$toggleElement = toggleObject.$el,\n\t\t\ttoggleSwitch,\n\t\t\tenableToggle,\n\t\t\t$checkbox;\n\n\t\tenableToggle = OO.ui.infuse( $toggleElement );\n\t\t$checkbox = enableToggle.$element;\n\n\t\ttoggleSwitch = new OO.ui.ToggleSwitchWidget( {\n\t\t\tvalue: enableToggle.isSelected()\n\t\t} );\n\t\t// Strangely the ToggleSwitchWidget does not behave as an input so any change\n\t\t// to it is not reflected in the form. (see T182466)\n\t\t// Ideally we'd replaceWith here and not have to hide the original element.\n\t\ttoggleSwitch.$element.insertAfter( $checkbox );\n\t\t// although the checkbox is hidden already, that is done via visibility\n\t\t// as a result, it still takes up space. We don't want it to any more now that the\n\t\t// new toggle switch has been added.\n\t\t$checkbox.hide();\n\n\t\t// listening on checkbox change is required to make the clicking on label working.\n\t\t// Otherwise clicking on label changes the checkbox \"checked\" state\n\t\t// but it's not reflected in the toggle switch\n\t\t$checkbox.on( 'change', function () {\n\t\t\t// disable checkbox as submit is delayed by 0.25s\n\t\t\t$checkbox.attr( 'disabled', true );\n\t\t\ttoggleSwitch.setValue( enableToggle.isSelected() );\n\t\t} );\n\t\ttoggleSwitch.on( 'change', function ( value ) {\n\t\t\t// execute callback\n\t\t\ttoggleObject.onToggle( value );\n\n\t\t\t// ugly hack, we're delaying submit form by 0.25s\n\t\t\t// and we want to disable registering clicks\n\t\t\t// we want to disable the toggleSwitch\n\t\t\t// but we cannot use setDisabled(true) as it makes button gray\n\t\t\ttoggleSwitch.setValue = function () {};\n\n\t\t\t$checkbox.find( 'input' )\n\t\t\t\t.prop( 'checked', value );\n\t\t\tnotify( true );\n\t\t\t// On some Android devices animation gets stuck in the middle as browser\n\t\t\t// starts submitting the form.\n\t\t\t// Let's call submit on the form after toggle button transition is done\n\t\t\t// (0.25s, defined in OOUI)\n\t\t\tsetTimeout( function () {\n\t\t\t\t$form.trigger( 'submit' );\n\t\t\t}, 250 );\n\t\t} );\n\t} );\n}\n\n/**\n * Add features, that depends on localStorage, such as \"expand all sections\" or \"fontchanger\".\n * The checkbox is used for turning on/off expansion of all sections on page load.\n */\nfunction initMobileOptions() {\n\tvar $form = $( '#mobile-options' ),\n\t\t$betaToggle = $( '#enable-beta-toggle' ),\n\t\t$amcToggle = $( '#enable-amc-toggle' ),\n\t\ttoggles = [];\n\n\tif ( $betaToggle.length ) {\n\t\ttoggles.push( {\n\t\t\t$el: $betaToggle,\n\t\t\tonToggle: function () {}\n\t\t} );\n\t}\n\tif ( $amcToggle.length ) {\n\t\ttoggles.push( {\n\t\t\t$el: $amcToggle,\n\t\t\tonToggle: function ( value ) {\n\t\t\t\tif ( !value && amcOutreach.loadCampaign().isCampaignActive() ) {\n\t\t\t\t\t// Make all amc outreach actions ineligible so the user doesn't have\n\t\t\t\t\t// to see the outreach drawer again\n\t\t\t\t\tamcOutreach.loadCampaign().makeAllActionsIneligible();\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\tinfuseToggles( toggles, $form );\n\n\tif (\n\t\t// Don't show this option on large screens since it's only honored for small screens.\n\t\t// This logic should be kept in sync with Toggle._enable().\n\t\t!browser.isWideScreen() &&\n\t\t// don't add the option if the sections are set by default as the setting doesn't\n\t\t// work in the opposite direction! (more background on T239195)\n\t\tmw.config.get( 'wgMFCollapseSectionsByDefault' )\n\t) {\n\t\taddExpandAllSectionsToForm( $form );\n\t}\n\n\tif ( mw.config.get( 'wgMFEnableFontChanger' ) ) {\n\t\taddFontChangerToForm( $form );\n\t}\n}\n\nmw.loader.using( 'oojs-ui-widgets' ).then( initMobileOptions );\n"],"names":["storage","mw","clientPrefs","user","api","Api","browser","require","toast","amcOutreach","EXPAND_SECTIONS_KEY","msg","USER_FONT_SIZE_REGULAR","FONT_SIZE_KEY","notify","isPending","showOnPageReload","createLabel","heading","description","$label","$","append","text","addClass","OO","ui","LabelWidget","label","loader","using","then","$form","$betaToggle","$amcToggle","toggles","length","push","$el","onToggle","value","loadCampaign","isCampaignActive","makeAllActionsIneligible","toggleObjects","forEach","toggleObject","toggleSwitch","enableToggle","$checkbox","$toggleElement","infuse","$element","ToggleSwitchWidget","isSelected","insertAfter","hide","on","attr","setValue","find","prop","setTimeout","trigger","infuseToggles","isWideScreen","config","get","cb","cbField","name","FieldLayout","set","prependTo","addExpandAllSectionsToForm","fontChanger","fontChangerDropdown","currentFontSize","isAnon","options","DropdownInputWidget","data","saveOption","addFontChangerToForm"],"sourceRoot":""}