(self.webpackChunkmfModules=self.webpackChunkmfModules||[]).push([[586],{"./src/mobile.special.nearby.scripts/LocationProvider.js":(e,r,t)=>{var n,s=t("./src/mobile.startup/Browser.js").getSingleton(),i=t("./src/mobile.startup/util.js");n={isAvailable:function(){return s.supportsGeoLocation()},getCurrentPosition:function(){var e=i.Deferred();return n.isAvailable()?navigator.geolocation.getCurrentPosition((function(r){e.resolve({latitude:r.coords.latitude,longitude:r.coords.longitude})}),(function(r){var t;switch(r.code){case r.PERMISSION_DENIED:t="permission";break;case r.TIMEOUT:t="timeout";break;case r.POSITION_UNAVAILABLE:t="location";break;default:t="unknown"}e.reject(t)}),{timeout:1e4,enableHighAccuracy:!0}):e.reject("incompatible"),e}},e.exports=n},"./src/mobile.special.nearby.scripts/NearbyGateway.js":(e,r,t)=>{var n=t("./src/mobile.startup/page/pageJSONParser.js"),s=mw.config.get("wgContentNamespaces"),i=t("./src/mobile.startup/util.js"),a=t("./src/mobile.startup/extendSearchParams.js");function o(e){this.api=e.api}o.prototype={_distanceMessage:function(e){if(e<1){if(e*=100,1e3!=(e=10*Math.ceil(e)))return mw.msg("mobile-frontend-nearby-distance-meters",mw.language.convertNumber(e));e=1}else e>2?(e*=10,e=(e=Math.ceil(e)/10).toFixed(1)):(e*=100,e=(e=Math.ceil(e)/100).toFixed(2));return mw.msg("mobile-frontend-nearby-distance",mw.language.convertNumber(e))},getPages:function(e,r,t){return this._search({ggscoord:[e.latitude,e.longitude]},r,t)},getPagesAroundPage:function(e,r){return this._search({ggspage:e},r,e)},_search:function(e,r,t){var o,c=i.Deferred(),u=this;return o=a("nearby",{colimit:"max",prop:["coordinates"],generator:"geosearch",ggsradius:r,ggsnamespace:s,ggslimit:50},e),e.ggscoord?o.codistancefrompoint=e.ggscoord:e.ggspage&&(o.codistancefrompage=e.ggspage),this.api.ajax(o).then((function(e){var r;(r=(r=e.query&&e.query.pages||[]).map((function(e,r){var s,i;return(i=n.parse(e)).anchor="item_"+r,e.coordinates?(s=e.coordinates[0],i.dist=s.dist/1e3,i.latitude=s.lat,i.longitude=s.lon,i.proximity=u._distanceMessage(i.dist)):i.dist=0,t!==e.title?i:null})).filter((function(e){return!!e}))).sort((function(e,r){return e.dist>r.dist?1:-1})),0===r.length?c.reject("empty"):c.resolve(r)}),(function(e){c.reject(e)})),c}},e.exports=o},"./src/mobile.special.nearby.scripts/mobile.special.nearby.scripts.js":(e,r,t)=>{var n=new mw.Api,s=t("./src/mobile.special.nearby.scripts/nearbyErrorMessage.js"),i=t("./src/mobile.special.nearby.scripts/LocationProvider.js"),a=mw.config.get("wgMFNearbyRange")||1e3,o=t("./src/mobile.startup/promisedView.js"),c=mw.loader.require("mediawiki.router"),u=$("#mw-mf-nearby"),l=t("./src/mobile.startup/watchstar/WatchstarPageList.js"),g=$("#mf-nearby-info-holder"),m=new(t("./src/mobile.special.nearby.scripts/NearbyGateway.js"))({api:n});function d(e,r){g.hide(),$("body").removeClass("nearby-accept-pending"),r.empty().append(e.$el).show()}function p(e,r){var t={latitude:e,longitude:r};return o(m.getPages(t,a).then((function(e){return new l({pages:e,api:n})}),(function(e){return s(e)})))}c.on("hashchange",(function(){""===c.getPath()?(g.show(),u.hide()):(g.hide(),u.show())})),c.route(/^\/coord\/(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/,(function(e,r){d(p(e,r),u)})),c.route(/^\/page\/(.+)$/,(function(e){d(o(m.getPagesAroundPage(mw.Uri.decode(e),a).then((function(e){return new l({pages:e,api:n})})).catch((function(e){return s(e)}))),u)})),c.checkRoute(),$((function(){$("#showArticles").prop("disabled",!1).on("click",(function(){d(o(i.getCurrentPosition().then((function(e){var r=e.latitude,t=e.longitude;return c.navigateTo(null,{path:"#/coord/".concat(r,",").concat(t)}),p(r,t)})).catch((function(e){return s(e)}))),u)}))}))},"./src/mobile.special.nearby.scripts/nearbyErrorMessage.js":(e,r,t)=>{var n=t("./src/mobile.startup/util.js"),s=t("./src/mobile.startup/MessageBox.js"),i={permission:{hasHeading:!1,msg:mw.msg("mobile-frontend-nearby-permission-denied")},location:{hasHeading:!1,msg:mw.msg("mobile-frontend-nearby-location-unavailable")},empty:{heading:mw.msg("mobile-frontend-nearby-noresults"),hasHeading:!0,msg:mw.msg("mobile-frontend-nearby-noresults-guidance")},http:{heading:mw.msg("mobile-frontend-nearby-error"),hasHeading:!0,msg:mw.msg("mobile-frontend-nearby-error-guidance")},incompatible:{heading:mw.msg("mobile-frontend-nearby-requirements"),hasHeading:!0,msg:mw.msg("mobile-frontend-nearby-requirements-guidance")}};e.exports=function(e){var r=i[e]||i.http;return new s(n.extend({className:"mw-message-box-error"},r))}}},e=>{e.O(0,[569],(()=>e(e.s="./src/mobile.special.nearby.scripts/mobile.special.nearby.scripts.js")));var r=e.O();(this.mfModules=this.mfModules||{})["mobile.special.nearby.scripts"]=r}]);
//# sourceMappingURL=mobile.special.nearby.scripts.js.map.json